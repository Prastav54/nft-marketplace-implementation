import{t as Kr,v as Wt,w as Mr,aB as Gr,aC as Vr,ad as zt,Y as It,ab as Gt,ac as zr,ae as Qr,af as xt,ag as nr,ai as Et,ah as Nt,aj as kt,ak as Yr,al as Yt}from"./index-D-diXoG2.js";import{B as Xr}from"./baseEvmAdapter.esm-CQx56A4I.js";import{WalletConnectProvider as ir}from"./ethereumProvider.esm-C_VoeV8B.js";import"./baseProvider.esm-Do4-QwY4.js";import"./util-DgoFqbGd.js";import"./browser-BnO0s2aJ.js";var Ce={},W={};Object.defineProperty(W,"__esModule",{value:!0});W.getLocalStorage=W.getLocalStorageOrThrow=W.getCrypto=W.getCryptoOrThrow=W.getLocation=W.getLocationOrThrow=W.getNavigator=W.getNavigatorOrThrow=W.getDocument=W.getDocumentOrThrow=W.getFromWindowOrThrow=W.getFromWindow=void 0;function Ft(n){let e;return typeof window<"u"&&typeof window[n]<"u"&&(e=window[n]),e}W.getFromWindow=Ft;function Ht(n){const e=Ft(n);if(!e)throw new Error(`${n} is not defined in Window`);return e}W.getFromWindowOrThrow=Ht;function tn(){return Ht("document")}W.getDocumentOrThrow=tn;function en(){return Ft("document")}W.getDocument=en;function rn(){return Ht("navigator")}W.getNavigatorOrThrow=rn;function nn(){return Ft("navigator")}W.getNavigator=nn;function sn(){return Ht("location")}W.getLocationOrThrow=sn;function on(){return Ft("location")}W.getLocation=on;function an(){return Ht("crypto")}W.getCryptoOrThrow=an;function hn(){return Ft("crypto")}W.getCrypto=hn;function fn(){return Ht("localStorage")}W.getLocalStorageOrThrow=fn;function cn(){return Ft("localStorage")}W.getLocalStorage=cn;Object.defineProperty(Ce,"__esModule",{value:!0});var br=Ce.getWindowMetadata=void 0;const sr=W;function un(){let n,e;try{n=sr.getDocumentOrThrow(),e=sr.getLocationOrThrow()}catch{return null}function s(){const A=n.getElementsByTagName("link"),C=[];for(let P=0;P<A.length;P++){const St=A[P],Rt=St.getAttribute("rel");if(Rt&&Rt.toLowerCase().indexOf("icon")>-1){const v=St.getAttribute("href");if(v)if(v.toLowerCase().indexOf("https:")===-1&&v.toLowerCase().indexOf("http:")===-1&&v.indexOf("//")!==0){let w=e.protocol+"//"+e.host;if(v.indexOf("/")===0)w+=v;else{const M=e.pathname.split("/");M.pop();const _=M.join("/");w+=_+"/"+v}C.push(w)}else if(v.indexOf("//")===0){const w=e.protocol+v;C.push(w)}else C.push(v)}}return C}function h(...A){const C=n.getElementsByTagName("meta");for(let P=0;P<C.length;P++){const St=C[P],Rt=["itemprop","property","name"].map(v=>St.getAttribute(v)).filter(v=>v?A.includes(v):!1);if(Rt.length&&Rt){const v=St.getAttribute("content");if(v)return v}}return""}function g(){let A=h("name","og:site_name","og:title","twitter:title");return A||(A=n.title),A}function a(){return h("description","og:description","twitter:description","keywords")}const y=g(),O=a(),E=e.origin,R=s();return{description:O,url:E,icons:R,name:y}}br=Ce.getWindowMetadata=un;var F={};Object.defineProperty(F,"__esModule",{value:!0});var Sr=F.getLocalStorage=F.getLocalStorageOrThrow=F.getCrypto=F.getCryptoOrThrow=Rr=F.getLocation=F.getLocationOrThrow=Or=F.getNavigator=F.getNavigatorOrThrow=F.getDocument=F.getDocumentOrThrow=F.getFromWindowOrThrow=F.getFromWindow=void 0;function Dt(n){let e;return typeof window<"u"&&typeof window[n]<"u"&&(e=window[n]),e}F.getFromWindow=Dt;function Zt(n){const e=Dt(n);if(!e)throw new Error(`${n} is not defined in Window`);return e}F.getFromWindowOrThrow=Zt;function ln(){return Zt("document")}F.getDocumentOrThrow=ln;function dn(){return Dt("document")}F.getDocument=dn;function pn(){return Zt("navigator")}F.getNavigatorOrThrow=pn;function gn(){return Dt("navigator")}var Or=F.getNavigator=gn;function mn(){return Zt("location")}F.getLocationOrThrow=mn;function vn(){return Dt("location")}var Rr=F.getLocation=vn;function wn(){return Zt("crypto")}F.getCryptoOrThrow=wn;function yn(){return Dt("crypto")}F.getCrypto=yn;function _n(){return Zt("localStorage")}F.getLocalStorageOrThrow=_n;function Mn(){return Dt("localStorage")}Sr=F.getLocalStorage=Mn;var bn=function(){for(var n=0,e=0,s=arguments.length;e<s;e++)n+=arguments[e].length;for(var h=Array(n),g=0,e=0;e<s;e++)for(var a=arguments[e],y=0,O=a.length;y<O;y++,g++)h[g]=a[y];return h},Sn=function(){function n(e,s,h){this.name=e,this.version=s,this.os=h,this.type="browser"}return n}(),On=function(){function n(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return n}(),Rn=function(){function n(e,s,h,g){this.name=e,this.version=s,this.os=h,this.bot=g,this.type="bot-device"}return n}(),xn=function(){function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return n}(),En=function(){function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return n}(),In=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,kn=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,or=3,Tn=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FBAV\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["searchbot",In]],ar=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Cn(n){return n?hr(n):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new En:typeof navigator<"u"?hr(navigator.userAgent):qn()}function An(n){return n!==""&&Tn.reduce(function(e,s){var h=s[0],g=s[1];if(e)return e;var a=g.exec(n);return!!a&&[h,a]},!1)}function hr(n){var e=An(n);if(!e)return null;var s=e[0],h=e[1];if(s==="searchbot")return new xn;var g=h[1]&&h[1].split(/[._]/).slice(0,3);g?g.length<or&&(g=bn(g,Pn(or-g.length))):g=[];var a=g.join("."),y=Nn(n),O=kn.exec(n);return O&&O[1]?new Rn(s,a,y,O[1]):new Sn(s,a,y)}function Nn(n){for(var e=0,s=ar.length;e<s;e++){var h=ar[e],g=h[0],a=h[1],y=a.exec(n);if(y)return g}return null}function qn(){var n=typeof process<"u"&&process.version;return n?new On(process.version.slice(1)):null}function Pn(n){for(var e=[],s=0;s<n;s++)e.push("0");return e}function Ae(n){return Cn(n)}function Ne(){const n=Ae();return n&&n.os?n.os:void 0}function Ln(){const n=Ne();return n?n.toLowerCase().includes("android"):!1}function Bn(){const n=Ne();return n?n.toLowerCase().includes("ios")||n.toLowerCase().includes("mac")&&navigator.maxTouchPoints>1:!1}function Wn(){return Ne()?Ln()||Bn():!1}function Fn(){const n=Ae();return n&&n.name?n.name.toLowerCase()==="node":!1}function Dn(){return!Fn()&&!!Un()}const Un=Or,jn=Rr,qe=Sr;function fr(){return br()}function $n(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return JSON.parse(n)}catch{return n}}function Hn(n){return typeof n=="string"?n:JSON.stringify(n)}const Zn=$n,Jn=Hn;function Kn(n,e){const s=Jn(e),h=qe();h&&h.setItem(n,s)}function xr(n){let e=null,s=null;const h=qe();return h&&(s=h.getItem(n)),e=s&&Zn(s),e}function Er(n){const e=qe();e&&e.removeItem(n)}const cr="WALLETCONNECT_DEEPLINK_CHOICE",Gn=["session_request","session_update","exchange_key","connect","disconnect","display_uri","modal_closed","transport_open","transport_close","transport_error"],Ir=["eth_sendTransaction","eth_signTransaction","eth_sign","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v2","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","wallet_addEthereumChain","wallet_switchEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"];var Pe={exports:{}};Pe.exports;(function(n){(function(e,s){function h(d,t){if(!d)throw new Error(t||"Assertion failed")}function g(d,t){d.super_=t;var i=function(){};i.prototype=t.prototype,d.prototype=new i,d.prototype.constructor=d}function a(d,t,i){if(a.isBN(d))return d;this.negative=0,this.words=null,this.length=0,this.red=null,d!==null&&((t==="le"||t==="be")&&(i=t,t=10),this._init(d||0,t||10,i||"be"))}typeof e=="object"?e.exports=a:s.BN=a,a.BN=a,a.wordSize=26;var y;try{y=Kr.Buffer}catch{}a.isBN=function(t){return t instanceof a?!0:t!==null&&typeof t=="object"&&t.constructor.wordSize===a.wordSize&&Array.isArray(t.words)},a.max=function(t,i){return t.cmp(i)>0?t:i},a.min=function(t,i){return t.cmp(i)<0?t:i},a.prototype._init=function(t,i,o){if(typeof t=="number")return this._initNumber(t,i,o);if(typeof t=="object")return this._initArray(t,i,o);i==="hex"&&(i=16),h(i===(i|0)&&i>=2&&i<=36),t=t.toString().replace(/\s+/g,"");var f=0;t[0]==="-"&&f++,i===16?this._parseHex(t,f):this._parseBase(t,i,f),t[0]==="-"&&(this.negative=1),this.strip(),o==="le"&&this._initArray(this.toArray(),i,o)},a.prototype._initNumber=function(t,i,o){t<0&&(this.negative=1,t=-t),t<67108864?(this.words=[t&67108863],this.length=1):t<4503599627370496?(this.words=[t&67108863,t/67108864&67108863],this.length=2):(h(t<9007199254740992),this.words=[t&67108863,t/67108864&67108863,1],this.length=3),o==="le"&&this._initArray(this.toArray(),i,o)},a.prototype._initArray=function(t,i,o){if(h(typeof t.length=="number"),t.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(t.length/3),this.words=new Array(this.length);for(var f=0;f<this.length;f++)this.words[f]=0;var l,p,m=0;if(o==="be")for(f=t.length-1,l=0;f>=0;f-=3)p=t[f]|t[f-1]<<8|t[f-2]<<16,this.words[l]|=p<<m&67108863,this.words[l+1]=p>>>26-m&67108863,m+=24,m>=26&&(m-=26,l++);else if(o==="le")for(f=0,l=0;f<t.length;f+=3)p=t[f]|t[f+1]<<8|t[f+2]<<16,this.words[l]|=p<<m&67108863,this.words[l+1]=p>>>26-m&67108863,m+=24,m>=26&&(m-=26,l++);return this.strip()};function O(d,t,i){for(var o=0,f=Math.min(d.length,i),l=t;l<f;l++){var p=d.charCodeAt(l)-48;o<<=4,p>=49&&p<=54?o|=p-49+10:p>=17&&p<=22?o|=p-17+10:o|=p&15}return o}a.prototype._parseHex=function(t,i){this.length=Math.ceil((t.length-i)/6),this.words=new Array(this.length);for(var o=0;o<this.length;o++)this.words[o]=0;var f,l,p=0;for(o=t.length-6,f=0;o>=i;o-=6)l=O(t,o,o+6),this.words[f]|=l<<p&67108863,this.words[f+1]|=l>>>26-p&4194303,p+=24,p>=26&&(p-=26,f++);o+6!==i&&(l=O(t,i,o+6),this.words[f]|=l<<p&67108863,this.words[f+1]|=l>>>26-p&4194303),this.strip()};function E(d,t,i,o){for(var f=0,l=Math.min(d.length,i),p=t;p<l;p++){var m=d.charCodeAt(p)-48;f*=o,m>=49?f+=m-49+10:m>=17?f+=m-17+10:f+=m}return f}a.prototype._parseBase=function(t,i,o){this.words=[0],this.length=1;for(var f=0,l=1;l<=67108863;l*=i)f++;f--,l=l/i|0;for(var p=t.length-o,m=p%f,c=Math.min(p,p-m)+o,r=0,u=o;u<c;u+=f)r=E(t,u,u+f,i),this.imuln(l),this.words[0]+r<67108864?this.words[0]+=r:this._iaddn(r);if(m!==0){var b=1;for(r=E(t,u,t.length,i),u=0;u<m;u++)b*=i;this.imuln(b),this.words[0]+r<67108864?this.words[0]+=r:this._iaddn(r)}},a.prototype.copy=function(t){t.words=new Array(this.length);for(var i=0;i<this.length;i++)t.words[i]=this.words[i];t.length=this.length,t.negative=this.negative,t.red=this.red},a.prototype.clone=function(){var t=new a(null);return this.copy(t),t},a.prototype._expand=function(t){for(;this.length<t;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},a.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var R=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],q=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],A=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];a.prototype.toString=function(t,i){t=t||10,i=i|0||1;var o;if(t===16||t==="hex"){o="";for(var f=0,l=0,p=0;p<this.length;p++){var m=this.words[p],c=((m<<f|l)&16777215).toString(16);l=m>>>24-f&16777215,l!==0||p!==this.length-1?o=R[6-c.length]+c+o:o=c+o,f+=2,f>=26&&(f-=26,p--)}for(l!==0&&(o=l.toString(16)+o);o.length%i!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}if(t===(t|0)&&t>=2&&t<=36){var r=q[t],u=A[t];o="";var b=this.clone();for(b.negative=0;!b.isZero();){var S=b.modn(u).toString(t);b=b.idivn(u),b.isZero()?o=S+o:o=R[r-S.length]+S+o}for(this.isZero()&&(o="0"+o);o.length%i!==0;)o="0"+o;return this.negative!==0&&(o="-"+o),o}h(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var t=this.words[0];return this.length===2?t+=this.words[1]*67108864:this.length===3&&this.words[2]===1?t+=4503599627370496+this.words[1]*67108864:this.length>2&&h(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-t:t},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(t,i){return h(typeof y<"u"),this.toArrayLike(y,t,i)},a.prototype.toArray=function(t,i){return this.toArrayLike(Array,t,i)},a.prototype.toArrayLike=function(t,i,o){var f=this.byteLength(),l=o||Math.max(1,f);h(f<=l,"byte array longer than desired length"),h(l>0,"Requested array length <= 0"),this.strip();var p=i==="le",m=new t(l),c,r,u=this.clone();if(p){for(r=0;!u.isZero();r++)c=u.andln(255),u.iushrn(8),m[r]=c;for(;r<l;r++)m[r]=0}else{for(r=0;r<l-f;r++)m[r]=0;for(r=0;!u.isZero();r++)c=u.andln(255),u.iushrn(8),m[l-r-1]=c}return m},Math.clz32?a.prototype._countBits=function(t){return 32-Math.clz32(t)}:a.prototype._countBits=function(t){var i=t,o=0;return i>=4096&&(o+=13,i>>>=13),i>=64&&(o+=7,i>>>=7),i>=8&&(o+=4,i>>>=4),i>=2&&(o+=2,i>>>=2),o+i},a.prototype._zeroBits=function(t){if(t===0)return 26;var i=t,o=0;return i&8191||(o+=13,i>>>=13),i&127||(o+=7,i>>>=7),i&15||(o+=4,i>>>=4),i&3||(o+=2,i>>>=2),i&1||o++,o},a.prototype.bitLength=function(){var t=this.words[this.length-1],i=this._countBits(t);return(this.length-1)*26+i};function C(d){for(var t=new Array(d.bitLength()),i=0;i<t.length;i++){var o=i/26|0,f=i%26;t[i]=(d.words[o]&1<<f)>>>f}return t}a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var t=0,i=0;i<this.length;i++){var o=this._zeroBits(this.words[i]);if(t+=o,o!==26)break}return t},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(t){return this.negative!==0?this.abs().inotn(t).iaddn(1):this.clone()},a.prototype.fromTwos=function(t){return this.testn(t-1)?this.notn(t).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return this.negative!==0},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(t){for(;this.length<t.length;)this.words[this.length++]=0;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]|t.words[i];return this.strip()},a.prototype.ior=function(t){return h((this.negative|t.negative)===0),this.iuor(t)},a.prototype.or=function(t){return this.length>t.length?this.clone().ior(t):t.clone().ior(this)},a.prototype.uor=function(t){return this.length>t.length?this.clone().iuor(t):t.clone().iuor(this)},a.prototype.iuand=function(t){var i;this.length>t.length?i=t:i=this;for(var o=0;o<i.length;o++)this.words[o]=this.words[o]&t.words[o];return this.length=i.length,this.strip()},a.prototype.iand=function(t){return h((this.negative|t.negative)===0),this.iuand(t)},a.prototype.and=function(t){return this.length>t.length?this.clone().iand(t):t.clone().iand(this)},a.prototype.uand=function(t){return this.length>t.length?this.clone().iuand(t):t.clone().iuand(this)},a.prototype.iuxor=function(t){var i,o;this.length>t.length?(i=this,o=t):(i=t,o=this);for(var f=0;f<o.length;f++)this.words[f]=i.words[f]^o.words[f];if(this!==i)for(;f<i.length;f++)this.words[f]=i.words[f];return this.length=i.length,this.strip()},a.prototype.ixor=function(t){return h((this.negative|t.negative)===0),this.iuxor(t)},a.prototype.xor=function(t){return this.length>t.length?this.clone().ixor(t):t.clone().ixor(this)},a.prototype.uxor=function(t){return this.length>t.length?this.clone().iuxor(t):t.clone().iuxor(this)},a.prototype.inotn=function(t){h(typeof t=="number"&&t>=0);var i=Math.ceil(t/26)|0,o=t%26;this._expand(i),o>0&&i--;for(var f=0;f<i;f++)this.words[f]=~this.words[f]&67108863;return o>0&&(this.words[f]=~this.words[f]&67108863>>26-o),this.strip()},a.prototype.notn=function(t){return this.clone().inotn(t)},a.prototype.setn=function(t,i){h(typeof t=="number"&&t>=0);var o=t/26|0,f=t%26;return this._expand(o+1),i?this.words[o]=this.words[o]|1<<f:this.words[o]=this.words[o]&~(1<<f),this.strip()},a.prototype.iadd=function(t){var i;if(this.negative!==0&&t.negative===0)return this.negative=0,i=this.isub(t),this.negative^=1,this._normSign();if(this.negative===0&&t.negative!==0)return t.negative=0,i=this.isub(t),t.negative=1,i._normSign();var o,f;this.length>t.length?(o=this,f=t):(o=t,f=this);for(var l=0,p=0;p<f.length;p++)i=(o.words[p]|0)+(f.words[p]|0)+l,this.words[p]=i&67108863,l=i>>>26;for(;l!==0&&p<o.length;p++)i=(o.words[p]|0)+l,this.words[p]=i&67108863,l=i>>>26;if(this.length=o.length,l!==0)this.words[this.length]=l,this.length++;else if(o!==this)for(;p<o.length;p++)this.words[p]=o.words[p];return this},a.prototype.add=function(t){var i;return t.negative!==0&&this.negative===0?(t.negative=0,i=this.sub(t),t.negative^=1,i):t.negative===0&&this.negative!==0?(this.negative=0,i=t.sub(this),this.negative=1,i):this.length>t.length?this.clone().iadd(t):t.clone().iadd(this)},a.prototype.isub=function(t){if(t.negative!==0){t.negative=0;var i=this.iadd(t);return t.negative=1,i._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(t),this.negative=1,this._normSign();var o=this.cmp(t);if(o===0)return this.negative=0,this.length=1,this.words[0]=0,this;var f,l;o>0?(f=this,l=t):(f=t,l=this);for(var p=0,m=0;m<l.length;m++)i=(f.words[m]|0)-(l.words[m]|0)+p,p=i>>26,this.words[m]=i&67108863;for(;p!==0&&m<f.length;m++)i=(f.words[m]|0)+p,p=i>>26,this.words[m]=i&67108863;if(p===0&&m<f.length&&f!==this)for(;m<f.length;m++)this.words[m]=f.words[m];return this.length=Math.max(this.length,m),f!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(t){return this.clone().isub(t)};function P(d,t,i){i.negative=t.negative^d.negative;var o=d.length+t.length|0;i.length=o,o=o-1|0;var f=d.words[0]|0,l=t.words[0]|0,p=f*l,m=p&67108863,c=p/67108864|0;i.words[0]=m;for(var r=1;r<o;r++){for(var u=c>>>26,b=c&67108863,S=Math.min(r,t.length-1),x=Math.max(0,r-d.length+1);x<=S;x++){var I=r-x|0;f=d.words[I]|0,l=t.words[x]|0,p=f*l+b,u+=p/67108864|0,b=p&67108863}i.words[r]=b|0,c=u|0}return c!==0?i.words[r]=c|0:i.length--,i.strip()}var St=function(t,i,o){var f=t.words,l=i.words,p=o.words,m=0,c,r,u,b=f[0]|0,S=b&8191,x=b>>>13,I=f[1]|0,N=I&8191,L=I>>>13,At=f[2]|0,B=At&8191,D=At>>>13,De=f[3]|0,$=De&8191,H=De>>>13,Ue=f[4]|0,Z=Ue&8191,J=Ue>>>13,je=f[5]|0,K=je&8191,G=je>>>13,$e=f[6]|0,V=$e&8191,z=$e>>>13,He=f[7]|0,Q=He&8191,Y=He>>>13,Ze=f[8]|0,X=Ze&8191,tt=Ze>>>13,Je=f[9]|0,et=Je&8191,rt=Je>>>13,Ke=l[0]|0,nt=Ke&8191,it=Ke>>>13,Ge=l[1]|0,st=Ge&8191,ot=Ge>>>13,Ve=l[2]|0,at=Ve&8191,ht=Ve>>>13,ze=l[3]|0,ft=ze&8191,ct=ze>>>13,Qe=l[4]|0,ut=Qe&8191,lt=Qe>>>13,Ye=l[5]|0,dt=Ye&8191,pt=Ye>>>13,Xe=l[6]|0,gt=Xe&8191,mt=Xe>>>13,tr=l[7]|0,vt=tr&8191,wt=tr>>>13,er=l[8]|0,yt=er&8191,_t=er>>>13,rr=l[9]|0,Mt=rr&8191,bt=rr>>>13;o.negative=t.negative^i.negative,o.length=19,c=Math.imul(S,nt),r=Math.imul(S,it),r=r+Math.imul(x,nt)|0,u=Math.imul(x,it);var ne=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ne>>>26)|0,ne&=67108863,c=Math.imul(N,nt),r=Math.imul(N,it),r=r+Math.imul(L,nt)|0,u=Math.imul(L,it),c=c+Math.imul(S,st)|0,r=r+Math.imul(S,ot)|0,r=r+Math.imul(x,st)|0,u=u+Math.imul(x,ot)|0;var ie=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ie>>>26)|0,ie&=67108863,c=Math.imul(B,nt),r=Math.imul(B,it),r=r+Math.imul(D,nt)|0,u=Math.imul(D,it),c=c+Math.imul(N,st)|0,r=r+Math.imul(N,ot)|0,r=r+Math.imul(L,st)|0,u=u+Math.imul(L,ot)|0,c=c+Math.imul(S,at)|0,r=r+Math.imul(S,ht)|0,r=r+Math.imul(x,at)|0,u=u+Math.imul(x,ht)|0;var se=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(se>>>26)|0,se&=67108863,c=Math.imul($,nt),r=Math.imul($,it),r=r+Math.imul(H,nt)|0,u=Math.imul(H,it),c=c+Math.imul(B,st)|0,r=r+Math.imul(B,ot)|0,r=r+Math.imul(D,st)|0,u=u+Math.imul(D,ot)|0,c=c+Math.imul(N,at)|0,r=r+Math.imul(N,ht)|0,r=r+Math.imul(L,at)|0,u=u+Math.imul(L,ht)|0,c=c+Math.imul(S,ft)|0,r=r+Math.imul(S,ct)|0,r=r+Math.imul(x,ft)|0,u=u+Math.imul(x,ct)|0;var oe=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(oe>>>26)|0,oe&=67108863,c=Math.imul(Z,nt),r=Math.imul(Z,it),r=r+Math.imul(J,nt)|0,u=Math.imul(J,it),c=c+Math.imul($,st)|0,r=r+Math.imul($,ot)|0,r=r+Math.imul(H,st)|0,u=u+Math.imul(H,ot)|0,c=c+Math.imul(B,at)|0,r=r+Math.imul(B,ht)|0,r=r+Math.imul(D,at)|0,u=u+Math.imul(D,ht)|0,c=c+Math.imul(N,ft)|0,r=r+Math.imul(N,ct)|0,r=r+Math.imul(L,ft)|0,u=u+Math.imul(L,ct)|0,c=c+Math.imul(S,ut)|0,r=r+Math.imul(S,lt)|0,r=r+Math.imul(x,ut)|0,u=u+Math.imul(x,lt)|0;var ae=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ae>>>26)|0,ae&=67108863,c=Math.imul(K,nt),r=Math.imul(K,it),r=r+Math.imul(G,nt)|0,u=Math.imul(G,it),c=c+Math.imul(Z,st)|0,r=r+Math.imul(Z,ot)|0,r=r+Math.imul(J,st)|0,u=u+Math.imul(J,ot)|0,c=c+Math.imul($,at)|0,r=r+Math.imul($,ht)|0,r=r+Math.imul(H,at)|0,u=u+Math.imul(H,ht)|0,c=c+Math.imul(B,ft)|0,r=r+Math.imul(B,ct)|0,r=r+Math.imul(D,ft)|0,u=u+Math.imul(D,ct)|0,c=c+Math.imul(N,ut)|0,r=r+Math.imul(N,lt)|0,r=r+Math.imul(L,ut)|0,u=u+Math.imul(L,lt)|0,c=c+Math.imul(S,dt)|0,r=r+Math.imul(S,pt)|0,r=r+Math.imul(x,dt)|0,u=u+Math.imul(x,pt)|0;var he=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(he>>>26)|0,he&=67108863,c=Math.imul(V,nt),r=Math.imul(V,it),r=r+Math.imul(z,nt)|0,u=Math.imul(z,it),c=c+Math.imul(K,st)|0,r=r+Math.imul(K,ot)|0,r=r+Math.imul(G,st)|0,u=u+Math.imul(G,ot)|0,c=c+Math.imul(Z,at)|0,r=r+Math.imul(Z,ht)|0,r=r+Math.imul(J,at)|0,u=u+Math.imul(J,ht)|0,c=c+Math.imul($,ft)|0,r=r+Math.imul($,ct)|0,r=r+Math.imul(H,ft)|0,u=u+Math.imul(H,ct)|0,c=c+Math.imul(B,ut)|0,r=r+Math.imul(B,lt)|0,r=r+Math.imul(D,ut)|0,u=u+Math.imul(D,lt)|0,c=c+Math.imul(N,dt)|0,r=r+Math.imul(N,pt)|0,r=r+Math.imul(L,dt)|0,u=u+Math.imul(L,pt)|0,c=c+Math.imul(S,gt)|0,r=r+Math.imul(S,mt)|0,r=r+Math.imul(x,gt)|0,u=u+Math.imul(x,mt)|0;var fe=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(fe>>>26)|0,fe&=67108863,c=Math.imul(Q,nt),r=Math.imul(Q,it),r=r+Math.imul(Y,nt)|0,u=Math.imul(Y,it),c=c+Math.imul(V,st)|0,r=r+Math.imul(V,ot)|0,r=r+Math.imul(z,st)|0,u=u+Math.imul(z,ot)|0,c=c+Math.imul(K,at)|0,r=r+Math.imul(K,ht)|0,r=r+Math.imul(G,at)|0,u=u+Math.imul(G,ht)|0,c=c+Math.imul(Z,ft)|0,r=r+Math.imul(Z,ct)|0,r=r+Math.imul(J,ft)|0,u=u+Math.imul(J,ct)|0,c=c+Math.imul($,ut)|0,r=r+Math.imul($,lt)|0,r=r+Math.imul(H,ut)|0,u=u+Math.imul(H,lt)|0,c=c+Math.imul(B,dt)|0,r=r+Math.imul(B,pt)|0,r=r+Math.imul(D,dt)|0,u=u+Math.imul(D,pt)|0,c=c+Math.imul(N,gt)|0,r=r+Math.imul(N,mt)|0,r=r+Math.imul(L,gt)|0,u=u+Math.imul(L,mt)|0,c=c+Math.imul(S,vt)|0,r=r+Math.imul(S,wt)|0,r=r+Math.imul(x,vt)|0,u=u+Math.imul(x,wt)|0;var ce=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ce>>>26)|0,ce&=67108863,c=Math.imul(X,nt),r=Math.imul(X,it),r=r+Math.imul(tt,nt)|0,u=Math.imul(tt,it),c=c+Math.imul(Q,st)|0,r=r+Math.imul(Q,ot)|0,r=r+Math.imul(Y,st)|0,u=u+Math.imul(Y,ot)|0,c=c+Math.imul(V,at)|0,r=r+Math.imul(V,ht)|0,r=r+Math.imul(z,at)|0,u=u+Math.imul(z,ht)|0,c=c+Math.imul(K,ft)|0,r=r+Math.imul(K,ct)|0,r=r+Math.imul(G,ft)|0,u=u+Math.imul(G,ct)|0,c=c+Math.imul(Z,ut)|0,r=r+Math.imul(Z,lt)|0,r=r+Math.imul(J,ut)|0,u=u+Math.imul(J,lt)|0,c=c+Math.imul($,dt)|0,r=r+Math.imul($,pt)|0,r=r+Math.imul(H,dt)|0,u=u+Math.imul(H,pt)|0,c=c+Math.imul(B,gt)|0,r=r+Math.imul(B,mt)|0,r=r+Math.imul(D,gt)|0,u=u+Math.imul(D,mt)|0,c=c+Math.imul(N,vt)|0,r=r+Math.imul(N,wt)|0,r=r+Math.imul(L,vt)|0,u=u+Math.imul(L,wt)|0,c=c+Math.imul(S,yt)|0,r=r+Math.imul(S,_t)|0,r=r+Math.imul(x,yt)|0,u=u+Math.imul(x,_t)|0;var ue=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ue>>>26)|0,ue&=67108863,c=Math.imul(et,nt),r=Math.imul(et,it),r=r+Math.imul(rt,nt)|0,u=Math.imul(rt,it),c=c+Math.imul(X,st)|0,r=r+Math.imul(X,ot)|0,r=r+Math.imul(tt,st)|0,u=u+Math.imul(tt,ot)|0,c=c+Math.imul(Q,at)|0,r=r+Math.imul(Q,ht)|0,r=r+Math.imul(Y,at)|0,u=u+Math.imul(Y,ht)|0,c=c+Math.imul(V,ft)|0,r=r+Math.imul(V,ct)|0,r=r+Math.imul(z,ft)|0,u=u+Math.imul(z,ct)|0,c=c+Math.imul(K,ut)|0,r=r+Math.imul(K,lt)|0,r=r+Math.imul(G,ut)|0,u=u+Math.imul(G,lt)|0,c=c+Math.imul(Z,dt)|0,r=r+Math.imul(Z,pt)|0,r=r+Math.imul(J,dt)|0,u=u+Math.imul(J,pt)|0,c=c+Math.imul($,gt)|0,r=r+Math.imul($,mt)|0,r=r+Math.imul(H,gt)|0,u=u+Math.imul(H,mt)|0,c=c+Math.imul(B,vt)|0,r=r+Math.imul(B,wt)|0,r=r+Math.imul(D,vt)|0,u=u+Math.imul(D,wt)|0,c=c+Math.imul(N,yt)|0,r=r+Math.imul(N,_t)|0,r=r+Math.imul(L,yt)|0,u=u+Math.imul(L,_t)|0,c=c+Math.imul(S,Mt)|0,r=r+Math.imul(S,bt)|0,r=r+Math.imul(x,Mt)|0,u=u+Math.imul(x,bt)|0;var le=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(le>>>26)|0,le&=67108863,c=Math.imul(et,st),r=Math.imul(et,ot),r=r+Math.imul(rt,st)|0,u=Math.imul(rt,ot),c=c+Math.imul(X,at)|0,r=r+Math.imul(X,ht)|0,r=r+Math.imul(tt,at)|0,u=u+Math.imul(tt,ht)|0,c=c+Math.imul(Q,ft)|0,r=r+Math.imul(Q,ct)|0,r=r+Math.imul(Y,ft)|0,u=u+Math.imul(Y,ct)|0,c=c+Math.imul(V,ut)|0,r=r+Math.imul(V,lt)|0,r=r+Math.imul(z,ut)|0,u=u+Math.imul(z,lt)|0,c=c+Math.imul(K,dt)|0,r=r+Math.imul(K,pt)|0,r=r+Math.imul(G,dt)|0,u=u+Math.imul(G,pt)|0,c=c+Math.imul(Z,gt)|0,r=r+Math.imul(Z,mt)|0,r=r+Math.imul(J,gt)|0,u=u+Math.imul(J,mt)|0,c=c+Math.imul($,vt)|0,r=r+Math.imul($,wt)|0,r=r+Math.imul(H,vt)|0,u=u+Math.imul(H,wt)|0,c=c+Math.imul(B,yt)|0,r=r+Math.imul(B,_t)|0,r=r+Math.imul(D,yt)|0,u=u+Math.imul(D,_t)|0,c=c+Math.imul(N,Mt)|0,r=r+Math.imul(N,bt)|0,r=r+Math.imul(L,Mt)|0,u=u+Math.imul(L,bt)|0;var de=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(de>>>26)|0,de&=67108863,c=Math.imul(et,at),r=Math.imul(et,ht),r=r+Math.imul(rt,at)|0,u=Math.imul(rt,ht),c=c+Math.imul(X,ft)|0,r=r+Math.imul(X,ct)|0,r=r+Math.imul(tt,ft)|0,u=u+Math.imul(tt,ct)|0,c=c+Math.imul(Q,ut)|0,r=r+Math.imul(Q,lt)|0,r=r+Math.imul(Y,ut)|0,u=u+Math.imul(Y,lt)|0,c=c+Math.imul(V,dt)|0,r=r+Math.imul(V,pt)|0,r=r+Math.imul(z,dt)|0,u=u+Math.imul(z,pt)|0,c=c+Math.imul(K,gt)|0,r=r+Math.imul(K,mt)|0,r=r+Math.imul(G,gt)|0,u=u+Math.imul(G,mt)|0,c=c+Math.imul(Z,vt)|0,r=r+Math.imul(Z,wt)|0,r=r+Math.imul(J,vt)|0,u=u+Math.imul(J,wt)|0,c=c+Math.imul($,yt)|0,r=r+Math.imul($,_t)|0,r=r+Math.imul(H,yt)|0,u=u+Math.imul(H,_t)|0,c=c+Math.imul(B,Mt)|0,r=r+Math.imul(B,bt)|0,r=r+Math.imul(D,Mt)|0,u=u+Math.imul(D,bt)|0;var pe=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(pe>>>26)|0,pe&=67108863,c=Math.imul(et,ft),r=Math.imul(et,ct),r=r+Math.imul(rt,ft)|0,u=Math.imul(rt,ct),c=c+Math.imul(X,ut)|0,r=r+Math.imul(X,lt)|0,r=r+Math.imul(tt,ut)|0,u=u+Math.imul(tt,lt)|0,c=c+Math.imul(Q,dt)|0,r=r+Math.imul(Q,pt)|0,r=r+Math.imul(Y,dt)|0,u=u+Math.imul(Y,pt)|0,c=c+Math.imul(V,gt)|0,r=r+Math.imul(V,mt)|0,r=r+Math.imul(z,gt)|0,u=u+Math.imul(z,mt)|0,c=c+Math.imul(K,vt)|0,r=r+Math.imul(K,wt)|0,r=r+Math.imul(G,vt)|0,u=u+Math.imul(G,wt)|0,c=c+Math.imul(Z,yt)|0,r=r+Math.imul(Z,_t)|0,r=r+Math.imul(J,yt)|0,u=u+Math.imul(J,_t)|0,c=c+Math.imul($,Mt)|0,r=r+Math.imul($,bt)|0,r=r+Math.imul(H,Mt)|0,u=u+Math.imul(H,bt)|0;var ge=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,c=Math.imul(et,ut),r=Math.imul(et,lt),r=r+Math.imul(rt,ut)|0,u=Math.imul(rt,lt),c=c+Math.imul(X,dt)|0,r=r+Math.imul(X,pt)|0,r=r+Math.imul(tt,dt)|0,u=u+Math.imul(tt,pt)|0,c=c+Math.imul(Q,gt)|0,r=r+Math.imul(Q,mt)|0,r=r+Math.imul(Y,gt)|0,u=u+Math.imul(Y,mt)|0,c=c+Math.imul(V,vt)|0,r=r+Math.imul(V,wt)|0,r=r+Math.imul(z,vt)|0,u=u+Math.imul(z,wt)|0,c=c+Math.imul(K,yt)|0,r=r+Math.imul(K,_t)|0,r=r+Math.imul(G,yt)|0,u=u+Math.imul(G,_t)|0,c=c+Math.imul(Z,Mt)|0,r=r+Math.imul(Z,bt)|0,r=r+Math.imul(J,Mt)|0,u=u+Math.imul(J,bt)|0;var me=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(me>>>26)|0,me&=67108863,c=Math.imul(et,dt),r=Math.imul(et,pt),r=r+Math.imul(rt,dt)|0,u=Math.imul(rt,pt),c=c+Math.imul(X,gt)|0,r=r+Math.imul(X,mt)|0,r=r+Math.imul(tt,gt)|0,u=u+Math.imul(tt,mt)|0,c=c+Math.imul(Q,vt)|0,r=r+Math.imul(Q,wt)|0,r=r+Math.imul(Y,vt)|0,u=u+Math.imul(Y,wt)|0,c=c+Math.imul(V,yt)|0,r=r+Math.imul(V,_t)|0,r=r+Math.imul(z,yt)|0,u=u+Math.imul(z,_t)|0,c=c+Math.imul(K,Mt)|0,r=r+Math.imul(K,bt)|0,r=r+Math.imul(G,Mt)|0,u=u+Math.imul(G,bt)|0;var ve=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,c=Math.imul(et,gt),r=Math.imul(et,mt),r=r+Math.imul(rt,gt)|0,u=Math.imul(rt,mt),c=c+Math.imul(X,vt)|0,r=r+Math.imul(X,wt)|0,r=r+Math.imul(tt,vt)|0,u=u+Math.imul(tt,wt)|0,c=c+Math.imul(Q,yt)|0,r=r+Math.imul(Q,_t)|0,r=r+Math.imul(Y,yt)|0,u=u+Math.imul(Y,_t)|0,c=c+Math.imul(V,Mt)|0,r=r+Math.imul(V,bt)|0,r=r+Math.imul(z,Mt)|0,u=u+Math.imul(z,bt)|0;var we=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(we>>>26)|0,we&=67108863,c=Math.imul(et,vt),r=Math.imul(et,wt),r=r+Math.imul(rt,vt)|0,u=Math.imul(rt,wt),c=c+Math.imul(X,yt)|0,r=r+Math.imul(X,_t)|0,r=r+Math.imul(tt,yt)|0,u=u+Math.imul(tt,_t)|0,c=c+Math.imul(Q,Mt)|0,r=r+Math.imul(Q,bt)|0,r=r+Math.imul(Y,Mt)|0,u=u+Math.imul(Y,bt)|0;var ye=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,c=Math.imul(et,yt),r=Math.imul(et,_t),r=r+Math.imul(rt,yt)|0,u=Math.imul(rt,_t),c=c+Math.imul(X,Mt)|0,r=r+Math.imul(X,bt)|0,r=r+Math.imul(tt,Mt)|0,u=u+Math.imul(tt,bt)|0;var _e=(m+c|0)+((r&8191)<<13)|0;m=(u+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,c=Math.imul(et,Mt),r=Math.imul(et,bt),r=r+Math.imul(rt,Mt)|0,u=Math.imul(rt,bt);var Me=(m+c|0)+((r&8191)<<13)|0;return m=(u+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,p[0]=ne,p[1]=ie,p[2]=se,p[3]=oe,p[4]=ae,p[5]=he,p[6]=fe,p[7]=ce,p[8]=ue,p[9]=le,p[10]=de,p[11]=pe,p[12]=ge,p[13]=me,p[14]=ve,p[15]=we,p[16]=ye,p[17]=_e,p[18]=Me,m!==0&&(p[19]=m,o.length++),o};Math.imul||(St=P);function Rt(d,t,i){i.negative=t.negative^d.negative,i.length=d.length+t.length;for(var o=0,f=0,l=0;l<i.length-1;l++){var p=f;f=0;for(var m=o&67108863,c=Math.min(l,t.length-1),r=Math.max(0,l-d.length+1);r<=c;r++){var u=l-r,b=d.words[u]|0,S=t.words[r]|0,x=b*S,I=x&67108863;p=p+(x/67108864|0)|0,I=I+m|0,m=I&67108863,p=p+(I>>>26)|0,f+=p>>>26,p&=67108863}i.words[l]=m,o=p,p=f}return o!==0?i.words[l]=o:i.length--,i.strip()}function v(d,t,i){var o=new w;return o.mulp(d,t,i)}a.prototype.mulTo=function(t,i){var o,f=this.length+t.length;return this.length===10&&t.length===10?o=St(this,t,i):f<63?o=P(this,t,i):f<1024?o=Rt(this,t,i):o=v(this,t,i),o};function w(d,t){this.x=d,this.y=t}w.prototype.makeRBT=function(t){for(var i=new Array(t),o=a.prototype._countBits(t)-1,f=0;f<t;f++)i[f]=this.revBin(f,o,t);return i},w.prototype.revBin=function(t,i,o){if(t===0||t===o-1)return t;for(var f=0,l=0;l<i;l++)f|=(t&1)<<i-l-1,t>>=1;return f},w.prototype.permute=function(t,i,o,f,l,p){for(var m=0;m<p;m++)f[m]=i[t[m]],l[m]=o[t[m]]},w.prototype.transform=function(t,i,o,f,l,p){this.permute(p,t,i,o,f,l);for(var m=1;m<l;m<<=1)for(var c=m<<1,r=Math.cos(2*Math.PI/c),u=Math.sin(2*Math.PI/c),b=0;b<l;b+=c)for(var S=r,x=u,I=0;I<m;I++){var N=o[b+I],L=f[b+I],At=o[b+I+m],B=f[b+I+m],D=S*At-x*B;B=S*B+x*At,At=D,o[b+I]=N+At,f[b+I]=L+B,o[b+I+m]=N-At,f[b+I+m]=L-B,I!==c&&(D=r*S-u*x,x=r*x+u*S,S=D)}},w.prototype.guessLen13b=function(t,i){var o=Math.max(i,t)|1,f=o&1,l=0;for(o=o/2|0;o;o=o>>>1)l++;return 1<<l+1+f},w.prototype.conjugate=function(t,i,o){if(!(o<=1))for(var f=0;f<o/2;f++){var l=t[f];t[f]=t[o-f-1],t[o-f-1]=l,l=i[f],i[f]=-i[o-f-1],i[o-f-1]=-l}},w.prototype.normalize13b=function(t,i){for(var o=0,f=0;f<i/2;f++){var l=Math.round(t[2*f+1]/i)*8192+Math.round(t[2*f]/i)+o;t[f]=l&67108863,l<67108864?o=0:o=l/67108864|0}return t},w.prototype.convert13b=function(t,i,o,f){for(var l=0,p=0;p<i;p++)l=l+(t[p]|0),o[2*p]=l&8191,l=l>>>13,o[2*p+1]=l&8191,l=l>>>13;for(p=2*i;p<f;++p)o[p]=0;h(l===0),h((l&-8192)===0)},w.prototype.stub=function(t){for(var i=new Array(t),o=0;o<t;o++)i[o]=0;return i},w.prototype.mulp=function(t,i,o){var f=2*this.guessLen13b(t.length,i.length),l=this.makeRBT(f),p=this.stub(f),m=new Array(f),c=new Array(f),r=new Array(f),u=new Array(f),b=new Array(f),S=new Array(f),x=o.words;x.length=f,this.convert13b(t.words,t.length,m,f),this.convert13b(i.words,i.length,u,f),this.transform(m,p,c,r,f,l),this.transform(u,p,b,S,f,l);for(var I=0;I<f;I++){var N=c[I]*b[I]-r[I]*S[I];r[I]=c[I]*S[I]+r[I]*b[I],c[I]=N}return this.conjugate(c,r,f),this.transform(c,r,x,p,f,l),this.conjugate(x,p,f),this.normalize13b(x,f),o.negative=t.negative^i.negative,o.length=t.length+i.length,o.strip()},a.prototype.mul=function(t){var i=new a(null);return i.words=new Array(this.length+t.length),this.mulTo(t,i)},a.prototype.mulf=function(t){var i=new a(null);return i.words=new Array(this.length+t.length),v(this,t,i)},a.prototype.imul=function(t){return this.clone().mulTo(t,this)},a.prototype.imuln=function(t){h(typeof t=="number"),h(t<67108864);for(var i=0,o=0;o<this.length;o++){var f=(this.words[o]|0)*t,l=(f&67108863)+(i&67108863);i>>=26,i+=f/67108864|0,i+=l>>>26,this.words[o]=l&67108863}return i!==0&&(this.words[o]=i,this.length++),this},a.prototype.muln=function(t){return this.clone().imuln(t)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(t){var i=C(t);if(i.length===0)return new a(1);for(var o=this,f=0;f<i.length&&i[f]===0;f++,o=o.sqr());if(++f<i.length)for(var l=o.sqr();f<i.length;f++,l=l.sqr())i[f]!==0&&(o=o.mul(l));return o},a.prototype.iushln=function(t){h(typeof t=="number"&&t>=0);var i=t%26,o=(t-i)/26,f=67108863>>>26-i<<26-i,l;if(i!==0){var p=0;for(l=0;l<this.length;l++){var m=this.words[l]&f,c=(this.words[l]|0)-m<<i;this.words[l]=c|p,p=m>>>26-i}p&&(this.words[l]=p,this.length++)}if(o!==0){for(l=this.length-1;l>=0;l--)this.words[l+o]=this.words[l];for(l=0;l<o;l++)this.words[l]=0;this.length+=o}return this.strip()},a.prototype.ishln=function(t){return h(this.negative===0),this.iushln(t)},a.prototype.iushrn=function(t,i,o){h(typeof t=="number"&&t>=0);var f;i?f=(i-i%26)/26:f=0;var l=t%26,p=Math.min((t-l)/26,this.length),m=67108863^67108863>>>l<<l,c=o;if(f-=p,f=Math.max(0,f),c){for(var r=0;r<p;r++)c.words[r]=this.words[r];c.length=p}if(p!==0)if(this.length>p)for(this.length-=p,r=0;r<this.length;r++)this.words[r]=this.words[r+p];else this.words[0]=0,this.length=1;var u=0;for(r=this.length-1;r>=0&&(u!==0||r>=f);r--){var b=this.words[r]|0;this.words[r]=u<<26-l|b>>>l,u=b&m}return c&&u!==0&&(c.words[c.length++]=u),this.length===0&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(t,i,o){return h(this.negative===0),this.iushrn(t,i,o)},a.prototype.shln=function(t){return this.clone().ishln(t)},a.prototype.ushln=function(t){return this.clone().iushln(t)},a.prototype.shrn=function(t){return this.clone().ishrn(t)},a.prototype.ushrn=function(t){return this.clone().iushrn(t)},a.prototype.testn=function(t){h(typeof t=="number"&&t>=0);var i=t%26,o=(t-i)/26,f=1<<i;if(this.length<=o)return!1;var l=this.words[o];return!!(l&f)},a.prototype.imaskn=function(t){h(typeof t=="number"&&t>=0);var i=t%26,o=(t-i)/26;if(h(this.negative===0,"imaskn works only with positive numbers"),this.length<=o)return this;if(i!==0&&o++,this.length=Math.min(o,this.length),i!==0){var f=67108863^67108863>>>i<<i;this.words[this.length-1]&=f}return this.strip()},a.prototype.maskn=function(t){return this.clone().imaskn(t)},a.prototype.iaddn=function(t){return h(typeof t=="number"),h(t<67108864),t<0?this.isubn(-t):this.negative!==0?this.length===1&&(this.words[0]|0)<t?(this.words[0]=t-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(t),this.negative=1,this):this._iaddn(t)},a.prototype._iaddn=function(t){this.words[0]+=t;for(var i=0;i<this.length&&this.words[i]>=67108864;i++)this.words[i]-=67108864,i===this.length-1?this.words[i+1]=1:this.words[i+1]++;return this.length=Math.max(this.length,i+1),this},a.prototype.isubn=function(t){if(h(typeof t=="number"),h(t<67108864),t<0)return this.iaddn(-t);if(this.negative!==0)return this.negative=0,this.iaddn(t),this.negative=1,this;if(this.words[0]-=t,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var i=0;i<this.length&&this.words[i]<0;i++)this.words[i]+=67108864,this.words[i+1]-=1;return this.strip()},a.prototype.addn=function(t){return this.clone().iaddn(t)},a.prototype.subn=function(t){return this.clone().isubn(t)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(t,i,o){var f=t.length+o,l;this._expand(f);var p,m=0;for(l=0;l<t.length;l++){p=(this.words[l+o]|0)+m;var c=(t.words[l]|0)*i;p-=c&67108863,m=(p>>26)-(c/67108864|0),this.words[l+o]=p&67108863}for(;l<this.length-o;l++)p=(this.words[l+o]|0)+m,m=p>>26,this.words[l+o]=p&67108863;if(m===0)return this.strip();for(h(m===-1),m=0,l=0;l<this.length;l++)p=-(this.words[l]|0)+m,m=p>>26,this.words[l]=p&67108863;return this.negative=1,this.strip()},a.prototype._wordDiv=function(t,i){var o=this.length-t.length,f=this.clone(),l=t,p=l.words[l.length-1]|0,m=this._countBits(p);o=26-m,o!==0&&(l=l.ushln(o),f.iushln(o),p=l.words[l.length-1]|0);var c=f.length-l.length,r;if(i!=="mod"){r=new a(null),r.length=c+1,r.words=new Array(r.length);for(var u=0;u<r.length;u++)r.words[u]=0}var b=f.clone()._ishlnsubmul(l,1,c);b.negative===0&&(f=b,r&&(r.words[c]=1));for(var S=c-1;S>=0;S--){var x=(f.words[l.length+S]|0)*67108864+(f.words[l.length+S-1]|0);for(x=Math.min(x/p|0,67108863),f._ishlnsubmul(l,x,S);f.negative!==0;)x--,f.negative=0,f._ishlnsubmul(l,1,S),f.isZero()||(f.negative^=1);r&&(r.words[S]=x)}return r&&r.strip(),f.strip(),i!=="div"&&o!==0&&f.iushrn(o),{div:r||null,mod:f}},a.prototype.divmod=function(t,i,o){if(h(!t.isZero()),this.isZero())return{div:new a(0),mod:new a(0)};var f,l,p;return this.negative!==0&&t.negative===0?(p=this.neg().divmod(t,i),i!=="mod"&&(f=p.div.neg()),i!=="div"&&(l=p.mod.neg(),o&&l.negative!==0&&l.iadd(t)),{div:f,mod:l}):this.negative===0&&t.negative!==0?(p=this.divmod(t.neg(),i),i!=="mod"&&(f=p.div.neg()),{div:f,mod:p.mod}):this.negative&t.negative?(p=this.neg().divmod(t.neg(),i),i!=="div"&&(l=p.mod.neg(),o&&l.negative!==0&&l.isub(t)),{div:p.div,mod:l}):t.length>this.length||this.cmp(t)<0?{div:new a(0),mod:this}:t.length===1?i==="div"?{div:this.divn(t.words[0]),mod:null}:i==="mod"?{div:null,mod:new a(this.modn(t.words[0]))}:{div:this.divn(t.words[0]),mod:new a(this.modn(t.words[0]))}:this._wordDiv(t,i)},a.prototype.div=function(t){return this.divmod(t,"div",!1).div},a.prototype.mod=function(t){return this.divmod(t,"mod",!1).mod},a.prototype.umod=function(t){return this.divmod(t,"mod",!0).mod},a.prototype.divRound=function(t){var i=this.divmod(t);if(i.mod.isZero())return i.div;var o=i.div.negative!==0?i.mod.isub(t):i.mod,f=t.ushrn(1),l=t.andln(1),p=o.cmp(f);return p<0||l===1&&p===0?i.div:i.div.negative!==0?i.div.isubn(1):i.div.iaddn(1)},a.prototype.modn=function(t){h(t<=67108863);for(var i=(1<<26)%t,o=0,f=this.length-1;f>=0;f--)o=(i*o+(this.words[f]|0))%t;return o},a.prototype.idivn=function(t){h(t<=67108863);for(var i=0,o=this.length-1;o>=0;o--){var f=(this.words[o]|0)+i*67108864;this.words[o]=f/t|0,i=f%t}return this.strip()},a.prototype.divn=function(t){return this.clone().idivn(t)},a.prototype.egcd=function(t){h(t.negative===0),h(!t.isZero());var i=this,o=t.clone();i.negative!==0?i=i.umod(t):i=i.clone();for(var f=new a(1),l=new a(0),p=new a(0),m=new a(1),c=0;i.isEven()&&o.isEven();)i.iushrn(1),o.iushrn(1),++c;for(var r=o.clone(),u=i.clone();!i.isZero();){for(var b=0,S=1;!(i.words[0]&S)&&b<26;++b,S<<=1);if(b>0)for(i.iushrn(b);b-- >0;)(f.isOdd()||l.isOdd())&&(f.iadd(r),l.isub(u)),f.iushrn(1),l.iushrn(1);for(var x=0,I=1;!(o.words[0]&I)&&x<26;++x,I<<=1);if(x>0)for(o.iushrn(x);x-- >0;)(p.isOdd()||m.isOdd())&&(p.iadd(r),m.isub(u)),p.iushrn(1),m.iushrn(1);i.cmp(o)>=0?(i.isub(o),f.isub(p),l.isub(m)):(o.isub(i),p.isub(f),m.isub(l))}return{a:p,b:m,gcd:o.iushln(c)}},a.prototype._invmp=function(t){h(t.negative===0),h(!t.isZero());var i=this,o=t.clone();i.negative!==0?i=i.umod(t):i=i.clone();for(var f=new a(1),l=new a(0),p=o.clone();i.cmpn(1)>0&&o.cmpn(1)>0;){for(var m=0,c=1;!(i.words[0]&c)&&m<26;++m,c<<=1);if(m>0)for(i.iushrn(m);m-- >0;)f.isOdd()&&f.iadd(p),f.iushrn(1);for(var r=0,u=1;!(o.words[0]&u)&&r<26;++r,u<<=1);if(r>0)for(o.iushrn(r);r-- >0;)l.isOdd()&&l.iadd(p),l.iushrn(1);i.cmp(o)>=0?(i.isub(o),f.isub(l)):(o.isub(i),l.isub(f))}var b;return i.cmpn(1)===0?b=f:b=l,b.cmpn(0)<0&&b.iadd(t),b},a.prototype.gcd=function(t){if(this.isZero())return t.abs();if(t.isZero())return this.abs();var i=this.clone(),o=t.clone();i.negative=0,o.negative=0;for(var f=0;i.isEven()&&o.isEven();f++)i.iushrn(1),o.iushrn(1);do{for(;i.isEven();)i.iushrn(1);for(;o.isEven();)o.iushrn(1);var l=i.cmp(o);if(l<0){var p=i;i=o,o=p}else if(l===0||o.cmpn(1)===0)break;i.isub(o)}while(!0);return o.iushln(f)},a.prototype.invm=function(t){return this.egcd(t).a.umod(t)},a.prototype.isEven=function(){return(this.words[0]&1)===0},a.prototype.isOdd=function(){return(this.words[0]&1)===1},a.prototype.andln=function(t){return this.words[0]&t},a.prototype.bincn=function(t){h(typeof t=="number");var i=t%26,o=(t-i)/26,f=1<<i;if(this.length<=o)return this._expand(o+1),this.words[o]|=f,this;for(var l=f,p=o;l!==0&&p<this.length;p++){var m=this.words[p]|0;m+=l,l=m>>>26,m&=67108863,this.words[p]=m}return l!==0&&(this.words[p]=l,this.length++),this},a.prototype.isZero=function(){return this.length===1&&this.words[0]===0},a.prototype.cmpn=function(t){var i=t<0;if(this.negative!==0&&!i)return-1;if(this.negative===0&&i)return 1;this.strip();var o;if(this.length>1)o=1;else{i&&(t=-t),h(t<=67108863,"Number is too big");var f=this.words[0]|0;o=f===t?0:f<t?-1:1}return this.negative!==0?-o|0:o},a.prototype.cmp=function(t){if(this.negative!==0&&t.negative===0)return-1;if(this.negative===0&&t.negative!==0)return 1;var i=this.ucmp(t);return this.negative!==0?-i|0:i},a.prototype.ucmp=function(t){if(this.length>t.length)return 1;if(this.length<t.length)return-1;for(var i=0,o=this.length-1;o>=0;o--){var f=this.words[o]|0,l=t.words[o]|0;if(f!==l){f<l?i=-1:f>l&&(i=1);break}}return i},a.prototype.gtn=function(t){return this.cmpn(t)===1},a.prototype.gt=function(t){return this.cmp(t)===1},a.prototype.gten=function(t){return this.cmpn(t)>=0},a.prototype.gte=function(t){return this.cmp(t)>=0},a.prototype.ltn=function(t){return this.cmpn(t)===-1},a.prototype.lt=function(t){return this.cmp(t)===-1},a.prototype.lten=function(t){return this.cmpn(t)<=0},a.prototype.lte=function(t){return this.cmp(t)<=0},a.prototype.eqn=function(t){return this.cmpn(t)===0},a.prototype.eq=function(t){return this.cmp(t)===0},a.red=function(t){return new j(t)},a.prototype.toRed=function(t){return h(!this.red,"Already a number in reduction context"),h(this.negative===0,"red works only with positives"),t.convertTo(this)._forceRed(t)},a.prototype.fromRed=function(){return h(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(t){return this.red=t,this},a.prototype.forceRed=function(t){return h(!this.red,"Already a number in reduction context"),this._forceRed(t)},a.prototype.redAdd=function(t){return h(this.red,"redAdd works only with red numbers"),this.red.add(this,t)},a.prototype.redIAdd=function(t){return h(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,t)},a.prototype.redSub=function(t){return h(this.red,"redSub works only with red numbers"),this.red.sub(this,t)},a.prototype.redISub=function(t){return h(this.red,"redISub works only with red numbers"),this.red.isub(this,t)},a.prototype.redShl=function(t){return h(this.red,"redShl works only with red numbers"),this.red.shl(this,t)},a.prototype.redMul=function(t){return h(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.mul(this,t)},a.prototype.redIMul=function(t){return h(this.red,"redMul works only with red numbers"),this.red._verify2(this,t),this.red.imul(this,t)},a.prototype.redSqr=function(){return h(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return h(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return h(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return h(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return h(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(t){return h(this.red&&!t.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,t)};var M={k256:null,p224:null,p192:null,p25519:null};function _(d,t){this.name=d,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}_.prototype._tmp=function(){var t=new a(null);return t.words=new Array(Math.ceil(this.n/13)),t},_.prototype.ireduce=function(t){var i=t,o;do this.split(i,this.tmp),i=this.imulK(i),i=i.iadd(this.tmp),o=i.bitLength();while(o>this.n);var f=o<this.n?-1:i.ucmp(this.p);return f===0?(i.words[0]=0,i.length=1):f>0?i.isub(this.p):i.strip(),i},_.prototype.split=function(t,i){t.iushrn(this.n,0,i)},_.prototype.imulK=function(t){return t.imul(this.k)};function k(){_.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}g(k,_),k.prototype.split=function(t,i){for(var o=4194303,f=Math.min(t.length,9),l=0;l<f;l++)i.words[l]=t.words[l];if(i.length=f,t.length<=9){t.words[0]=0,t.length=1;return}var p=t.words[9];for(i.words[i.length++]=p&o,l=10;l<t.length;l++){var m=t.words[l]|0;t.words[l-10]=(m&o)<<4|p>>>22,p=m}p>>>=22,t.words[l-10]=p,p===0&&t.length>10?t.length-=10:t.length-=9},k.prototype.imulK=function(t){t.words[t.length]=0,t.words[t.length+1]=0,t.length+=2;for(var i=0,o=0;o<t.length;o++){var f=t.words[o]|0;i+=f*977,t.words[o]=i&67108863,i=f*64+(i/67108864|0)}return t.words[t.length-1]===0&&(t.length--,t.words[t.length-1]===0&&t.length--),t};function U(){_.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}g(U,_);function T(){_.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}g(T,_);function Ot(){_.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}g(Ot,_),Ot.prototype.imulK=function(t){for(var i=0,o=0;o<t.length;o++){var f=(t.words[o]|0)*19+i,l=f&67108863;f>>>=26,t.words[o]=l,i=f}return i!==0&&(t.words[t.length++]=i),t},a._prime=function(t){if(M[t])return M[t];var i;if(t==="k256")i=new k;else if(t==="p224")i=new U;else if(t==="p192")i=new T;else if(t==="p25519")i=new Ot;else throw new Error("Unknown prime "+t);return M[t]=i,i};function j(d){if(typeof d=="string"){var t=a._prime(d);this.m=t.p,this.prime=t}else h(d.gtn(1),"modulus must be greater than 1"),this.m=d,this.prime=null}j.prototype._verify1=function(t){h(t.negative===0,"red works only with positives"),h(t.red,"red works only with red numbers")},j.prototype._verify2=function(t,i){h((t.negative|i.negative)===0,"red works only with positives"),h(t.red&&t.red===i.red,"red works only with red numbers")},j.prototype.imod=function(t){return this.prime?this.prime.ireduce(t)._forceRed(this):t.umod(this.m)._forceRed(this)},j.prototype.neg=function(t){return t.isZero()?t.clone():this.m.sub(t)._forceRed(this)},j.prototype.add=function(t,i){this._verify2(t,i);var o=t.add(i);return o.cmp(this.m)>=0&&o.isub(this.m),o._forceRed(this)},j.prototype.iadd=function(t,i){this._verify2(t,i);var o=t.iadd(i);return o.cmp(this.m)>=0&&o.isub(this.m),o},j.prototype.sub=function(t,i){this._verify2(t,i);var o=t.sub(i);return o.cmpn(0)<0&&o.iadd(this.m),o._forceRed(this)},j.prototype.isub=function(t,i){this._verify2(t,i);var o=t.isub(i);return o.cmpn(0)<0&&o.iadd(this.m),o},j.prototype.shl=function(t,i){return this._verify1(t),this.imod(t.ushln(i))},j.prototype.imul=function(t,i){return this._verify2(t,i),this.imod(t.imul(i))},j.prototype.mul=function(t,i){return this._verify2(t,i),this.imod(t.mul(i))},j.prototype.isqr=function(t){return this.imul(t,t.clone())},j.prototype.sqr=function(t){return this.mul(t,t)},j.prototype.sqrt=function(t){if(t.isZero())return t.clone();var i=this.m.andln(3);if(h(i%2===1),i===3){var o=this.m.add(new a(1)).iushrn(2);return this.pow(t,o)}for(var f=this.m.subn(1),l=0;!f.isZero()&&f.andln(1)===0;)l++,f.iushrn(1);h(!f.isZero());var p=new a(1).toRed(this),m=p.redNeg(),c=this.m.subn(1).iushrn(1),r=this.m.bitLength();for(r=new a(2*r*r).toRed(this);this.pow(r,c).cmp(m)!==0;)r.redIAdd(m);for(var u=this.pow(r,f),b=this.pow(t,f.addn(1).iushrn(1)),S=this.pow(t,f),x=l;S.cmp(p)!==0;){for(var I=S,N=0;I.cmp(p)!==0;N++)I=I.redSqr();h(N<x);var L=this.pow(u,new a(1).iushln(x-N-1));b=b.redMul(L),u=L.redSqr(),S=S.redMul(u),x=N}return b},j.prototype.invm=function(t){var i=t._invmp(this.m);return i.negative!==0?(i.negative=0,this.imod(i).redNeg()):this.imod(i)},j.prototype.pow=function(t,i){if(i.isZero())return new a(1).toRed(this);if(i.cmpn(1)===0)return t.clone();var o=4,f=new Array(1<<o);f[0]=new a(1).toRed(this),f[1]=t;for(var l=2;l<f.length;l++)f[l]=this.mul(f[l-1],t);var p=f[0],m=0,c=0,r=i.bitLength()%26;for(r===0&&(r=26),l=i.length-1;l>=0;l--){for(var u=i.words[l],b=r-1;b>=0;b--){var S=u>>b&1;if(p!==f[0]&&(p=this.sqr(p)),S===0&&m===0){c=0;continue}m<<=1,m|=S,c++,!(c!==o&&(l!==0||b!==0))&&(p=this.mul(p,f[m]),c=0,m=0)}r=26}return p},j.prototype.convertTo=function(t){var i=t.umod(this.m);return i===t?i.clone():i},j.prototype.convertFrom=function(t){var i=t.clone();return i.red=null,i},a.mont=function(t){return new Lt(t)};function Lt(d){j.call(this,d),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}g(Lt,j),Lt.prototype.convertTo=function(t){return this.imod(t.ushln(this.shift))},Lt.prototype.convertFrom=function(t){var i=this.imod(t.mul(this.rinv));return i.red=null,i},Lt.prototype.imul=function(t,i){if(t.isZero()||i.isZero())return t.words[0]=0,t.length=1,t;var o=t.imul(i),f=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),l=o.isub(f).iushrn(this.shift),p=l;return l.cmp(this.m)>=0?p=l.isub(this.m):l.cmpn(0)<0&&(p=l.iadd(this.m)),p._forceRed(this)},Lt.prototype.mul=function(t,i){if(t.isZero()||i.isZero())return new a(0)._forceRed(this);var o=t.mul(i),f=o.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),l=o.isub(f).iushrn(this.shift),p=l;return l.cmp(this.m)>=0?p=l.isub(this.m):l.cmpn(0)<0&&(p=l.iadd(this.m)),p._forceRed(this)},Lt.prototype.invm=function(t){var i=this.imod(t._invmp(this.m).mul(this.r2));return i._forceRed(this)}})(n,Wt)})(Pe);var Vn=Pe.exports;const zn=Mr(Vn);var Qn=Le;Le.strict=kr;Le.loose=Tr;var Yn=Object.prototype.toString,Xn={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function Le(n){return kr(n)||Tr(n)}function kr(n){return n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray||n instanceof Uint16Array||n instanceof Uint32Array||n instanceof Float32Array||n instanceof Float64Array}function Tr(n){return Xn[Yn.call(n)]}var ti=Qn.strict,ei=function(e){if(ti(e)){var s=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(s=s.slice(e.byteOffset,e.byteOffset+e.byteLength)),s}else return Buffer.from(e)};const ri=Mr(ei),Cr="hex",Ar="utf8",ee="0";function $t(n){return new Uint8Array(n)}function Nr(n,e=!1){const s=n.toString(Cr);return e?Jt(s):s}function ni(n){return n.toString(Ar)}function re(n){return ri(n)}function Ut(n,e=!1){return Nr(re(n),e)}function ii(n){return ni(re(n))}function si(n){return Buffer.from(qt(n),Cr)}function jt(n){return $t(si(n))}function Be(n){return Buffer.from(n,Ar)}function oi(n){return $t(Be(n))}function ai(n,e=!1){return Nr(Be(n),e)}function hi(n,e){return!(typeof n!="string"||!n.match(/^0x[0-9A-Fa-f]*$/)||e&&n.length!==2+2*e)}function qr(...n){let e=[];return n.forEach(s=>e=e.concat(Array.from(s))),new Uint8Array([...e])}function fi(n,e=8){const s=n%e;return s?(n-s)/e*e+e:n}function ci(n,e=8,s=ee){return ui(n,fi(n.length,e),s)}function ui(n,e,s=ee){return di(n,e,!0,s)}function qt(n){return n.replace(/^0x/,"")}function Jt(n){return n.startsWith("0x")?n:`0x${n}`}function Pr(n){return n=qt(n),n=ci(n,2),n&&(n=Jt(n)),n}function li(n){const e=n.startsWith("0x");return n=qt(n),n=n.startsWith(ee)?n.substring(1):n,e?Jt(n):n}function di(n,e,s,h=ee){const g=e-n.length;let a=n;if(g>0){const y=h.repeat(g);a=s?y+n:n+y}return a}function Re(n){return re(new Uint8Array(n))}function pi(n,e){return Ut(new Uint8Array(n),!e)}function gi(n){return $t(n).buffer}function mi(n){return Be(n)}function vi(n,e){return ai(n,!e)}function wi(n){return jt(n).buffer}function Lr(n,e){const s=qt(Pr(new zn(n).toString(16)));return e?s:Jt(s)}var Kt={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xe=function(n,e){return xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,h){s.__proto__=h}||function(s,h){for(var g in h)h.hasOwnProperty(g)&&(s[g]=h[g])},xe(n,e)};function yi(n,e){xe(n,e);function s(){this.constructor=n}n.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}var Ee=function(){return Ee=Object.assign||function(e){for(var s,h=1,g=arguments.length;h<g;h++){s=arguments[h];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},Ee.apply(this,arguments)};function _i(n,e){var s={};for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&e.indexOf(h)<0&&(s[h]=n[h]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var g=0,h=Object.getOwnPropertySymbols(n);g<h.length;g++)e.indexOf(h[g])<0&&Object.prototype.propertyIsEnumerable.call(n,h[g])&&(s[h[g]]=n[h[g]]);return s}function Mi(n,e,s,h){var g=arguments.length,a=g<3?e:h===null?h=Object.getOwnPropertyDescriptor(e,s):h,y;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(n,e,s,h);else for(var O=n.length-1;O>=0;O--)(y=n[O])&&(a=(g<3?y(a):g>3?y(e,s,a):y(e,s))||a);return g>3&&a&&Object.defineProperty(e,s,a),a}function bi(n,e){return function(s,h){e(s,h,n)}}function Si(n,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,e)}function Oi(n,e,s,h){function g(a){return a instanceof s?a:new s(function(y){y(a)})}return new(s||(s=Promise))(function(a,y){function O(q){try{R(h.next(q))}catch(A){y(A)}}function E(q){try{R(h.throw(q))}catch(A){y(A)}}function R(q){q.done?a(q.value):g(q.value).then(O,E)}R((h=h.apply(n,e||[])).next())})}function Ri(n,e){var s={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},h,g,a,y;return y={next:O(0),throw:O(1),return:O(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function O(R){return function(q){return E([R,q])}}function E(R){if(h)throw new TypeError("Generator is already executing.");for(;s;)try{if(h=1,g&&(a=R[0]&2?g.return:R[0]?g.throw||((a=g.return)&&a.call(g),0):g.next)&&!(a=a.call(g,R[1])).done)return a;switch(g=0,a&&(R=[R[0]&2,a.value]),R[0]){case 0:case 1:a=R;break;case 4:return s.label++,{value:R[1],done:!1};case 5:s.label++,g=R[1],R=[0];continue;case 7:R=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(R[0]===6||R[0]===2)){s=0;continue}if(R[0]===3&&(!a||R[1]>a[0]&&R[1]<a[3])){s.label=R[1];break}if(R[0]===6&&s.label<a[1]){s.label=a[1],a=R;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(R);break}a[2]&&s.ops.pop(),s.trys.pop();continue}R=e.call(n,s)}catch(q){R=[6,q],g=0}finally{h=a=0}if(R[0]&5)throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}}function xi(n,e,s,h){h===void 0&&(h=s),n[h]=e[s]}function Ei(n,e){for(var s in n)s!=="default"&&!e.hasOwnProperty(s)&&(e[s]=n[s])}function Ie(n){var e=typeof Symbol=="function"&&Symbol.iterator,s=e&&n[e],h=0;if(s)return s.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&h>=n.length&&(n=void 0),{value:n&&n[h++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Br(n,e){var s=typeof Symbol=="function"&&n[Symbol.iterator];if(!s)return n;var h=s.call(n),g,a=[],y;try{for(;(e===void 0||e-- >0)&&!(g=h.next()).done;)a.push(g.value)}catch(O){y={error:O}}finally{try{g&&!g.done&&(s=h.return)&&s.call(h)}finally{if(y)throw y.error}}return a}function Ii(){for(var n=[],e=0;e<arguments.length;e++)n=n.concat(Br(arguments[e]));return n}function ki(){for(var n=0,e=0,s=arguments.length;e<s;e++)n+=arguments[e].length;for(var h=Array(n),g=0,e=0;e<s;e++)for(var a=arguments[e],y=0,O=a.length;y<O;y++,g++)h[g]=a[y];return h}function Qt(n){return this instanceof Qt?(this.v=n,this):new Qt(n)}function Ti(n,e,s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var h=s.apply(n,e||[]),g,a=[];return g={},y("next"),y("throw"),y("return"),g[Symbol.asyncIterator]=function(){return this},g;function y(C){h[C]&&(g[C]=function(P){return new Promise(function(St,Rt){a.push([C,P,St,Rt])>1||O(C,P)})})}function O(C,P){try{E(h[C](P))}catch(St){A(a[0][3],St)}}function E(C){C.value instanceof Qt?Promise.resolve(C.value.v).then(R,q):A(a[0][2],C)}function R(C){O("next",C)}function q(C){O("throw",C)}function A(C,P){C(P),a.shift(),a.length&&O(a[0][0],a[0][1])}}function Ci(n){var e,s;return e={},h("next"),h("throw",function(g){throw g}),h("return"),e[Symbol.iterator]=function(){return this},e;function h(g,a){e[g]=n[g]?function(y){return(s=!s)?{value:Qt(n[g](y)),done:g==="return"}:a?a(y):y}:a}}function Ai(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],s;return e?e.call(n):(n=typeof Ie=="function"?Ie(n):n[Symbol.iterator](),s={},h("next"),h("throw"),h("return"),s[Symbol.asyncIterator]=function(){return this},s);function h(a){s[a]=n[a]&&function(y){return new Promise(function(O,E){y=n[a](y),g(O,E,y.done,y.value)})}}function g(a,y,O,E){Promise.resolve(E).then(function(R){a({value:R,done:O})},y)}}function Ni(n,e){return Object.defineProperty?Object.defineProperty(n,"raw",{value:e}):n.raw=e,n}function qi(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var s in n)Object.hasOwnProperty.call(n,s)&&(e[s]=n[s]);return e.default=n,e}function Pi(n){return n&&n.__esModule?n:{default:n}}function Li(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)}function Bi(n,e,s){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,s),s}const Wi=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Ee},__asyncDelegator:Ci,__asyncGenerator:Ti,__asyncValues:Ai,__await:Qt,__awaiter:Oi,__classPrivateFieldGet:Li,__classPrivateFieldSet:Bi,__createBinding:xi,__decorate:Mi,__exportStar:Ei,__extends:yi,__generator:Ri,__importDefault:Pi,__importStar:qi,__makeTemplateObject:Ni,__metadata:Si,__param:bi,__read:Br,__rest:_i,__spread:Ii,__spreadArrays:ki,__values:Ie},Symbol.toStringTag,{value:"Module"})),Fi=Gr(Wi);var Tt={},ur;function Di(){if(ur)return Tt;ur=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.isBrowserCryptoAvailable=Tt.getSubtleCrypto=Tt.getBrowerCrypto=void 0;function n(){return(Wt===null||Wt===void 0?void 0:Wt.crypto)||(Wt===null||Wt===void 0?void 0:Wt.msCrypto)||{}}Tt.getBrowerCrypto=n;function e(){const h=n();return h.subtle||h.webkitSubtle}Tt.getSubtleCrypto=e;function s(){return!!n()&&!!e()}return Tt.isBrowserCryptoAvailable=s,Tt}var Ct={},lr;function Ui(){if(lr)return Ct;lr=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.isBrowser=Ct.isNode=Ct.isReactNative=void 0;function n(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ct.isReactNative=n;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ct.isNode=e;function s(){return!n()&&!e()}return Ct.isBrowser=s,Ct}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const e=Fi;e.__exportStar(Di(),n),e.__exportStar(Ui(),n)})(Kt);function ji(n=3){const e=Date.now()*Math.pow(10,n),s=Math.floor(Math.random()*Math.pow(10,n));return e+s}function Xt(n){return Pr(n)}function $i(n){return li(Jt(n))}const Hi=ji;function be(){return((e,s)=>{for(s=e="";e++<36;s+=e*51&52?(e^15?8^Math.random()*(e^20?16:4):4).toString(16):"-");return s})()}function Zi(n){return n===""||typeof n=="string"&&n.trim()===""}function Ji(n){return!(n&&n.length)}function Wr(n,e){return hi(n,e)}function Ki(n){return typeof n.method<"u"}function Vt(n){return typeof n.result<"u"}function te(n){return typeof n.error<"u"}function dr(n){return typeof n.event<"u"}function Gi(n){return Gn.includes(n)||n.startsWith("wc_")}function Vi(n){return n.method.startsWith("wc_")?!0:!Ir.includes(n.method)}function zi(n){n=qt(n.toLowerCase());const e=qt(Vr.keccak_256(mi(n)));let s="";for(let h=0;h<n.length;h++)parseInt(e[h],16)>7?s+=n[h].toUpperCase():s+=n[h];return Jt(s)}const Qi=n=>n?n.toLowerCase().substring(0,2)!=="0x"?!1:/^(0x)?[0-9a-f]{40}$/i.test(n)?/^(0x)?[0-9a-f]{40}$/.test(n)||/^(0x)?[0-9A-F]{40}$/.test(n)?!0:n===zi(n):!1:!1;function pr(n){return!Ji(n)&&!Wr(n[0])&&(n[0]=vi(n[0])),n}function Se(n){if(typeof n.type<"u"&&n.type!=="0")return n;if(typeof n.from>"u"||!Qi(n.from))throw new Error("Transaction object must include a valid 'from' value.");function e(g){let a=g;return(typeof g=="number"||typeof g=="string"&&!Zi(g))&&(Wr(g)?typeof g=="string"&&(a=Xt(g)):a=Lr(g)),typeof a=="string"&&(a=$i(a)),a}const s={from:Xt(n.from),to:typeof n.to>"u"?void 0:Xt(n.to),gasPrice:typeof n.gasPrice>"u"?"":e(n.gasPrice),gas:typeof n.gas>"u"?typeof n.gasLimit>"u"?"":e(n.gasLimit):e(n.gas),value:typeof n.value>"u"?"":e(n.value),nonce:typeof n.nonce>"u"?"":e(n.nonce),data:typeof n.data>"u"?"":Xt(n.data)||"0x"},h=["gasPrice","gas","value","nonce"];return Object.keys(s).forEach(g=>{(typeof s[g]>"u"||typeof s[g]=="string"&&!s[g].trim().length)&&h.includes(g)&&delete s[g]}),s}function Yi(n){const e=n.message||"Failed or Rejected Request";let s=-32e3;if(n&&!n.code)switch(e){case"Parse error":s=-32700;break;case"Invalid request":s=-32600;break;case"Method not found":s=-32601;break;case"Invalid params":s=-32602;break;case"Internal error":s=-32603;break;default:s=-32e3;break}const h={code:s,message:e};return n.data&&(h.data=n.data),h}var We={},Xi=n=>encodeURIComponent(n).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Fr="%[a-f0-9]{2}",gr=new RegExp("("+Fr+")|([^%]+?)","gi"),mr=new RegExp("("+Fr+")+","gi");function ke(n,e){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;e=e||1;var s=n.slice(0,e),h=n.slice(e);return Array.prototype.concat.call([],ke(s),ke(h))}function ts(n){try{return decodeURIComponent(n)}catch{for(var e=n.match(gr)||[],s=1;s<e.length;s++)n=ke(e,s).join(""),e=n.match(gr)||[];return n}}function es(n){for(var e={"%FE%FF":"","%FF%FE":""},s=mr.exec(n);s;){try{e[s[0]]=decodeURIComponent(s[0])}catch{var h=ts(s[0]);h!==s[0]&&(e[s[0]]=h)}s=mr.exec(n)}e["%C2"]="";for(var g=Object.keys(e),a=0;a<g.length;a++){var y=g[a];n=n.replace(new RegExp(y,"g"),e[y])}return n}var rs=function(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return n=n.replace(/\+/g," "),decodeURIComponent(n)}catch{return es(n)}},ns=(n,e)=>{if(!(typeof n=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[n];const s=n.indexOf(e);return s===-1?[n]:[n.slice(0,s),n.slice(s+e.length)]};(function(n){const e=Xi,s=rs,h=ns,g=v=>v==null;function a(v){switch(v.arrayFormat){case"index":return w=>(M,_)=>{const k=M.length;return _===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?M:_===null?[...M,[E(w,v),"[",k,"]"].join("")]:[...M,[E(w,v),"[",E(k,v),"]=",E(_,v)].join("")]};case"bracket":return w=>(M,_)=>_===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?M:_===null?[...M,[E(w,v),"[]"].join("")]:[...M,[E(w,v),"[]=",E(_,v)].join("")];case"comma":case"separator":return w=>(M,_)=>_==null||_.length===0?M:M.length===0?[[E(w,v),"=",E(_,v)].join("")]:[[M,E(_,v)].join(v.arrayFormatSeparator)];default:return w=>(M,_)=>_===void 0||v.skipNull&&_===null||v.skipEmptyString&&_===""?M:_===null?[...M,E(w,v)]:[...M,[E(w,v),"=",E(_,v)].join("")]}}function y(v){let w;switch(v.arrayFormat){case"index":return(M,_,k)=>{if(w=/\[(\d*)\]$/.exec(M),M=M.replace(/\[\d*\]$/,""),!w){k[M]=_;return}k[M]===void 0&&(k[M]={}),k[M][w[1]]=_};case"bracket":return(M,_,k)=>{if(w=/(\[\])$/.exec(M),M=M.replace(/\[\]$/,""),!w){k[M]=_;return}if(k[M]===void 0){k[M]=[_];return}k[M]=[].concat(k[M],_)};case"comma":case"separator":return(M,_,k)=>{const T=typeof _=="string"&&_.split("").indexOf(v.arrayFormatSeparator)>-1?_.split(v.arrayFormatSeparator).map(Ot=>R(Ot,v)):_===null?_:R(_,v);k[M]=T};default:return(M,_,k)=>{if(k[M]===void 0){k[M]=_;return}k[M]=[].concat(k[M],_)}}}function O(v){if(typeof v!="string"||v.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function E(v,w){return w.encode?w.strict?e(v):encodeURIComponent(v):v}function R(v,w){return w.decode?s(v):v}function q(v){return Array.isArray(v)?v.sort():typeof v=="object"?q(Object.keys(v)).sort((w,M)=>Number(w)-Number(M)).map(w=>v[w]):v}function A(v){const w=v.indexOf("#");return w!==-1&&(v=v.slice(0,w)),v}function C(v){let w="";const M=v.indexOf("#");return M!==-1&&(w=v.slice(M)),w}function P(v){v=A(v);const w=v.indexOf("?");return w===-1?"":v.slice(w+1)}function St(v,w){return w.parseNumbers&&!Number.isNaN(Number(v))&&typeof v=="string"&&v.trim()!==""?v=Number(v):w.parseBooleans&&v!==null&&(v.toLowerCase()==="true"||v.toLowerCase()==="false")&&(v=v.toLowerCase()==="true"),v}function Rt(v,w){w=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},w),O(w.arrayFormatSeparator);const M=y(w),_=Object.create(null);if(typeof v!="string"||(v=v.trim().replace(/^[?#&]/,""),!v))return _;for(const k of v.split("&")){let[U,T]=h(w.decode?k.replace(/\+/g," "):k,"=");T=T===void 0?null:["comma","separator"].includes(w.arrayFormat)?T:R(T,w),M(R(U,w),T,_)}for(const k of Object.keys(_)){const U=_[k];if(typeof U=="object"&&U!==null)for(const T of Object.keys(U))U[T]=St(U[T],w);else _[k]=St(U,w)}return w.sort===!1?_:(w.sort===!0?Object.keys(_).sort():Object.keys(_).sort(w.sort)).reduce((k,U)=>{const T=_[U];return T&&typeof T=="object"&&!Array.isArray(T)?k[U]=q(T):k[U]=T,k},Object.create(null))}n.extract=P,n.parse=Rt,n.stringify=(v,w)=>{if(!v)return"";w=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},w),O(w.arrayFormatSeparator);const M=T=>w.skipNull&&g(v[T])||w.skipEmptyString&&v[T]==="",_=a(w),k={};for(const T of Object.keys(v))M(T)||(k[T]=v[T]);const U=Object.keys(k);return w.sort!==!1&&U.sort(w.sort),U.map(T=>{const Ot=v[T];return Ot===void 0?"":Ot===null?E(T,w):Array.isArray(Ot)?Ot.reduce(_(T),[]).join("&"):E(T,w)+"="+E(Ot,w)}).filter(T=>T.length>0).join("&")},n.parseUrl=(v,w)=>{w=Object.assign({decode:!0},w);const[M,_]=h(v,"#");return Object.assign({url:M.split("?")[0]||"",query:Rt(P(v),w)},w&&w.parseFragmentIdentifier&&_?{fragmentIdentifier:R(_,w)}:{})},n.stringifyUrl=(v,w)=>{w=Object.assign({encode:!0,strict:!0},w);const M=A(v.url).split("?")[0]||"",_=n.extract(v.url),k=n.parse(_,{sort:!1}),U=Object.assign(k,v.query);let T=n.stringify(U,w);T&&(T=`?${T}`);let Ot=C(v.url);return v.fragmentIdentifier&&(Ot=`#${E(v.fragmentIdentifier,w)}`),`${M}${T}${Ot}`}})(We);function is(n){const e=n.indexOf("?")!==-1?n.indexOf("?"):void 0;return typeof e<"u"?n.substr(e):""}function ss(n,e){let s=Dr(n);return s=Object.assign(Object.assign({},s),e),n=os(s),n}function Dr(n){return We.parse(n)}function os(n){return We.stringify(n)}function as(n){return typeof n.bridge<"u"}function hs(n){const e=n.indexOf(":"),s=n.indexOf("?")!==-1?n.indexOf("?"):void 0,h=n.substring(0,e),g=n.substring(e+1,s);function a(A){const P=A.split("@");return{handshakeTopic:P[0],version:parseInt(P[1],10)}}const y=a(g),O=typeof s<"u"?n.substr(s):"";function E(A){const C=Dr(A);return{key:C.key||"",bridge:C.bridge||""}}const R=E(O);return Object.assign(Object.assign({protocol:h},y),R)}class fs{constructor(){this._eventEmitters=[],typeof window<"u"&&typeof window.addEventListener<"u"&&(window.addEventListener("online",()=>this.trigger("online")),window.addEventListener("offline",()=>this.trigger("offline")))}on(e,s){this._eventEmitters.push({event:e,callback:s})}trigger(e){let s=[];e&&(s=this._eventEmitters.filter(h=>h.event===e)),s.forEach(h=>{h.callback()})}}const cs=typeof global.WebSocket<"u"?global.WebSocket:require("ws");class us{constructor(e){if(this.opts=e,this._queue=[],this._events=[],this._subscriptions=[],this._protocol=e.protocol,this._version=e.version,this._url="",this._netMonitor=null,this._socket=null,this._nextSocket=null,this._subscriptions=e.subscriptions||[],this._netMonitor=e.netMonitor||new fs,!e.url||typeof e.url!="string")throw new Error("Missing or invalid WebSocket url");this._url=e.url,this._netMonitor.on("online",()=>this._socketCreate())}set readyState(e){}get readyState(){return this._socket?this._socket.readyState:-1}set connecting(e){}get connecting(){return this.readyState===0}set connected(e){}get connected(){return this.readyState===1}set closing(e){}get closing(){return this.readyState===2}set closed(e){}get closed(){return this.readyState===3}open(){this._socketCreate()}close(){this._socketClose()}send(e,s,h){if(!s||typeof s!="string")throw new Error("Missing or invalid topic field");this._socketSend({topic:s,type:"pub",payload:e,silent:!!h})}subscribe(e){this._socketSend({topic:e,type:"sub",payload:"",silent:!0})}on(e,s){this._events.push({event:e,callback:s})}_socketCreate(){if(this._nextSocket)return;const e=ls(this._url,this._protocol,this._version);if(this._nextSocket=new cs(e),!this._nextSocket)throw new Error("Failed to create socket");this._nextSocket.onmessage=s=>this._socketReceive(s),this._nextSocket.onopen=()=>this._socketOpen(),this._nextSocket.onerror=s=>this._socketError(s),this._nextSocket.onclose=()=>{setTimeout(()=>{this._nextSocket=null,this._socketCreate()},1e3)}}_socketOpen(){this._socketClose(),this._socket=this._nextSocket,this._nextSocket=null,this._queueSubscriptions(),this._pushQueue()}_socketClose(){this._socket&&(this._socket.onclose=()=>{},this._socket.close())}_socketSend(e){const s=JSON.stringify(e);this._socket&&this._socket.readyState===1?this._socket.send(s):(this._setToQueue(e),this._socketCreate())}async _socketReceive(e){let s;try{s=JSON.parse(e.data)}catch{return}if(this._socketSend({topic:s.topic,type:"ack",payload:"",silent:!0}),this._socket&&this._socket.readyState===1){const h=this._events.filter(g=>g.event==="message");h&&h.length&&h.forEach(g=>g.callback(s))}}_socketError(e){const s=this._events.filter(h=>h.event==="error");s&&s.length&&s.forEach(h=>h.callback(e))}_queueSubscriptions(){this._subscriptions.forEach(s=>this._queue.push({topic:s,type:"sub",payload:"",silent:!0})),this._subscriptions=this.opts.subscriptions||[]}_setToQueue(e){this._queue.push(e)}_pushQueue(){this._queue.forEach(s=>this._socketSend(s)),this._queue=[]}}function ls(n,e,s){var h,g;const y=(n.startsWith("https")?n.replace("https","wss"):n.startsWith("http")?n.replace("http","ws"):n).split("?"),O=Dn()?{protocol:e,version:s,env:"browser",host:((h=jn())===null||h===void 0?void 0:h.host)||""}:{protocol:e,version:s,env:((g=Ae())===null||g===void 0?void 0:g.name)||""},E=ss(is(y[1]||""),O);return y[0]+"?"+E}const Oe="Session currently connected",Bt="Session currently disconnected",ds="Session Rejected",ps="Missing JSON RPC response",gs='JSON-RPC success response must include "result" field',ms='JSON-RPC error response must include "error" field',vs='JSON RPC request must have valid "method" value',ws='JSON RPC request must have valid "id" value',ys="Missing one of the required parameters: bridge / uri / session",vr="JSON RPC response format is invalid",_s="URI format is invalid",Ms="QRCode Modal not provided",wr="User close QRCode Modal";class bs{constructor(){this._eventEmitters=[]}subscribe(e){this._eventEmitters.push(e)}unsubscribe(e){this._eventEmitters=this._eventEmitters.filter(s=>s.event!==e)}trigger(e){let s=[],h;Ki(e)?h=e.method:Vt(e)||te(e)?h=`response:${e.id}`:dr(e)?h=e.event:h="",h&&(s=this._eventEmitters.filter(g=>g.event===h)),(!s||!s.length)&&!Gi(h)&&!dr(h)&&(s=this._eventEmitters.filter(g=>g.event==="call_request")),s.forEach(g=>{if(te(e)){const a=new Error(e.error.message);g.callback(a,null)}else g.callback(null,e)})}}class Ss{constructor(e="walletconnect"){this.storageId=e}getSession(){let e=null;const s=xr(this.storageId);return s&&as(s)&&(e=s),e}setSession(e){return Kn(this.storageId,e),e}removeSession(){Er(this.storageId)}}const Os="walletconnect.org",Rs="abcdefghijklmnopqrstuvwxyz0123456789",Ur=Rs.split("").map(n=>`https://${n}.bridge.walletconnect.org`);function xs(n){let e=n.indexOf("//")>-1?n.split("/")[2]:n.split("/")[0];return e=e.split(":")[0],e=e.split("?")[0],e}function Es(n){return xs(n).split(".").slice(-2).join(".")}function Is(){return Math.floor(Math.random()*Ur.length)}function ks(){return Ur[Is()]}function Ts(n){return Es(n)===Os}function Cs(n){return Ts(n)?ks():n}class As{constructor(e){if(this.protocol="wc",this.version=1,this._bridge="",this._key=null,this._clientId="",this._clientMeta=null,this._peerId="",this._peerMeta=null,this._handshakeId=0,this._handshakeTopic="",this._connected=!1,this._accounts=[],this._chainId=0,this._networkId=0,this._rpcUrl="",this._eventManager=new bs,this._clientMeta=fr()||e.connectorOpts.clientMeta||null,this._cryptoLib=e.cryptoLib,this._sessionStorage=e.sessionStorage||new Ss(e.connectorOpts.storageId),this._qrcodeModal=e.connectorOpts.qrcodeModal,this._qrcodeModalOptions=e.connectorOpts.qrcodeModalOptions,this._signingMethods=[...Ir,...e.connectorOpts.signingMethods||[]],!e.connectorOpts.bridge&&!e.connectorOpts.uri&&!e.connectorOpts.session)throw new Error(ys);e.connectorOpts.bridge&&(this.bridge=Cs(e.connectorOpts.bridge)),e.connectorOpts.uri&&(this.uri=e.connectorOpts.uri);const s=e.connectorOpts.session||this._getStorageSession();s&&(this.session=s),this.handshakeId&&this._subscribeToSessionResponse(this.handshakeId,"Session request rejected"),this._transport=e.transport||new us({protocol:this.protocol,version:this.version,url:this.bridge,subscriptions:[this.clientId]}),this._subscribeToInternalEvents(),this._initTransport(),e.connectorOpts.uri&&this._subscribeToSessionRequest(),e.pushServerOpts&&this._registerPushServer(e.pushServerOpts)}set bridge(e){e&&(this._bridge=e)}get bridge(){return this._bridge}set key(e){if(!e)return;const s=wi(e);this._key=s}get key(){return this._key?pi(this._key,!0):""}set clientId(e){e&&(this._clientId=e)}get clientId(){let e=this._clientId;return e||(e=this._clientId=be()),this._clientId}set peerId(e){e&&(this._peerId=e)}get peerId(){return this._peerId}set clientMeta(e){}get clientMeta(){let e=this._clientMeta;return e||(e=this._clientMeta=fr()),e}set peerMeta(e){this._peerMeta=e}get peerMeta(){return this._peerMeta}set handshakeTopic(e){e&&(this._handshakeTopic=e)}get handshakeTopic(){return this._handshakeTopic}set handshakeId(e){e&&(this._handshakeId=e)}get handshakeId(){return this._handshakeId}get uri(){return this._formatUri()}set uri(e){if(!e)return;const{handshakeTopic:s,bridge:h,key:g}=this._parseUri(e);this.handshakeTopic=s,this.bridge=h,this.key=g}set chainId(e){this._chainId=e}get chainId(){return this._chainId}set networkId(e){this._networkId=e}get networkId(){return this._networkId}set accounts(e){this._accounts=e}get accounts(){return this._accounts}set rpcUrl(e){this._rpcUrl=e}get rpcUrl(){return this._rpcUrl}set connected(e){}get connected(){return this._connected}set pending(e){}get pending(){return!!this._handshakeTopic}get session(){return{connected:this.connected,accounts:this.accounts,chainId:this.chainId,bridge:this.bridge,key:this.key,clientId:this.clientId,clientMeta:this.clientMeta,peerId:this.peerId,peerMeta:this.peerMeta,handshakeId:this.handshakeId,handshakeTopic:this.handshakeTopic}}set session(e){e&&(this._connected=e.connected,this.accounts=e.accounts,this.chainId=e.chainId,this.bridge=e.bridge,this.key=e.key,this.clientId=e.clientId,this.clientMeta=e.clientMeta,this.peerId=e.peerId,this.peerMeta=e.peerMeta,this.handshakeId=e.handshakeId,this.handshakeTopic=e.handshakeTopic)}on(e,s){const h={event:e,callback:s};this._eventManager.subscribe(h)}off(e){this._eventManager.unsubscribe(e)}async createInstantRequest(e){this._key=await this._generateKey();const s=this._formatRequest({method:"wc_instantRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,request:this._formatRequest(e)}]});this.handshakeId=s.id,this.handshakeTopic=be(),this._eventManager.trigger({event:"display_uri",params:[this.uri]}),this.on("modal_closed",()=>{throw new Error(wr)});const h=()=>{this.killSession()};try{const g=await this._sendCallRequest(s);return g&&h(),g}catch(g){throw h(),g}}async connect(e){if(!this._qrcodeModal)throw new Error(Ms);return this.connected?{chainId:this.chainId,accounts:this.accounts}:(await this.createSession(e),new Promise(async(s,h)=>{this.on("modal_closed",()=>h(new Error(wr))),this.on("connect",(g,a)=>{if(g)return h(g);s(a.params[0])})}))}async createSession(e){if(this._connected)throw new Error(Oe);if(this.pending)return;this._key=await this._generateKey();const s=this._formatRequest({method:"wc_sessionRequest",params:[{peerId:this.clientId,peerMeta:this.clientMeta,chainId:e&&e.chainId?e.chainId:null}]});this.handshakeId=s.id,this.handshakeTopic=be(),this._sendSessionRequest(s,"Session update rejected",{topic:this.handshakeTopic}),this._eventManager.trigger({event:"display_uri",params:[this.uri]})}approveSession(e){if(this._connected)throw new Error(Oe);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl,peerId:this.clientId,peerMeta:this.clientMeta},h={id:this.handshakeId,jsonrpc:"2.0",result:s};this._sendResponse(h),this._connected=!0,this._setStorageSession(),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})}rejectSession(e){if(this._connected)throw new Error(Oe);const s=e&&e.message?e.message:ds,h=this._formatResponse({id:this.handshakeId,error:{message:s}});this._sendResponse(h),this._connected=!1,this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession()}updateSession(e){if(!this._connected)throw new Error(Bt);this.chainId=e.chainId,this.accounts=e.accounts,this.networkId=e.networkId||0,this.rpcUrl=e.rpcUrl||"";const s={approved:!0,chainId:this.chainId,networkId:this.networkId,accounts:this.accounts,rpcUrl:this.rpcUrl},h=this._formatRequest({method:"wc_sessionUpdate",params:[s]});this._sendSessionRequest(h,"Session update rejected"),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]}),this._manageStorageSession()}async killSession(e){const s=e?e.message:"Session Disconnected",h={approved:!1,chainId:null,networkId:null,accounts:null},g=this._formatRequest({method:"wc_sessionUpdate",params:[h]});await this._sendRequest(g),this._handleSessionDisconnect(s)}async sendTransaction(e){if(!this._connected)throw new Error(Bt);const s=Se(e),h=this._formatRequest({method:"eth_sendTransaction",params:[s]});return await this._sendCallRequest(h)}async signTransaction(e){if(!this._connected)throw new Error(Bt);const s=Se(e),h=this._formatRequest({method:"eth_signTransaction",params:[s]});return await this._sendCallRequest(h)}async signMessage(e){if(!this._connected)throw new Error(Bt);const s=this._formatRequest({method:"eth_sign",params:e});return await this._sendCallRequest(s)}async signPersonalMessage(e){if(!this._connected)throw new Error(Bt);e=pr(e);const s=this._formatRequest({method:"personal_sign",params:e});return await this._sendCallRequest(s)}async signTypedData(e){if(!this._connected)throw new Error(Bt);const s=this._formatRequest({method:"eth_signTypedData",params:e});return await this._sendCallRequest(s)}async updateChain(e){if(!this._connected)throw new Error("Session currently disconnected");const s=this._formatRequest({method:"wallet_updateChain",params:[e]});return await this._sendCallRequest(s)}unsafeSend(e,s){return this._sendRequest(e,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:s}]}),new Promise((h,g)=>{this._subscribeToResponse(e.id,(a,y)=>{if(a){g(a);return}if(!y)throw new Error(ps);h(y)})})}async sendCustomRequest(e,s){if(!this._connected)throw new Error(Bt);switch(e.method){case"eth_accounts":return this.accounts;case"eth_chainId":return Lr(this.chainId);case"eth_sendTransaction":case"eth_signTransaction":e.params&&(e.params[0]=Se(e.params[0]));break;case"personal_sign":e.params&&(e.params=pr(e.params));break}const h=this._formatRequest(e);return await this._sendCallRequest(h,s)}approveRequest(e){if(Vt(e)){const s=this._formatResponse(e);this._sendResponse(s)}else throw new Error(gs)}rejectRequest(e){if(te(e)){const s=this._formatResponse(e);this._sendResponse(s)}else throw new Error(ms)}transportClose(){this._transport.close()}async _sendRequest(e,s){const h=this._formatRequest(e),g=await this._encrypt(h),a=typeof(s==null?void 0:s.topic)<"u"?s.topic:this.peerId,y=JSON.stringify(g),O=typeof(s==null?void 0:s.forcePushNotification)<"u"?!s.forcePushNotification:Vi(h);this._transport.send(y,a,O)}async _sendResponse(e){const s=await this._encrypt(e),h=this.peerId,g=JSON.stringify(s);this._transport.send(g,h,!0)}async _sendSessionRequest(e,s,h){this._sendRequest(e,h),this._subscribeToSessionResponse(e.id,s)}_sendCallRequest(e,s){return this._sendRequest(e,s),this._eventManager.trigger({event:"call_request_sent",params:[{request:e,options:s}]}),this._subscribeToCallResponse(e.id)}_formatRequest(e){if(typeof e.method>"u")throw new Error(vs);return{id:typeof e.id>"u"?Hi():e.id,jsonrpc:"2.0",method:e.method,params:typeof e.params>"u"?[]:e.params}}_formatResponse(e){if(typeof e.id>"u")throw new Error(ws);const s={id:e.id,jsonrpc:"2.0"};if(te(e)){const h=Yi(e.error);return Object.assign(Object.assign(Object.assign({},s),e),{error:h})}else if(Vt(e))return Object.assign(Object.assign({},s),e);throw new Error(vr)}_handleSessionDisconnect(e){const s=e||"Session Disconnected";this._connected||(this._qrcodeModal&&this._qrcodeModal.close(),Er(cr)),this._connected&&(this._connected=!1),this._handshakeId&&(this._handshakeId=0),this._handshakeTopic&&(this._handshakeTopic=""),this._peerId&&(this._peerId=""),this._eventManager.trigger({event:"disconnect",params:[{message:s}]}),this._removeStorageSession(),this.transportClose()}_handleSessionResponse(e,s){s?s.approved?(this._connected?(s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),this._eventManager.trigger({event:"session_update",params:[{chainId:this.chainId,accounts:this.accounts}]})):(this._connected=!0,s.chainId&&(this.chainId=s.chainId),s.accounts&&(this.accounts=s.accounts),s.peerId&&!this.peerId&&(this.peerId=s.peerId),s.peerMeta&&!this.peerMeta&&(this.peerMeta=s.peerMeta),this._eventManager.trigger({event:"connect",params:[{peerId:this.peerId,peerMeta:this.peerMeta,chainId:this.chainId,accounts:this.accounts}]})),this._manageStorageSession()):this._handleSessionDisconnect(e):this._handleSessionDisconnect(e)}async _handleIncomingMessages(e){if(![this.clientId,this.handshakeTopic].includes(e.topic))return;let h;try{h=JSON.parse(e.payload)}catch{return}const g=await this._decrypt(h);g&&this._eventManager.trigger(g)}_subscribeToSessionRequest(){this._transport.subscribe(this.handshakeTopic)}_subscribeToResponse(e,s){this.on(`response:${e}`,s)}_subscribeToSessionResponse(e,s){this._subscribeToResponse(e,(h,g)=>{if(h){this._handleSessionResponse(h.message);return}Vt(g)?this._handleSessionResponse(s,g.result):g.error&&g.error.message?this._handleSessionResponse(g.error.message):this._handleSessionResponse(s)})}_subscribeToCallResponse(e){return new Promise((s,h)=>{this._subscribeToResponse(e,(g,a)=>{if(g){h(g);return}Vt(a)?s(a.result):a.error&&a.error.message?h(a.error):h(new Error(vr))})})}_subscribeToInternalEvents(){this.on("display_uri",()=>{this._qrcodeModal&&this._qrcodeModal.open(this.uri,()=>{this._eventManager.trigger({event:"modal_closed",params:[]})},this._qrcodeModalOptions)}),this.on("connect",()=>{this._qrcodeModal&&this._qrcodeModal.close()}),this.on("call_request_sent",(e,s)=>{const{request:h}=s.params[0];if(Wn()&&this._signingMethods.includes(h.method)){const g=xr(cr);g&&(window.location.href=g.href)}}),this.on("wc_sessionRequest",(e,s)=>{e&&this._eventManager.trigger({event:"error",params:[{code:"SESSION_REQUEST_ERROR",message:e.toString()}]}),this.handshakeId=s.id,this.peerId=s.params[0].peerId,this.peerMeta=s.params[0].peerMeta;const h=Object.assign(Object.assign({},s),{method:"session_request"});this._eventManager.trigger(h)}),this.on("wc_sessionUpdate",(e,s)=>{e&&this._handleSessionResponse(e.message),this._handleSessionResponse("Session disconnected",s.params[0])})}_initTransport(){this._transport.on("message",e=>this._handleIncomingMessages(e)),this._transport.on("open",()=>this._eventManager.trigger({event:"transport_open",params:[]})),this._transport.on("close",()=>this._eventManager.trigger({event:"transport_close",params:[]})),this._transport.on("error",()=>this._eventManager.trigger({event:"transport_error",params:["Websocket connection failed"]})),this._transport.open()}_formatUri(){const e=this.protocol,s=this.handshakeTopic,h=this.version,g=encodeURIComponent(this.bridge),a=this.key;return`${e}:${s}@${h}?bridge=${g}&key=${a}`}_parseUri(e){const s=hs(e);if(s.protocol===this.protocol){if(!s.handshakeTopic)throw Error("Invalid or missing handshakeTopic parameter value");const h=s.handshakeTopic;if(!s.bridge)throw Error("Invalid or missing bridge url parameter value");const g=decodeURIComponent(s.bridge);if(!s.key)throw Error("Invalid or missing key parameter value");const a=s.key;return{handshakeTopic:h,bridge:g,key:a}}else throw new Error(_s)}async _generateKey(){return this._cryptoLib?await this._cryptoLib.generateKey():null}async _encrypt(e){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.encrypt(e,s):null}async _decrypt(e){const s=this._key;return this._cryptoLib&&s?await this._cryptoLib.decrypt(e,s):null}_getStorageSession(){let e=null;return this._sessionStorage&&(e=this._sessionStorage.getSession()),e}_setStorageSession(){this._sessionStorage&&this._sessionStorage.setSession(this.session)}_removeStorageSession(){this._sessionStorage&&this._sessionStorage.removeSession()}_manageStorageSession(){this._connected?this._setStorageSession():this._removeStorageSession()}_registerPushServer(e){if(!e.url||typeof e.url!="string")throw Error("Invalid or missing pushServerOpts.url parameter value");if(!e.type||typeof e.type!="string")throw Error("Invalid or missing pushServerOpts.type parameter value");if(!e.token||typeof e.token!="string")throw Error("Invalid or missing pushServerOpts.token parameter value");const s={bridge:this.bridge,topic:this.clientId,type:e.type,token:e.token,peerName:"",language:e.language||""};this.on("connect",async(h,g)=>{if(h)throw h;if(e.peerMeta){const a=g.params[0].peerMeta.name;s.peerName=a}try{if(!(await(await fetch(`${e.url}/new`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)})).json()).success)throw Error("Failed to register in Push Server")}catch{throw Error("Failed to register in Push Server")}})}}function Ns(n){return Kt.getBrowerCrypto().getRandomValues(new Uint8Array(n))}const jr=256,$r=jr,qs=jr,Pt="AES-CBC",Ps=`SHA-${$r}`,Te="HMAC",Ls="encrypt",Bs="decrypt",Ws="sign",Fs="verify";function Ds(n){return n===Pt?{length:$r,name:Pt}:{hash:{name:Ps},name:Te}}function Us(n){return n===Pt?[Ls,Bs]:[Ws,Fs]}async function Fe(n,e=Pt){return Kt.getSubtleCrypto().importKey("raw",n,Ds(e),!0,Us(e))}async function js(n,e,s){const h=Kt.getSubtleCrypto(),g=await Fe(e,Pt),a=await h.encrypt({iv:n,name:Pt},g,s);return new Uint8Array(a)}async function $s(n,e,s){const h=Kt.getSubtleCrypto(),g=await Fe(e,Pt),a=await h.decrypt({iv:n,name:Pt},g,s);return new Uint8Array(a)}async function Hs(n,e){const s=Kt.getSubtleCrypto(),h=await Fe(n,Te),g=await s.sign({length:qs,name:Te},h,e);return new Uint8Array(g)}function Zs(n,e,s){return js(n,e,s)}function Js(n,e,s){return $s(n,e,s)}async function Hr(n,e){return await Hs(n,e)}async function Zr(n){const e=(n||256)/8,s=Ns(e);return gi(re(s))}async function Jr(n,e){const s=jt(n.data),h=jt(n.iv),g=jt(n.hmac),a=Ut(g,!1),y=qr(s,h),O=await Hr(e,y),E=Ut(O,!1);return qt(a)===qt(E)}async function Ks(n,e,s){const h=$t(Re(e)),g=s||await Zr(128),a=$t(Re(g)),y=Ut(a,!1),O=JSON.stringify(n),E=oi(O),R=await Zs(a,h,E),q=Ut(R,!1),A=qr(R,a),C=await Hr(h,A),P=Ut(C,!1);return{data:q,hmac:P,iv:y}}async function Gs(n,e){const s=$t(Re(e));if(!s)throw new Error("Missing key: required for decryption");if(!await Jr(n,s))return null;const g=jt(n.data),a=jt(n.iv),y=await Js(a,s,g),O=ii(y);let E;try{E=JSON.parse(O)}catch{return null}return E}const Vs=Object.freeze(Object.defineProperty({__proto__:null,decrypt:Gs,encrypt:Ks,generateKey:Zr,verifyHmac:Jr},Symbol.toStringTag,{value:"Module"}));class zs extends As{constructor(e,s){super({cryptoLib:Vs,connectorOpts:e,pushServerOpts:s})}}const yr=[{name:"Rainbow",chains:[zt.EIP155],logo:"https://images.web3auth.io/login-rainbow.svg",mobile:{native:"rainbow:",universal:"https://rnbwapp.com"},desktop:{native:"",universal:""}},{name:"MetaMask",chains:[zt.EIP155],logo:"https://images.web3auth.io/login-metamask.svg",mobile:{native:"metamask:",universal:"https://metamask.app.link"},desktop:{native:"",universal:""}}];function _r(n,e){var s=Object.keys(n);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(n);e&&(h=h.filter(function(g){return Object.getOwnPropertyDescriptor(n,g).enumerable})),s.push.apply(s,h)}return s}function Qs(n){for(var e=1;e<arguments.length;e++){var s=arguments[e]!=null?arguments[e]:{};e%2?_r(Object(s),!0).forEach(function(h){It(n,h,s[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(s)):_r(Object(s)).forEach(function(h){Object.defineProperty(n,h,Object.getOwnPropertyDescriptor(s,h))})}return n}class io extends Xr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),It(this,"name",Gt.WALLET_CONNECT_V1),It(this,"adapterNamespace",zr.EIP155),It(this,"currentChainNamespace",zt.EIP155),It(this,"type",Qr.EXTERNAL),It(this,"adapterOptions",void 0),It(this,"status",xt.NOT_READY),It(this,"adapterData",{uri:"",extensionAdapters:yr}),It(this,"connector",null),It(this,"wcProvider",null),It(this,"rehydrated",!1),this.adapterOptions=Qs({},e),this.chainConfig=e.chainConfig||null,this.sessionTime=e.sessionTime||86400}get connected(){var e;return!!((e=this.connector)!==null&&e!==void 0&&e.connected)}get provider(){var e;return((e=this.wcProvider)===null||e===void 0?void 0:e.provider)||null}set provider(e){throw new Error("Not implemented")}async init(){super.checkInitializationRequirements(),this.chainConfig||(this.chainConfig=nr(zt.EIP155,1)),this.connector=this.getWalletConnectInstance(),this.wcProvider=new ir({config:{chainConfig:this.chainConfig},connector:this.connector}),this.emit(Et.READY,Gt.WALLET_CONNECT_V1),this.status=xt.READY,Nt.debug("initializing wallet connect v1 adapter"),this.connector.connected&&(this.rehydrated=!0,await this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId}))}async connect(){if(super.checkConnectionRequirements(),!this.connector)throw kt.notReady("Wallet adapter is not ready yet");if(this.connected)return await this.onConnectHandler({accounts:this.connector.accounts,chainId:this.connector.chainId}),this.provider;if(this.status!==xt.CONNECTING){var e;if((e=this.adapterOptions.adapterSettings)!==null&&e!==void 0&&e.qrcodeModal){var s;this.connector=this.getWalletConnectInstance(),this.wcProvider=new ir({config:{chainConfig:this.chainConfig,skipLookupNetwork:(s=this.adapterOptions.adapterSettings)===null||s===void 0?void 0:s.skipNetworkSwitching},connector:this.connector})}await this.createNewSession(),this.status=xt.CONNECTING,this.emit(Et.CONNECTING,{adapter:Gt.WALLET_CONNECT_V1})}return new Promise((h,g)=>{if(!this.connector)return g(kt.notReady("Wallet adapter is not ready yet"));this.connector.on("modal_closed",async()=>(this.status=xt.READY,this.emit(Et.READY,Gt.WALLET_CONNECT_V1),g(new Error("User closed modal"))));try{this.connector.on("connect",async(a,y)=>(a&&this.emit(Et.ERRORED,a),Nt.debug("connected event emitted by web3auth"),await this.onConnectHandler(y.params[0]),h(this.provider)))}catch(a){Nt.error("Wallet connect v1 adapter error while connecting",a),this.status=xt.READY,this.rehydrated=!0,this.emit(Et.ERRORED,a),g(a instanceof Yr?a:Yt.connectionError("Failed to login with wallet connect: ".concat((a==null?void 0:a.message)||"")))}})}setAdapterSettings(e){this.status!==xt.READY&&e!=null&&e.sessionTime&&(this.sessionTime=e.sessionTime)}async getUserInfo(){if(!this.connected)throw Yt.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};const{cleanup:s}=e;if(!this.connector||!this.connected)throw Yt.notConnectedError("Not connected with wallet");await super.disconnect(),await this.connector.killSession(),this.rehydrated=!1,s?(this.connector=null,this.status=xt.NOT_READY,this.wcProvider=null):this.status=xt.READY,this.emit(Et.DISCONNECTED)}async addChain(e){try{var s;if(!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");const h=(s=this.adapterOptions.adapterSettings)===null||s===void 0?void 0:s.networkSwitchModal;h&&await h.addNetwork({chainConfig:e,appOrigin:window.location.hostname}),await this.wcProvider.addChain(e)}catch(h){Nt.error(h)}}async switchChain(e,s){var h;if(!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");const g=(h=this.adapterOptions.adapterSettings)===null||h===void 0?void 0:h.networkSwitchModal;g&&await g.switchNetwork({currentChainConfig:s,newChainConfig:e,appOrigin:window.location.hostname}),await this.wcProvider.switchChain({chainId:s.chainId,lookup:!1,addChain:!1})}async createNewSession(){var e,s;let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{forceNewSession:!1};if(!this.connector)throw kt.notReady("Wallet adapter is not ready yet");if(h.forceNewSession&&this.connector.pending&&await this.connector.killSession(),(e=this.adapterOptions)!==null&&e!==void 0&&(s=e.adapterSettings)!==null&&s!==void 0&&s.qrcodeModal){var g;await this.connector.createSession({chainId:parseInt(((g=this.chainConfig)===null||g===void 0?void 0:g.chainId)||"0x1",16)});return}return new Promise((a,y)=>{var O;if(!this.connector)return y(kt.notReady("Wallet adapter is not ready yet"));Nt.debug("creating new session for web3auth wallet connect"),this.connector.on("display_uri",async(E,R)=>{var q;if(E)return this.emit(Et.ERRORED,Yt.connectionError("Failed to display wallet connect qr code")),y(E);const A=R.params[0];return this.updateAdapterData({uri:A,extensionAdapters:yr}),(q=this.connector)===null||q===void 0||q.off("display_uri"),a()}),this.connector.createSession({chainId:parseInt(((O=this.chainConfig)===null||O===void 0?void 0:O.chainId)||"0x1",16)}).catch(E=>(Nt.error("error while creating new wallet connect session",E),this.emit(Et.ERRORED,E),y(E)))})}async onConnectHandler(e){if(!this.connector||!this.wcProvider)throw kt.notReady("Wallet adapter is not ready yet");if(!this.chainConfig)throw kt.invalidParams("Chain config is not set");const{chainId:s}=e;if(Nt.debug("connected chainId in hex"),s!==parseInt(this.chainConfig.chainId,16)){var h,g,a;const y=nr(zt.EIP155,s)||{chainId:"0x".concat(s.toString(16)),displayName:"Unknown Network"},O=(h=this.adapterOptions.adapterSettings)===null||h===void 0?void 0:h.qrcodeModal;if(!O||O&&!((g=this.adapterOptions)!==null&&g!==void 0&&(a=g.adapterSettings)!==null&&a!==void 0&&a.skipNetworkSwitching))try{await this.addChain(this.chainConfig),await this.switchChain(y,this.chainConfig),this.connector=this.getWalletConnectInstance()}catch(E){Nt.error("error while chain switching",E),await this.createNewSession({forceNewSession:!0}),this.emit(Et.ERRORED,kt.fromCode(5e3,"Not connected to correct network. Expected: ".concat(this.chainConfig.displayName,", Current: ").concat((y==null?void 0:y.displayName)||s,", Please switch to correct network from wallet"))),this.status=xt.READY,this.rehydrated=!0;return}}await this.wcProvider.setupProvider(this.connector),this.subscribeEvents(this.connector),this.status=xt.CONNECTED,this.emit(Et.CONNECTED,{adapter:Gt.WALLET_CONNECT_V1,reconnected:this.rehydrated})}subscribeEvents(e){e.on("session_update",async s=>{s&&this.emit(Et.ERRORED,s)})}getWalletConnectInstance(){const e=this.adapterOptions.adapterSettings||{};return e.bridge=e.bridge||"https://bridge.walletconnect.org",new zs(e)}}export{io as WalletConnectV1Adapter};
