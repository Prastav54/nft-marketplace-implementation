import{V as dr,W as Ft,X as Re,Y as y,Z as Q,$ as cr,a0 as ft,a1 as Ie,a2 as hr,t as ot,a3 as lt,v as $,a4 as $t,a5 as be,a6 as fr,a7 as pr,a8 as Gt,a9 as gr,aa as mr,ab as Ce,ac as wr,ad as pt,ae as yr,af as j,ag as br,ah as Xe,ai as Ee,aj as Te,ak as _r,al as gt}from"./index-CVBD42mg.js";import{u as vr}from"./util-BLBo2_qY.js";import{i as Sr,d as Cr}from"./index-K1bPDjEh.js";import{c as Er}from"./browser-CIgpfZ64.js";import{B as Tr}from"./baseEvmAdapter.esm-gp1oXQ_g.js";function Ar(i,e){if(i==null)return{};var t={},r=Object.keys(i),a,o;for(o=0;o<r.length;o++)a=r[o],!(e.indexOf(a)>=0)&&(t[a]=i[a]);return t}function Or(i,e){if(i==null)return{};var t=Ar(i,e),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);for(a=0;a<o.length;a++)r=o[a],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(t[r]=i[r])}return t}const Dr=()=>dr(32).toString("hex");function Ae(){}const mt="SYN",ze="ACK",wt="BRK";class yt extends Re.Duplex{constructor(e){let{name:t,target:r,targetWindow:a=window,targetOrigin:o="*"}=e;if(super({objectMode:!0}),y(this,"_init",void 0),y(this,"_haveSyn",void 0),y(this,"_name",void 0),y(this,"_target",void 0),y(this,"_targetWindow",void 0),y(this,"_targetOrigin",void 0),y(this,"_onMessage",void 0),y(this,"_synIntervalId",void 0),!t||!r)throw new Error("Invalid input.");this._init=!1,this._haveSyn=!1,this._name=t,this._target=r,this._targetWindow=a,this._targetOrigin=o,this._onMessage=this.onMessage.bind(this),this._synIntervalId=null,window.addEventListener("message",this._onMessage,!1),this._handShake()}_break(){this.cork(),this._write(wt,null,Ae),this._haveSyn=!1,this._init=!1}_handShake(){this._write(mt,null,Ae),this.cork()}_onData(e){if(!this._init)e===mt?(this._haveSyn=!0,this._write(ze,null,Ae)):e===ze&&(this._init=!0,this._haveSyn||this._write(ze,null,Ae),this.uncork());else if(e===wt)this._break();else try{this.push(e)}catch(t){this.emit("error",t)}}_postMessage(e){const t=this._targetOrigin;this._targetWindow.postMessage({target:this._target,data:e},t)}onMessage(e){const t=e.data;this._targetOrigin!=="*"&&e.origin!==this._targetOrigin||e.source!==this._targetWindow||typeof t!="object"||t.target!==this._name||!t.data||this._onData(t.data)}_read(){}_write(e,t,r){this._postMessage(e),r()}_destroy(){window.removeEventListener("message",this._onMessage,!1)}}function bt(i,e,t){try{Reflect.apply(i,e,t)}catch(r){setTimeout(()=>{throw r})}}function Ir(i){const e=i.length,t=new Array(e);for(let r=0;r<e;r+=1)t[r]=i[r];return t}let Me=class extends Ft.EventEmitter{emit(e){let t=e==="error";const r=this._events;if(r!==void 0)t=t&&r.error===void 0;else if(!t)return!1;for(var a=arguments.length,o=new Array(a>1?a-1:0),l=1;l<a;l++)o[l-1]=arguments[l];if(t){let c;if(o.length>0&&([c]=o),c instanceof Error)throw c;const v=new Error(`Unhandled error.${c?` (${c.message})`:""}`);throw v.context=c,v}const h=r[e];if(h===void 0)return!1;if(typeof h=="function")bt(h,this,o);else{const c=h.length,v=Ir(h);for(let _=0;_<c;_+=1)bt(v[_],this,o)}return!0}};class ge extends Error{constructor(e){let{code:t,message:r,data:a}=e;if(!Number.isInteger(t))throw new Error("code must be an integer");if(!r||typeof r!="string")throw new Error("message must be string");super(r),y(this,"code",void 0),y(this,"data",void 0),this.code=t,a!==void 0&&(this.data=a)}toString(){return hr({code:this.code,message:this.message,data:this.data,stack:this.stack})}}function Rr(){const i={};function e(){return!1}const t=new Me;function r(c){const v=i[c.id];if(!v)throw new Error(`StreamMiddleware - Unknown response id "${c.id}"`);delete i[c.id],Object.assign(v.res,c),setTimeout(v.end)}function a(c){t.emit("notification",c)}function o(c,v,_){let m;try{!c.id?a(c):r(c)}catch(O){m=O}_(m)}const l=new Re.Duplex({objectMode:!0,read:e,write:o});return{events:t,middleware:(c,v,_,m)=>{l.push(c),i[c.id]={req:c,res:v,next:_,end:m}},stream:l}}function Mr(){return(i,e,t,r)=>{const a=i.id,o=Dr();i.id=o,e.id=o,t(l=>{i.id=a,e.id=a,l()})}}function _t(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,r)}return t}function Pr(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?_t(Object(t),!0).forEach(function(r){y(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):_t(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class Z extends Me{constructor(){super(),y(this,"_middleware",void 0),this._middleware=[]}static async _runAllMiddleware(e,t,r){const a=[];let o=null,l=!1;for(const h of r)if([o,l]=await Z._runMiddleware(e,t,h,a),l)break;return[o,l,a.reverse()]}static _runMiddleware(e,t,r,a){return new Promise(o=>{const l=c=>{const v=c||t.error;v&&(t.error=Q.serializeError(v)),o([v,!0])},h=c=>{t.error?l(t.error):(c&&(typeof c!="function"&&l(new ge({code:-32603,message:"JRPCEngine: 'next' return handlers must be functions"})),a.push(c)),o([null,!1]))};try{r(e,t,h,l)}catch(c){l(c)}})}static async _runReturnHandlers(e){for(const t of e)await new Promise((r,a)=>{t(o=>o?a(o):r())})}static _checkForCompletion(e,t,r){if(!("result"in t)&&!("error"in t))throw new ge({code:-32603,message:"Response has no error or result for request"});if(!r)throw new ge({code:-32603,message:"Nothing ended request"})}push(e){this._middleware.push(e)}handle(e,t){if(t&&typeof t!="function")throw new Error('"callback" must be a function if provided.');return Array.isArray(e)?t?this._handleBatch(e,t):this._handleBatch(e):t?this._handle(e,t):this._promiseHandle(e)}asMiddleware(){return async(e,t,r,a)=>{try{const[o,l,h]=await Z._runAllMiddleware(e,t,this._middleware);return l?(await Z._runReturnHandlers(h),a(o)):r(async c=>{try{await Z._runReturnHandlers(h)}catch(v){return c(v)}return c()})}catch(o){return a(o)}}}async _handleBatch(e,t){try{const r=await Promise.all(e.map(this._promiseHandle.bind(this)));return t?t(null,r):r}catch(r){if(t)return t(r);throw r}}_promiseHandle(e){return new Promise(t=>{this._handle(e,(r,a)=>{t(a)})})}async _handle(e,t){if(!e||Array.isArray(e)||typeof e!="object"){const l=new ge({code:-32603,message:"request must be plain object"});return t(l,{id:void 0,jsonrpc:"2.0",error:l})}if(typeof e.method!="string"){const l=new ge({code:-32603,message:"method must be string"});return t(l,{id:e.id,jsonrpc:"2.0",error:l})}const r=Pr({},e),a={id:r.id,jsonrpc:r.jsonrpc};let o=null;try{await this._processRequest(r,a)}catch(l){o=l}return o&&(delete a.result,a.error||(a.error=Q.serializeError(o))),t(o,a)}async _processRequest(e,t){const[r,a,o]=await Z._runAllMiddleware(e,t,this._middleware);if(Z._checkForCompletion(e,t,a),await Z._runReturnHandlers(o),r)throw r}}class Nr extends Re.Duplex{constructor(e){let{parent:t,name:r}=e;super({objectMode:!0}),y(this,"_parent",void 0),y(this,"_name",void 0),this._parent=t,this._name=r}_read(){}_write(e,t,r){this._parent.push({name:this._name,data:e}),r()}}function vt(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,r)}return t}function St(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vt(Object(t),!0).forEach(function(r){y(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):vt(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}const Ct=Symbol("IGNORE_SUBSTREAM");class Yt extends Re.Duplex{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(St(St({},e),{},{objectMode:!0})),y(this,"_substreams",void 0),y(this,"getStream",void 0),this._substreams={}}createStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);const t=new Nr({parent:this,name:e});return this._substreams[e]=t,xr(this,r=>t.destroy(r||void 0)),t}ignoreStream(e){if(!e)throw new Error("ObjectMultiplex - name must not be empty");if(this._substreams[e])throw new Error(`ObjectMultiplex - Substream for name "${e}" already exists`);this._substreams[e]=Ct}_read(){}_write(e,t,r){const{name:a,data:o}=e;if(!a)return window.console.warn(`ObjectMultiplex - malformed chunk without name "${e}"`),r();const l=this._substreams[a];return l?(l!==Ct&&l.push(o),r()):(window.console.warn(`ObjectMultiplex - orphaned data for stream "${a}"`),r())}}function xr(i,e){const t=cr(e);ft(i,{readable:!1},t),ft(i,{writable:!1},t)}function Lr(i){const e=new Yt;return e.getStream=function(r){return this._substreams[r]?this._substreams[r]:this.createStream(r)},Ie(i,e,i,t=>{t&&window.console.error(t)}),e}var it={},Pe={};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.storeAsStream=void 0;const kr=ot;class Ur extends kr.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=t=>this.push(t),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}function Br(i){return new Ur(i)}Pe.storeAsStream=Br;var Ne={},he={},ut={};Object.defineProperty(ut,"__esModule",{value:!0});const Wr=lt();function Et(i,e,t){try{Reflect.apply(i,e,t)}catch(r){setTimeout(()=>{throw r})}}function jr(i){const e=i.length,t=new Array(e);for(let r=0;r<e;r+=1)t[r]=i[r];return t}class Hr extends Wr.EventEmitter{emit(e,...t){let r=e==="error";const a=this._events;if(a!==void 0)r=r&&a.error===void 0;else if(!r)return!1;if(r){let l;if(t.length>0&&([l]=t),l instanceof Error)throw l;const h=new Error(`Unhandled error.${l?` (${l.message})`:""}`);throw h.context=l,h}const o=a[e];if(o===void 0)return!1;if(typeof o=="function")Et(o,this,t);else{const l=o.length,h=jr(o);for(let c=0;c<l;c+=1)Et(h[c],this,t)}return!0}}ut.default=Hr;var Vr=$&&$.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(he,"__esModule",{value:!0});he.ObservableStore=void 0;const Kr=Vr(ut);class qr extends Kr.default{constructor(e){super(),e?this._state=e:this._state={}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&typeof e=="object"){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}he.ObservableStore=qr;Object.defineProperty(Ne,"__esModule",{value:!0});Ne.ComposedStore=void 0;const Fr=he;class $r extends Fr.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach(t=>{const r=this._children[t];this._addChild(t,r)})}_addChild(e,t){const r=a=>{const o=this.getState();o[e]=a,this.putState(o)};t.subscribe(r),r(t.getState())}}Ne.ComposedStore=$r;var xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.MergedStore=void 0;const Gr=he;class Yr extends Gr.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach(t=>this._addChild(t)),this._updateWholeState()}_addChild(e){e.subscribe(()=>this._updateWholeState())}_updateWholeState(){const e=this._children.map(r=>r.getState()),t=Object.assign({},...e);this.putState(t)}}xe.MergedStore=Yr;var Le={},ke={exports:{}},nt={exports:{}},st={exports:{}};typeof process>"u"||!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0?st.exports={nextTick:Xr}:st.exports=process;function Xr(i,e,t,r){if(typeof i!="function")throw new TypeError('"callback" argument must be a function');var a=arguments.length,o,l;switch(a){case 0:case 1:return process.nextTick(i);case 2:return process.nextTick(function(){i.call(null,e)});case 3:return process.nextTick(function(){i.call(null,e,t)});case 4:return process.nextTick(function(){i.call(null,e,t,r)});default:for(o=new Array(a-1),l=0;l<o.length;)o[l++]=arguments[l];return process.nextTick(function(){i.apply(null,o)})}}var Ue=st.exports,zr={}.toString,Zr=Array.isArray||function(i){return zr.call(i)=="[object Array]"},Xt=lt().EventEmitter,at={exports:{}};(function(i,e){var t=$t,r=t.Buffer;function a(l,h){for(var c in l)h[c]=l[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?i.exports=t:(a(t,e),e.Buffer=o);function o(l,h,c){return r(l,h,c)}a(r,o),o.from=function(l,h,c){if(typeof l=="number")throw new TypeError("Argument must not be a number");return r(l,h,c)},o.alloc=function(l,h,c){if(typeof l!="number")throw new TypeError("Argument must be a number");var v=r(l);return h!==void 0?typeof c=="string"?v.fill(h,c):v.fill(h):v.fill(0),v},o.allocUnsafe=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return r(l)},o.allocUnsafeSlow=function(l){if(typeof l!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(l)}})(at,at.exports);var Be=at.exports,U={};function Jr(i){return Array.isArray?Array.isArray(i):We(i)==="[object Array]"}U.isArray=Jr;function Qr(i){return typeof i=="boolean"}U.isBoolean=Qr;function ei(i){return i===null}U.isNull=ei;function ti(i){return i==null}U.isNullOrUndefined=ti;function ri(i){return typeof i=="number"}U.isNumber=ri;function ii(i){return typeof i=="string"}U.isString=ii;function ni(i){return typeof i=="symbol"}U.isSymbol=ni;function si(i){return i===void 0}U.isUndefined=si;function ai(i){return We(i)==="[object RegExp]"}U.isRegExp=ai;function oi(i){return typeof i=="object"&&i!==null}U.isObject=oi;function li(i){return We(i)==="[object Date]"}U.isDate=li;function ui(i){return We(i)==="[object Error]"||i instanceof Error}U.isError=ui;function di(i){return typeof i=="function"}U.isFunction=di;function ci(i){return i===null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||typeof i=="symbol"||typeof i>"u"}U.isPrimitive=ci;U.isBuffer=$t.Buffer.isBuffer;function We(i){return Object.prototype.toString.call(i)}var Ze={exports:{}},Tt;function hi(){return Tt||(Tt=1,function(i){function e(o,l){if(!(o instanceof l))throw new TypeError("Cannot call a class as a function")}var t=Be.Buffer,r=ot;function a(o,l,h){o.copy(l,h)}i.exports=function(){function o(){e(this,o),this.head=null,this.tail=null,this.length=0}return o.prototype.push=function(h){var c={data:h,next:null};this.length>0?this.tail.next=c:this.head=c,this.tail=c,++this.length},o.prototype.unshift=function(h){var c={data:h,next:this.head};this.length===0&&(this.tail=c),this.head=c,++this.length},o.prototype.shift=function(){if(this.length!==0){var h=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,h}},o.prototype.clear=function(){this.head=this.tail=null,this.length=0},o.prototype.join=function(h){if(this.length===0)return"";for(var c=this.head,v=""+c.data;c=c.next;)v+=h+c.data;return v},o.prototype.concat=function(h){if(this.length===0)return t.alloc(0);for(var c=t.allocUnsafe(h>>>0),v=this.head,_=0;v;)a(v.data,c,_),_+=v.data.length,v=v.next;return c},o}(),r&&r.inspect&&r.inspect.custom&&(i.exports.prototype[r.inspect.custom]=function(){var o=r.inspect({length:this.length});return this.constructor.name+" "+o})}(Ze)),Ze.exports}var Oe=Ue;function fi(i,e){var t=this,r=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return r||a?(e?e(i):i&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Oe.nextTick(De,this,i)):Oe.nextTick(De,this,i)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(i||null,function(o){!e&&o?t._writableState?t._writableState.errorEmitted||(t._writableState.errorEmitted=!0,Oe.nextTick(De,t,o)):Oe.nextTick(De,t,o):e&&e(o)}),this)}function pi(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function De(i,e){i.emit("error",e)}var zt={destroy:fi,undestroy:pi},Je,At;function Zt(){if(At)return Je;At=1;var i=Ue;Je=E;function e(u){var d=this;this.next=null,this.entry=null,this.finish=function(){Ke(d,u)}}var t=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:i.nextTick,r;E.WritableState=N;var a=Object.create(U);a.inherits=be;var o={deprecate:fr},l=Xt,h=Be.Buffer,c=(typeof $<"u"?$:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function v(u){return h.from(u)}function _(u){return h.isBuffer(u)||u instanceof c}var m=zt;a.inherits(E,l);function O(){}function N(u,d){r=r||de(),u=u||{};var g=d instanceof r;this.objectMode=!!u.objectMode,g&&(this.objectMode=this.objectMode||!!u.writableObjectMode);var S=u.highWaterMark,D=u.writableHighWaterMark,M=this.objectMode?16:16*1024;S||S===0?this.highWaterMark=S:g&&(D||D===0)?this.highWaterMark=D:this.highWaterMark=M,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var V=u.decodeStrings===!1;this.decodeStrings=!V,this.defaultEncoding=u.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(K){X(d,K)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}N.prototype.getBuffer=function(){for(var d=this.bufferedRequest,g=[];d;)g.push(d),d=d.next;return g},function(){try{Object.defineProperty(N.prototype,"buffer",{get:o.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var I;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(I=Function.prototype[Symbol.hasInstance],Object.defineProperty(E,Symbol.hasInstance,{value:function(u){return I.call(this,u)?!0:this!==E?!1:u&&u._writableState instanceof N}})):I=function(u){return u instanceof this};function E(u){if(r=r||de(),!I.call(E,this)&&!(this instanceof r))return new E(u);this._writableState=new N(u,this),this.writable=!0,u&&(typeof u.write=="function"&&(this._write=u.write),typeof u.writev=="function"&&(this._writev=u.writev),typeof u.destroy=="function"&&(this._destroy=u.destroy),typeof u.final=="function"&&(this._final=u.final)),l.call(this)}E.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function W(u,d){var g=new Error("write after end");u.emit("error",g),i.nextTick(d,g)}function f(u,d,g,S){var D=!0,M=!1;return g===null?M=new TypeError("May not write null values to stream"):typeof g!="string"&&g!==void 0&&!d.objectMode&&(M=new TypeError("Invalid non-string/buffer chunk")),M&&(u.emit("error",M),i.nextTick(S,M),D=!1),D}E.prototype.write=function(u,d,g){var S=this._writableState,D=!1,M=!S.objectMode&&_(u);return M&&!h.isBuffer(u)&&(u=v(u)),typeof d=="function"&&(g=d,d=null),M?d="buffer":d||(d=S.defaultEncoding),typeof g!="function"&&(g=O),S.ended?W(this,g):(M||f(this,S,u,g))&&(S.pendingcb++,D=T(this,S,M,u,d,g)),D},E.prototype.cork=function(){var u=this._writableState;u.corked++},E.prototype.uncork=function(){var u=this._writableState;u.corked&&(u.corked--,!u.writing&&!u.corked&&!u.bufferProcessing&&u.bufferedRequest&&oe(this,u))},E.prototype.setDefaultEncoding=function(d){if(typeof d=="string"&&(d=d.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((d+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+d);return this._writableState.defaultEncoding=d,this};function w(u,d,g){return!u.objectMode&&u.decodeStrings!==!1&&typeof d=="string"&&(d=h.from(d,g)),d}Object.defineProperty(E.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function T(u,d,g,S,D,M){if(!g){var V=w(d,S,D);S!==V&&(g=!0,D="buffer",S=V)}var K=d.objectMode?1:S.length;d.length+=K;var te=d.length<d.highWaterMark;if(te||(d.needDrain=!0),d.writing||d.corked){var re=d.lastBufferedRequest;d.lastBufferedRequest={chunk:S,encoding:D,isBuf:g,callback:M,next:null},re?re.next=d.lastBufferedRequest:d.bufferedRequest=d.lastBufferedRequest,d.bufferedRequestCount+=1}else L(u,d,!1,K,S,D,M);return te}function L(u,d,g,S,D,M,V){d.writelen=S,d.writecb=V,d.writing=!0,d.sync=!0,g?u._writev(D,d.onwrite):u._write(D,M,d.onwrite),d.sync=!1}function x(u,d,g,S,D){--d.pendingcb,g?(i.nextTick(D,S),i.nextTick(ee,u,d),u._writableState.errorEmitted=!0,u.emit("error",S)):(D(S),u._writableState.errorEmitted=!0,u.emit("error",S),ee(u,d))}function Y(u){u.writing=!1,u.writecb=null,u.length-=u.writelen,u.writelen=0}function X(u,d){var g=u._writableState,S=g.sync,D=g.writecb;if(Y(g),d)x(u,g,S,d,D);else{var M=q(g);!M&&!g.corked&&!g.bufferProcessing&&g.bufferedRequest&&oe(u,g),S?t(z,u,g,M,D):z(u,g,M,D)}}function z(u,d,g,S){g||ae(u,d),d.pendingcb--,S(),ee(u,d)}function ae(u,d){d.length===0&&d.needDrain&&(d.needDrain=!1,u.emit("drain"))}function oe(u,d){d.bufferProcessing=!0;var g=d.bufferedRequest;if(u._writev&&g&&g.next){var S=d.bufferedRequestCount,D=new Array(S),M=d.corkedRequestsFree;M.entry=g;for(var V=0,K=!0;g;)D[V]=g,g.isBuf||(K=!1),g=g.next,V+=1;D.allBuffers=K,L(u,d,!0,d.length,D,"",M.finish),d.pendingcb++,d.lastBufferedRequest=null,M.next?(d.corkedRequestsFree=M.next,M.next=null):d.corkedRequestsFree=new e(d),d.bufferedRequestCount=0}else{for(;g;){var te=g.chunk,re=g.encoding,n=g.callback,s=d.objectMode?1:te.length;if(L(u,d,!1,s,te,re,n),g=g.next,d.bufferedRequestCount--,d.writing)break}g===null&&(d.lastBufferedRequest=null)}d.bufferedRequest=g,d.bufferProcessing=!1}E.prototype._write=function(u,d,g){g(new Error("_write() is not implemented"))},E.prototype._writev=null,E.prototype.end=function(u,d,g){var S=this._writableState;typeof u=="function"?(g=u,u=null,d=null):typeof d=="function"&&(g=d,d=null),u!=null&&this.write(u,d),S.corked&&(S.corked=1,this.uncork()),S.ending||Ve(this,S,g)};function q(u){return u.ending&&u.length===0&&u.bufferedRequest===null&&!u.finished&&!u.writing}function _e(u,d){u._final(function(g){d.pendingcb--,g&&u.emit("error",g),d.prefinished=!0,u.emit("prefinish"),ee(u,d)})}function ve(u,d){!d.prefinished&&!d.finalCalled&&(typeof u._final=="function"?(d.pendingcb++,d.finalCalled=!0,i.nextTick(_e,u,d)):(d.prefinished=!0,u.emit("prefinish")))}function ee(u,d){var g=q(d);return g&&(ve(u,d),d.pendingcb===0&&(d.finished=!0,u.emit("finish"))),g}function Ve(u,d,g){d.ending=!0,ee(u,d),g&&(d.finished?i.nextTick(g):u.once("finish",g)),d.ended=!0,u.writable=!1}function Ke(u,d,g){var S=u.entry;for(u.entry=null;S;){var D=S.callback;d.pendingcb--,D(g),S=S.next}d.corkedRequestsFree.next=u}return Object.defineProperty(E.prototype,"destroyed",{get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(u){this._writableState&&(this._writableState.destroyed=u)}}),E.prototype.destroy=m.destroy,E.prototype._undestroy=m.undestroy,E.prototype._destroy=function(u,d){this.end(),d(u)},Je}var Qe,Ot;function de(){if(Ot)return Qe;Ot=1;var i=Ue,e=Object.keys||function(m){var O=[];for(var N in m)O.push(N);return O};Qe=c;var t=Object.create(U);t.inherits=be;var r=Jt(),a=Zt();t.inherits(c,r);for(var o=e(a.prototype),l=0;l<o.length;l++){var h=o[l];c.prototype[h]||(c.prototype[h]=a.prototype[h])}function c(m){if(!(this instanceof c))return new c(m);r.call(this,m),a.call(this,m),m&&m.readable===!1&&(this.readable=!1),m&&m.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,m&&m.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",v)}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function v(){this.allowHalfOpen||this._writableState.ended||i.nextTick(_,this)}function _(m){m.end()}return Object.defineProperty(c.prototype,"destroyed",{get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(m){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=m,this._writableState.destroyed=m)}}),c.prototype._destroy=function(m,O){this.push(null),this.end(),i.nextTick(O,m)},Qe}var et={},Dt;function It(){if(Dt)return et;Dt=1;var i=Be.Buffer,e=i.isEncoding||function(f){switch(f=""+f,f&&f.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(f){if(!f)return"utf8";for(var w;;)switch(f){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return f;default:if(w)return;f=(""+f).toLowerCase(),w=!0}}function r(f){var w=t(f);if(typeof w!="string"&&(i.isEncoding===e||!e(f)))throw new Error("Unknown encoding: "+f);return w||f}et.StringDecoder=a;function a(f){this.encoding=r(f);var w;switch(this.encoding){case"utf16le":this.text=m,this.end=O,w=4;break;case"utf8":this.fillLast=c,w=4;break;case"base64":this.text=N,this.end=I,w=3;break;default:this.write=E,this.end=W;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(w)}a.prototype.write=function(f){if(f.length===0)return"";var w,T;if(this.lastNeed){if(w=this.fillLast(f),w===void 0)return"";T=this.lastNeed,this.lastNeed=0}else T=0;return T<f.length?w?w+this.text(f,T):this.text(f,T):w||""},a.prototype.end=_,a.prototype.text=v,a.prototype.fillLast=function(f){if(this.lastNeed<=f.length)return f.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);f.copy(this.lastChar,this.lastTotal-this.lastNeed,0,f.length),this.lastNeed-=f.length};function o(f){return f<=127?0:f>>5===6?2:f>>4===14?3:f>>3===30?4:f>>6===2?-1:-2}function l(f,w,T){var L=w.length-1;if(L<T)return 0;var x=o(w[L]);return x>=0?(x>0&&(f.lastNeed=x-1),x):--L<T||x===-2?0:(x=o(w[L]),x>=0?(x>0&&(f.lastNeed=x-2),x):--L<T||x===-2?0:(x=o(w[L]),x>=0?(x>0&&(x===2?x=0:f.lastNeed=x-3),x):0))}function h(f,w,T){if((w[0]&192)!==128)return f.lastNeed=0,"�";if(f.lastNeed>1&&w.length>1){if((w[1]&192)!==128)return f.lastNeed=1,"�";if(f.lastNeed>2&&w.length>2&&(w[2]&192)!==128)return f.lastNeed=2,"�"}}function c(f){var w=this.lastTotal-this.lastNeed,T=h(this,f);if(T!==void 0)return T;if(this.lastNeed<=f.length)return f.copy(this.lastChar,w,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);f.copy(this.lastChar,w,0,f.length),this.lastNeed-=f.length}function v(f,w){var T=l(this,f,w);if(!this.lastNeed)return f.toString("utf8",w);this.lastTotal=T;var L=f.length-(T-this.lastNeed);return f.copy(this.lastChar,0,L),f.toString("utf8",w,L)}function _(f){var w=f&&f.length?this.write(f):"";return this.lastNeed?w+"�":w}function m(f,w){if((f.length-w)%2===0){var T=f.toString("utf16le",w);if(T){var L=T.charCodeAt(T.length-1);if(L>=55296&&L<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=f[f.length-2],this.lastChar[1]=f[f.length-1],T.slice(0,-1)}return T}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=f[f.length-1],f.toString("utf16le",w,f.length-1)}function O(f){var w=f&&f.length?this.write(f):"";if(this.lastNeed){var T=this.lastTotal-this.lastNeed;return w+this.lastChar.toString("utf16le",0,T)}return w}function N(f,w){var T=(f.length-w)%3;return T===0?f.toString("base64",w):(this.lastNeed=3-T,this.lastTotal=3,T===1?this.lastChar[0]=f[f.length-1]:(this.lastChar[0]=f[f.length-2],this.lastChar[1]=f[f.length-1]),f.toString("base64",w,f.length-T))}function I(f){var w=f&&f.length?this.write(f):"";return this.lastNeed?w+this.lastChar.toString("base64",0,3-this.lastNeed):w}function E(f){return f.toString(this.encoding)}function W(f){return f&&f.length?this.write(f):""}return et}var tt,Rt;function Jt(){if(Rt)return tt;Rt=1;var i=Ue;tt=w;var e=Zr,t;w.ReadableState=f,lt().EventEmitter;var r=function(n,s){return n.listeners(s).length},a=Xt,o=Be.Buffer,l=(typeof $<"u"?$:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function h(n){return o.from(n)}function c(n){return o.isBuffer(n)||n instanceof l}var v=Object.create(U);v.inherits=be;var _=ot,m=void 0;_&&_.debuglog?m=_.debuglog("stream"):m=function(){};var O=hi(),N=zt,I;v.inherits(w,a);var E=["error","close","destroy","pause","resume"];function W(n,s,p){if(typeof n.prependListener=="function")return n.prependListener(s,p);!n._events||!n._events[s]?n.on(s,p):e(n._events[s])?n._events[s].unshift(p):n._events[s]=[p,n._events[s]]}function f(n,s){t=t||de(),n=n||{};var p=s instanceof t;this.objectMode=!!n.objectMode,p&&(this.objectMode=this.objectMode||!!n.readableObjectMode);var b=n.highWaterMark,R=n.readableHighWaterMark,C=this.objectMode?16:16*1024;b||b===0?this.highWaterMark=b:p&&(R||R===0)?this.highWaterMark=R:this.highWaterMark=C,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new O,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=n.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,n.encoding&&(I||(I=It().StringDecoder),this.decoder=new I(n.encoding),this.encoding=n.encoding)}function w(n){if(t=t||de(),!(this instanceof w))return new w(n);this._readableState=new f(n,this),this.readable=!0,n&&(typeof n.read=="function"&&(this._read=n.read),typeof n.destroy=="function"&&(this._destroy=n.destroy)),a.call(this)}Object.defineProperty(w.prototype,"destroyed",{get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(n){this._readableState&&(this._readableState.destroyed=n)}}),w.prototype.destroy=N.destroy,w.prototype._undestroy=N.undestroy,w.prototype._destroy=function(n,s){this.push(null),s(n)},w.prototype.push=function(n,s){var p=this._readableState,b;return p.objectMode?b=!0:typeof n=="string"&&(s=s||p.defaultEncoding,s!==p.encoding&&(n=o.from(n,s),s=""),b=!0),T(this,n,s,!1,b)},w.prototype.unshift=function(n){return T(this,n,null,!0,!1)};function T(n,s,p,b,R){var C=n._readableState;if(s===null)C.reading=!1,oe(n,C);else{var A;R||(A=x(C,s)),A?n.emit("error",A):C.objectMode||s&&s.length>0?(typeof s!="string"&&!C.objectMode&&Object.getPrototypeOf(s)!==o.prototype&&(s=h(s)),b?C.endEmitted?n.emit("error",new Error("stream.unshift() after end event")):L(n,C,s,!0):C.ended?n.emit("error",new Error("stream.push() after EOF")):(C.reading=!1,C.decoder&&!p?(s=C.decoder.write(s),C.objectMode||s.length!==0?L(n,C,s,!1):ve(n,C)):L(n,C,s,!1))):b||(C.reading=!1)}return Y(C)}function L(n,s,p,b){s.flowing&&s.length===0&&!s.sync?(n.emit("data",p),n.read(0)):(s.length+=s.objectMode?1:p.length,b?s.buffer.unshift(p):s.buffer.push(p),s.needReadable&&q(n)),ve(n,s)}function x(n,s){var p;return!c(s)&&typeof s!="string"&&s!==void 0&&!n.objectMode&&(p=new TypeError("Invalid non-string/buffer chunk")),p}function Y(n){return!n.ended&&(n.needReadable||n.length<n.highWaterMark||n.length===0)}w.prototype.isPaused=function(){return this._readableState.flowing===!1},w.prototype.setEncoding=function(n){return I||(I=It().StringDecoder),this._readableState.decoder=new I(n),this._readableState.encoding=n,this};var X=8388608;function z(n){return n>=X?n=X:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}function ae(n,s){return n<=0||s.length===0&&s.ended?0:s.objectMode?1:n!==n?s.flowing&&s.length?s.buffer.head.data.length:s.length:(n>s.highWaterMark&&(s.highWaterMark=z(n)),n<=s.length?n:s.ended?s.length:(s.needReadable=!0,0))}w.prototype.read=function(n){m("read",n),n=parseInt(n,10);var s=this._readableState,p=n;if(n!==0&&(s.emittedReadable=!1),n===0&&s.needReadable&&(s.length>=s.highWaterMark||s.ended))return m("read: emitReadable",s.length,s.ended),s.length===0&&s.ended?K(this):q(this),null;if(n=ae(n,s),n===0&&s.ended)return s.length===0&&K(this),null;var b=s.needReadable;m("need readable",b),(s.length===0||s.length-n<s.highWaterMark)&&(b=!0,m("length less than watermark",b)),s.ended||s.reading?(b=!1,m("reading or ended",b)):b&&(m("do read"),s.reading=!0,s.sync=!0,s.length===0&&(s.needReadable=!0),this._read(s.highWaterMark),s.sync=!1,s.reading||(n=ae(p,s)));var R;return n>0?R=S(n,s):R=null,R===null?(s.needReadable=!0,n=0):s.length-=n,s.length===0&&(s.ended||(s.needReadable=!0),p!==n&&s.ended&&K(this)),R!==null&&this.emit("data",R),R};function oe(n,s){if(!s.ended){if(s.decoder){var p=s.decoder.end();p&&p.length&&(s.buffer.push(p),s.length+=s.objectMode?1:p.length)}s.ended=!0,q(n)}}function q(n){var s=n._readableState;s.needReadable=!1,s.emittedReadable||(m("emitReadable",s.flowing),s.emittedReadable=!0,s.sync?i.nextTick(_e,n):_e(n))}function _e(n){m("emit readable"),n.emit("readable"),g(n)}function ve(n,s){s.readingMore||(s.readingMore=!0,i.nextTick(ee,n,s))}function ee(n,s){for(var p=s.length;!s.reading&&!s.flowing&&!s.ended&&s.length<s.highWaterMark&&(m("maybeReadMore read 0"),n.read(0),p!==s.length);)p=s.length;s.readingMore=!1}w.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))},w.prototype.pipe=function(n,s){var p=this,b=this._readableState;switch(b.pipesCount){case 0:b.pipes=n;break;case 1:b.pipes=[b.pipes,n];break;default:b.pipes.push(n);break}b.pipesCount+=1,m("pipe count=%d opts=%j",b.pipesCount,s);var R=(!s||s.end!==!1)&&n!==process.stdout&&n!==process.stderr,C=R?Se:fe;b.endEmitted?i.nextTick(C):p.once("end",C),n.on("unpipe",A);function A(le,pe){m("onunpipe"),le===p&&pe&&pe.hasUnpiped===!1&&(pe.hasUnpiped=!0,ur())}function Se(){m("onend"),n.end()}var qe=Ve(p);n.on("drain",qe);var ct=!1;function ur(){m("cleanup"),n.removeListener("close",Ge),n.removeListener("finish",Ye),n.removeListener("drain",qe),n.removeListener("error",$e),n.removeListener("unpipe",A),p.removeListener("end",Se),p.removeListener("end",fe),p.removeListener("data",ht),ct=!0,b.awaitDrain&&(!n._writableState||n._writableState.needDrain)&&qe()}var Fe=!1;p.on("data",ht);function ht(le){m("ondata"),Fe=!1;var pe=n.write(le);pe===!1&&!Fe&&((b.pipesCount===1&&b.pipes===n||b.pipesCount>1&&re(b.pipes,n)!==-1)&&!ct&&(m("false write response, pause",b.awaitDrain),b.awaitDrain++,Fe=!0),p.pause())}function $e(le){m("onerror",le),fe(),n.removeListener("error",$e),r(n,"error")===0&&n.emit("error",le)}W(n,"error",$e);function Ge(){n.removeListener("finish",Ye),fe()}n.once("close",Ge);function Ye(){m("onfinish"),n.removeListener("close",Ge),fe()}n.once("finish",Ye);function fe(){m("unpipe"),p.unpipe(n)}return n.emit("pipe",p),b.flowing||(m("pipe resume"),p.resume()),n};function Ve(n){return function(){var s=n._readableState;m("pipeOnDrain",s.awaitDrain),s.awaitDrain&&s.awaitDrain--,s.awaitDrain===0&&r(n,"data")&&(s.flowing=!0,g(n))}}w.prototype.unpipe=function(n){var s=this._readableState,p={hasUnpiped:!1};if(s.pipesCount===0)return this;if(s.pipesCount===1)return n&&n!==s.pipes?this:(n||(n=s.pipes),s.pipes=null,s.pipesCount=0,s.flowing=!1,n&&n.emit("unpipe",this,p),this);if(!n){var b=s.pipes,R=s.pipesCount;s.pipes=null,s.pipesCount=0,s.flowing=!1;for(var C=0;C<R;C++)b[C].emit("unpipe",this,{hasUnpiped:!1});return this}var A=re(s.pipes,n);return A===-1?this:(s.pipes.splice(A,1),s.pipesCount-=1,s.pipesCount===1&&(s.pipes=s.pipes[0]),n.emit("unpipe",this,p),this)},w.prototype.on=function(n,s){var p=a.prototype.on.call(this,n,s);if(n==="data")this._readableState.flowing!==!1&&this.resume();else if(n==="readable"){var b=this._readableState;!b.endEmitted&&!b.readableListening&&(b.readableListening=b.needReadable=!0,b.emittedReadable=!1,b.reading?b.length&&q(this):i.nextTick(Ke,this))}return p},w.prototype.addListener=w.prototype.on;function Ke(n){m("readable nexttick read 0"),n.read(0)}w.prototype.resume=function(){var n=this._readableState;return n.flowing||(m("resume"),n.flowing=!0,u(this,n)),this};function u(n,s){s.resumeScheduled||(s.resumeScheduled=!0,i.nextTick(d,n,s))}function d(n,s){s.reading||(m("resume read 0"),n.read(0)),s.resumeScheduled=!1,s.awaitDrain=0,n.emit("resume"),g(n),s.flowing&&!s.reading&&n.read(0)}w.prototype.pause=function(){return m("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(m("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function g(n){var s=n._readableState;for(m("flow",s.flowing);s.flowing&&n.read()!==null;);}w.prototype.wrap=function(n){var s=this,p=this._readableState,b=!1;n.on("end",function(){if(m("wrapped end"),p.decoder&&!p.ended){var A=p.decoder.end();A&&A.length&&s.push(A)}s.push(null)}),n.on("data",function(A){if(m("wrapped data"),p.decoder&&(A=p.decoder.write(A)),!(p.objectMode&&A==null)&&!(!p.objectMode&&(!A||!A.length))){var Se=s.push(A);Se||(b=!0,n.pause())}});for(var R in n)this[R]===void 0&&typeof n[R]=="function"&&(this[R]=function(A){return function(){return n[A].apply(n,arguments)}}(R));for(var C=0;C<E.length;C++)n.on(E[C],this.emit.bind(this,E[C]));return this._read=function(A){m("wrapped _read",A),b&&(b=!1,n.resume())},this},Object.defineProperty(w.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),w._fromList=S;function S(n,s){if(s.length===0)return null;var p;return s.objectMode?p=s.buffer.shift():!n||n>=s.length?(s.decoder?p=s.buffer.join(""):s.buffer.length===1?p=s.buffer.head.data:p=s.buffer.concat(s.length),s.buffer.clear()):p=D(n,s.buffer,s.decoder),p}function D(n,s,p){var b;return n<s.head.data.length?(b=s.head.data.slice(0,n),s.head.data=s.head.data.slice(n)):n===s.head.data.length?b=s.shift():b=p?M(n,s):V(n,s),b}function M(n,s){var p=s.head,b=1,R=p.data;for(n-=R.length;p=p.next;){var C=p.data,A=n>C.length?C.length:n;if(A===C.length?R+=C:R+=C.slice(0,n),n-=A,n===0){A===C.length?(++b,p.next?s.head=p.next:s.head=s.tail=null):(s.head=p,p.data=C.slice(A));break}++b}return s.length-=b,R}function V(n,s){var p=o.allocUnsafe(n),b=s.head,R=1;for(b.data.copy(p),n-=b.data.length;b=b.next;){var C=b.data,A=n>C.length?C.length:n;if(C.copy(p,p.length-n,0,A),n-=A,n===0){A===C.length?(++R,b.next?s.head=b.next:s.head=s.tail=null):(s.head=b,b.data=C.slice(A));break}++R}return s.length-=R,p}function K(n){var s=n._readableState;if(s.length>0)throw new Error('"endReadable()" called on non-empty stream');s.endEmitted||(s.ended=!0,i.nextTick(te,s,n))}function te(n,s){!n.endEmitted&&n.length===0&&(n.endEmitted=!0,s.readable=!1,s.emit("end"))}function re(n,s){for(var p=0,b=n.length;p<b;p++)if(n[p]===s)return p;return-1}return tt}var Qt=J,je=de(),er=Object.create(U);er.inherits=be;er.inherits(J,je);function gi(i,e){var t=this._transformState;t.transforming=!1;var r=t.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));t.writechunk=null,t.writecb=null,e!=null&&this.push(e),r(i);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}function J(i){if(!(this instanceof J))return new J(i);je.call(this,i),this._transformState={afterTransform:gi.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,i&&(typeof i.transform=="function"&&(this._transform=i.transform),typeof i.flush=="function"&&(this._flush=i.flush)),this.on("prefinish",mi)}function mi(){var i=this;typeof this._flush=="function"?this._flush(function(e,t){Mt(i,e,t)}):Mt(this,null,null)}J.prototype.push=function(i,e){return this._transformState.needTransform=!1,je.prototype.push.call(this,i,e)};J.prototype._transform=function(i,e,t){throw new Error("_transform() is not implemented")};J.prototype._write=function(i,e,t){var r=this._transformState;if(r.writecb=t,r.writechunk=i,r.writeencoding=e,!r.transforming){var a=this._readableState;(r.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}};J.prototype._read=function(i){var e=this._transformState;e.writechunk!==null&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0};J.prototype._destroy=function(i,e){var t=this;je.prototype._destroy.call(this,i,function(r){e(r),t.emit("close")})};function Mt(i,e,t){if(e)return i.emit("error",e);if(t!=null&&i.push(t),i._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(i._transformState.transforming)throw new Error("Calling transform done when still transforming");return i.push(null)}var wi=ye,tr=Qt,rr=Object.create(U);rr.inherits=be;rr.inherits(ye,tr);function ye(i){if(!(this instanceof ye))return new ye(i);tr.call(this,i)}ye.prototype._transform=function(i,e,t){t(null,i)};(function(i,e){e=i.exports=Jt(),e.Stream=e,e.Readable=e,e.Writable=Zt(),e.Duplex=de(),e.Transform=Qt,e.PassThrough=wi})(nt,nt.exports);var yi=nt.exports,bi=vi,_i=Object.prototype.hasOwnProperty;function vi(){for(var i={},e=0;e<arguments.length;e++){var t=arguments[e];for(var r in t)_i.call(t,r)&&(i[r]=t[r])}return i}var ir=yi.Transform,nr=vr.inherits,sr=bi;function ce(i){ir.call(this,i),this._destroyed=!1}nr(ce,ir);ce.prototype.destroy=function(i){if(!this._destroyed){this._destroyed=!0;var e=this;process.nextTick(function(){i&&e.emit("error",i),e.emit("close")})}};function Si(i,e,t){t(null,i)}function dt(i){return function(e,t,r){return typeof e=="function"&&(r=t,t=e,e={}),typeof t!="function"&&(t=Si),typeof r!="function"&&(r=null),i(e,t,r)}}ke.exports=dt(function(i,e,t){var r=new ce(i);return r._transform=e,t&&(r._flush=t),r});ke.exports.ctor=dt(function(i,e,t){function r(a){if(!(this instanceof r))return new r(a);this.options=sr(i,a),ce.call(this,this.options)}return nr(r,ce),r.prototype._transform=e,t&&(r.prototype._flush=t),r});ke.exports.obj=dt(function(i,e,t){var r=new ce(sr({objectMode:!0,highWaterMark:16},i));return r._transform=e,t&&(r._flush=t),r});var Ci=ke.exports;Object.defineProperty(Le,"__esModule",{value:!0});Le.storeTransformStream=void 0;const Ei=Ci;function Ti(i){return Ei.obj((e,t,r)=>{try{const a=i(e);r(null,a);return}catch(a){r(a);return}})}Le.storeTransformStream=Ti;(function(i){var e=$&&$.__createBinding||(Object.create?function(r,a,o,l){l===void 0&&(l=o),Object.defineProperty(r,l,{enumerable:!0,get:function(){return a[o]}})}:function(r,a,o,l){l===void 0&&(l=o),r[l]=a[o]}),t=$&&$.__exportStar||function(r,a){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(a,o)&&e(a,r,o)};Object.defineProperty(i,"__esModule",{value:!0}),t(Pe,i),t(Ne,i),t(xe,i),t(he,i),t(Le,i)})(it);const me={GOOGLE:"google",FACEBOOK:"facebook",TWITCH:"twitch",REDDIT:"reddit",DISCORD:"discord"},ne={GOOGLE:"google",FACEBOOK:"facebook",TWITCH:"twitch",REDDIT:"reddit",DISCORD:"discord",EMAIL_PASSWORDLESS:"torus-auth0-email-passwordless"},Pt={[ne.GOOGLE]:"tkey-google",[ne.FACEBOOK]:"tkey-facebook",[ne.TWITCH]:"tkey-twitch",[ne.REDDIT]:"tkey-reddit",[ne.DISCORD]:"tkey-discord",[ne.EMAIL_PASSWORDLESS]:"tkey-auth0-email-passwordless"},k={MOONPAY:"moonpay",WYRE:"wyre",RAMPNETWORK:"rampnetwork",XANPOOL:"xanpool",MERCURYO:"mercuryo",TRANSAK:"transak",BANXA:"banxa"},B={MAINNET:"mainnet",MATIC:"matic",BSC_MAINNET:"bsc_mainnet",AVALANCHE_MAINNET:"avalanche_mainnet",XDAI:"xdai"},Ai={PRODUCTION:"production",DEVELOPMENT:"development",BINANCE:"binance",TESTING:"testing",LRC:"lrc",BETA:"beta",BNB:"bnb",POLYGON:"polygon"},ue={BOTTOM_LEFT:"bottom-left",TOP_LEFT:"top-left",BOTTOM_RIGHT:"bottom-right",TOP_RIGHT:"top-right"},Oi=["ETH","USDT","USDC","TUSD","EOSDT","USD","DAI","GUSD","DKKT","PAX","ILS","RUB","BYN","EUR","GBP","JPY","KRW","PLN","MXN","AUD","BRL","CAD","CHF","KPW","LAK","LBP","LKR","XOF","CNHT","DOGE","UAH","TRY","HKD","XJP","SGD","USC","NZD","NGN","RUR","COP","GHS","EGP","IDR","BHD","CRC","PEN","AED","DOP","PKR","HUF","VND","XAR","LTC","RON","OMR","MYR","DKK","UGX","ZMW","SAR","SEK","GEL","RWF","IRR","TZS","CNY","VEF","BDT","HRK","CLP","THB","XAF","ARS","UYU","SZL","KZT","NOK","KES","PAB","INR","CZK","MAD","TWD","PHP","ZAR","BOB","CDF","DASH","VES","ISK","MWK","BAM","TTD","XRP","JOD","RSD","HNL","BGN","GTQ","BWP","XMR","MMK","QAR","AOA","KWD","MUR","WUSD","WEUR","WAVES","WTRY","LRD","LSL","LYD","AWG","MDL","BTO","EURS","CHFT","MKD","MNT","MOP","MRO","MVR","VOLLAR","CKUSD","KHR","VUV","BITCNY","QC","BBD","NAD","NPR","PGK","PYG","BIF","BMD","BND","XLM","BNB","SCR","BAT","CRO","HT","KCS","LEO","LINK","MKR","NPXS","OMG","REP","ZB","ZIL","ZRX","BCH","BZD","CUP","CVE","DJF","DZD","ERN","ETB","FJD","FKP","BUSD","ANCT","ALL","AMD","ANG","CNYX","IQD","UZS","TND","GGP","XAU","KGS","GIP","JMD","ZEC","USDP","BSV","EMC2","SNT","GTO","POWR","EUSD","EURT","BCY","BTS","ATM","BLOCKPAY","ARDR","AMP","B2X","BITGOLD","BITEUR","ATB","BITUSD","AGRS","DFXT","HIKEN","BIX","KNC","EOS","COB","COSS","BMH","NANO","BDG","BNT","XVG","LKK1Y","LKK","USDK","EURN","NZDT","JSE","GMD","GNF","GYD","YER","XPF","HTG","SLL","SOS","WST","SVC","SYP","NEO","KMF","JUMP","AYA","BLAST","WGR","BCN","BTG","URALS","INN","USDQ","CNH","HUSD","BKRW","NZDX","EURX","CADX","USDEX","JPYX","AUDX","VNDC","EON","GBPX","CHFX","USDJ","IDRT","USDS","USDN","BIDR","IDK","BSD","BTN","KYD","NIO","SBD","SDG","SHP","TOP","XCD","XCHF","CNYT","GYEN","ZUSD","GOLD","TRX","TRYB","PLATC","STRAX","UST","GLM","VAI","BRZ","DDRST","XAUT","MIM"],Di={[k.MOONPAY]:["AUD","BGN","BRL","CAD","CHF","CNY","COP","CZK","DKK","DOP","EGP","EUR","GBP","HKD","HRK","IDR","ILS","JPY","JOD","KES","KRW","KWD","LKR","MAD","MXN","MYR","NGN","NOK","NZD","OMR","PEN","PKR","PLN","RON","RUB","SEK","SGD","THB","TRY","TWD","USD","VND","ZAR"],[k.WYRE]:["USD","EUR","GBP","AUD","CAD","NZD","ARS","BRL","CHF","CLP","COP","CZK","DKK","HKD","ILS","INR","ISK","JPY","KRW","MXN","MYR","NOK","PHP","PLN","SEK","THB","VND","ZAR"],[k.RAMPNETWORK]:["USD","EUR","GBP"],[k.XANPOOL]:["SGD","HKD","THB","PHP","INR","IDR","MYR","AUD","NZD","KRW"],[k.MERCURYO]:["EUR","USD","GBP","TRY","JPY","BRL","NGN","VND","MXN","KRW"],[k.TRANSAK]:["ARS","AUD","BBD","BGN","BMD","BRL","CAD","CHF","CLP","CRC","CZK","DKK","DOP","EUR","FJD","FKP","GBP","GIP","HRK","HUF","IDR","ILS","ISK","JMD","JPY","KES","KRW","MDL","MXN","MYR","NOK","NZD","PEN","PHP","PLN","PYG","RON","SEK","SGD","THB","TRY","TZS","USD","ZAR"],[k.BANXA]:["EUR","GBP","USD"]},Ii=new Set(Oi);function ie(i){return Di[i].filter(t=>Ii.has(t))}const Ri={[k.MOONPAY]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"4.5% or 5 USD",line3:"2,000€/day, 10,000€/mo",supportPage:"https://help.moonpay.io/en/",minOrderValue:24.99,maxOrderValue:5e4,validCurrencies:ie(k.MOONPAY),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"aave",display:"AAVE"},{value:"bat",display:"BAT"},{value:"dai",display:"DAI"},{value:"eth",display:"ETH"},{value:"mkr",display:"MKR"},{value:"matic",display:"MATIC"},{value:"usdt",display:"USDT"},{value:"usdc",display:"USDC"}],[B.MATIC]:[{value:"eth_polygon",display:"ETH"},{value:"matic_polygon",display:"MATIC"},{value:"usdc_polygon",display:"USDC"}],[B.BSC_MAINNET]:[{value:"bnb_bsc",display:"BNB"},{value:"busd_bsc",display:"BUSD"}],[B.AVALANCHE_MAINNET]:[{value:"avax_cchain",display:"AVAX"}]},includeFees:!0,api:!0,enforceMax:!1},[k.WYRE]:{line1:"Apple Pay/ Debit/ Credit Card",line2:"4.9% + 30¢ or 5 USD",line3:"$250/day",supportPage:"https://support.sendwyre.com/en/",minOrderValue:5,maxOrderValue:500,validCurrencies:ie(k.WYRE),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"AAVE",display:"AAVE"},{value:"BAT",display:"BAT"},{value:"BUSD",display:"BUSD"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"MKR",display:"MKR"},{value:"UNI",display:"UNI"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[B.MATIC]:[{value:"MUSDC",display:"USDC"}],[B.AVALANCHE_MAINNET]:[{value:"AVAXC",display:"AVAXC"}]},includeFees:!1,api:!0,enforceMax:!1},[k.RAMPNETWORK]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000€/purchase, 20,000€/mo",supportPage:"https://instant.ramp.network/",minOrderValue:50,maxOrderValue:2e4,validCurrencies:ie(k.RAMPNETWORK),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"ETH",display:"ETH"},{value:"DAI",display:"DAI"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[B.MATIC]:[{value:"MATIC_DAI",display:"DAI"},{value:"MATIC_MATIC",display:"MATIC"},{value:"MATIC_USDC",display:"USDC"}],[B.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}]},includeFees:!0,api:!0,receiveHint:"walletTopUp.receiveHintRamp",enforceMax:!1},[k.XANPOOL]:{line1:"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ <br>ViettelPay/ DuitNow",line2:"2.5% buying, 3% selling",line3:"$2,500 / day",supportPage:"mailto:support@xanpool.com",minOrderValue:100,maxOrderValue:2500,validCurrencies:ie(k.XANPOOL),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDT",display:"USDT"}]},includeFees:!0,api:!0,sell:!0,enforceMax:!1},[k.MERCURYO]:{line1:"Credit/ Debit Card/ Apple Pay",line2:"3.95% or 4 USD",line3:"10,000€/day, 25,000€/mo",supportPage:"mailto:support@mercuryo.io",minOrderValue:30,maxOrderValue:5e3,validCurrencies:ie(k.MERCURYO),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"ETH",display:"ETH"},{value:"BAT",display:"BAT"},{value:"USDT",display:"USDT"},{value:"DAI",display:"DAI"}],[B.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"},{value:"1INCH",display:"1INCH"}]},includeFees:!0,api:!0,enforceMax:!1},[k.TRANSAK]:{line1:"Apple & Google Pay / Credit/Debit Card<br/>Bangkok Bank Mobile & iPay<br/>Bank Transfer (sepa/gbp) / SCB Mobile & Easy",line2:"0.99% - 5.5% or 5 USD",line3:"$5,000/day, $28,000/mo",supportPage:"https://support.transak.com/hc/en-US",minOrderValue:30,maxOrderValue:500,validCurrencies:ie(k.TRANSAK),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"ETH",display:"ETH"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"}],[B.MATIC]:[{value:"AAVE",display:"AAVE"},{value:"DAI",display:"DAI"},{value:"MATIC",display:"MATIC"},{value:"USDC",display:"USDC"},{value:"USDT",display:"USDT"},{value:"WETH",display:"WETH"}],[B.BSC_MAINNET]:[{value:"BNB",display:"BNB"},{value:"BUSD",display:"BUSD"}],[B.AVALANCHE_MAINNET]:[{value:"AVAX",display:"AVAX"}]},includeFees:!0,enforceMax:!0},[k.BANXA]:{line1:"Debit Card/ <br>Apple Pay/ Bank transfer",line2:"0.49% - 2.9%",line3:"5,000€/purchase, 20,000€/mo",supportPage:"https://support.banxa.com",minOrderValue:20,maxOrderValue:15e3,validCurrencies:ie(k.BANXA),validCryptoCurrenciesByChain:{[B.MAINNET]:[{value:"ETH",display:"ETH"},{value:"USDT",display:"USDT"},{value:"BUSD",display:"BUSD"},{value:"LINK",display:"LINK"},{value:"USDC",display:"USDC"},{value:"CHZ",display:"CHZ"},{value:"BAT",display:"BAT"},{value:"MANA",display:"MANA"},{value:"AAVE",display:"AAVE"},{value:"COMP",display:"COMP"},{value:"ENJ",display:"ENJ"}],[B.MATIC]:[{value:"MATIC",display:"MATIC"}]},includeFees:!0,enforceMax:!0}},Mi={en:{embed:{continue:"Continue",actionRequired:"Authorization required",pendingAction:"Click continue to proceed with your request in a popup",cookiesRequired:"Cookies Required",enableCookies:"Please enable cookies in your browser preferences to access Torus",clickHere:"More Info"}},de:{embed:{continue:"Fortsetzen",actionRequired:"Autorisierung erforderlich",pendingAction:"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren",cookiesRequired:"Cookies benötigt",enableCookies:"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen",clickHere:"Mehr Info"}},ja:{embed:{continue:"継続する",actionRequired:"認証が必要です",pendingAction:"続行をクリックして、ポップアップでリクエストを続行します",cookiesRequired:"必要なクッキー",enableCookies:"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。",clickHere:"詳しくは"}},ko:{embed:{continue:"계속하다",actionRequired:"승인 필요",pendingAction:"팝업에서 요청을 진행하려면 계속을 클릭하십시오.",cookiesRequired:"쿠키 필요",enableCookies:"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.",clickHere:"더 많은 정보"}},zh:{embed:{continue:"继续",actionRequired:"需要授权",pendingAction:"单击继续以在弹出窗口中继续您的请求",cookiesRequired:"必填Cookie",enableCookies:"请在您的浏览器首选项中启用cookie以访问Torus。",clickHere:"更多信息"}}};var G={supportedVerifierList:Object.values(ne),paymentProviders:Ri,api:"https://api.tor.us",translations:Mi,prodTorusUrl:"",localStorageKeyPrefix:"torus-"};const Nt=i=>new Promise((e,t)=>{window.document.body!=null?Promise.resolve(i()).then(e).catch(t):window.document.addEventListener("DOMContentLoaded",()=>{Promise.resolve(i()).then(e).catch(t)})}),we=i=>{const e=window.document.createElement("template"),t=i.trim();return e.innerHTML=t,e.content.firstChild},Pi=function(i,e,t){for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];const l=()=>{t(...a),i.removeEventListener(e,l)};i.addEventListener(e,l)},F=(i,e,t)=>{const r=a=>{t(a),i.removeListener(e,r)};i.on(e,r)};async function Ni(){return new Promise(i=>{document.readyState!=="loading"?i():Pi(document,"DOMContentLoaded",i)})}var P=pr.getLogger("torus-embed"),H={errors:{disconnected:()=>"Torus: Lost connection to Torus.",permanentlyDisconnected:()=>"Torus: Disconnected from iframe. Page reload required.",sendSiteMetadata:()=>"Torus: Failed to send site metadata. This is an internal error, please report this bug.",unsupportedSync:i=>`Torus: The Torus Ethereum provider does not support synchronous methods like ${i} without a callback parameter.`,invalidDuplexStream:()=>"Must provide a Node.js-style duplex stream.",invalidOptions:(i,e)=>`Invalid options. Received: { maxEventListeners: ${i}, shouldSendMetadata: ${e} }`,invalidRequestArgs:()=>"Expected a single, non-array, object argument.",invalidRequestMethod:()=>"'args.method' must be a non-empty string.",invalidRequestParams:()=>"'args.params' must be an object or array if provided.",invalidLoggerObject:()=>"'args.logger' must be an object if provided.",invalidLoggerMethod:i=>`'args.logger' must include required method '${i}'.`},info:{connected:i=>`Torus: Connected to chain with ID "${i}".`},warnings:{enableDeprecation:'Torus: ""ethereum.enable()" is deprecated and may be removed in the future. Please use "ethereum.send("eth_requestAccounts")" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',sendDeprecation:`Torus: "ethereum.send(...)" is deprecated and may be removed in the future. Please use "ethereum.sendAsync(...)" or "ethereum.request(...)" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,events:{close:`Torus: The event "close" is deprecated and may be removed in the future. Please use "disconnect" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,data:`Torus: The event "data" is deprecated and will be removed in the future.Use "message" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193#message`,networkChanged:`Torus: The event "networkChanged" is deprecated and may be removed in the future. Please use "chainChanged" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`,notification:`Torus: The event "notification" is deprecated and may be removed in the future. Please use "message" instead.
For more information, see: https://eips.ethereum.org/EIPS/eip-1193`},publicConfigStore:'Torus: The property "publicConfigStore" is deprecated and WILL be removed in the future.'}};const{paymentProviders:xt}=G,xi=(i,e)=>{const t={};if(!i)return{errors:t,isValid:!0};if(i&&!xt[i])return t.provider="Invalid Provider",{errors:t,isValid:Object.keys(t).length===0};const r=xt[i],a=e||{};if(a.fiatValue){const o=+parseFloat(a.fiatValue.toString())||0;o<r.minOrderValue&&(t.fiatValue="Requested amount is lower than supported"),o>r.maxOrderValue&&r.enforceMax&&(t.fiatValue="Requested amount is higher than supported")}if(a.selectedCurrency&&!r.validCurrencies.includes(a.selectedCurrency)&&(t.selectedCurrency="Unsupported currency"),a.selectedCryptoCurrency){const o=Object.values(r.validCryptoCurrenciesByChain).flat().map(h=>h.value),l=i===k.MOONPAY?a.selectedCryptoCurrency.toLowerCase():a.selectedCryptoCurrency;o&&!o.includes(l)&&(t.selectedCryptoCurrency="Unsupported cryptoCurrency")}return{errors:t,isValid:Object.keys(t).length===0}};function Li(){return(i,e,t)=>{(typeof i.method!="string"||!i.method)&&(e.error=Q.ethErrors.rpc.invalidRequest({message:"The request 'method' must be a non-empty string.",data:i})),t(r=>{const{error:a}=e;return a&&P.error(`MetaMask - RPC Error: ${a.message}`,a),r()})}}function Lt(i,e,t){let r=`MetaMask: Lost connection to "${i}".`;e!=null&&e.stack&&(r+=`
${e.stack}`),P.warn(r),t&&t.listenerCount("error")>0&&t.emit("error",r)}const se=()=>Math.random().toString(36).slice(2),ar=async(i,e)=>{let t,r;const a="1.41.3";let o=e.version||a;try{if((i==="binance"||i==="production")&&!e.version){let l;G.prodTorusUrl?l={data:G.prodTorusUrl}:l=await Gt(`${G.api}/latestversion?name=@toruslabs/torus-embed&version=${a}`,{},{useAPIKey:!0}),o=l.data,G.prodTorusUrl=l.data}}catch(l){P.error(l,"unable to fetch latest version")}switch(P.info("version used: ",o),i){case"binance":t=`https://binance.tor.us/v${o}`,r="info";break;case"testing":t="https://testing.tor.us",r="debug";break;case"bnb":t="https://bnb.tor.us",r="error";break;case"polygon":t="https://polygon.tor.us",r="error";break;case"lrc":t="https://lrc.tor.us",r="debug";break;case"beta":t="https://beta.tor.us",r="debug";break;case"development":t="http://localhost:4050",r="debug";break;default:t=`https://app.tor.us/v${o}`,r="error";break}return{torusUrl:t,logLevel:r}},kt=()=>{let i=window.navigator.language||"en-US";const e=i.split("-");return i=Object.prototype.hasOwnProperty.call(G.translations,e[0])?e[0]:"en",i},ki=["eth_subscription"],or=()=>{},Ut="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375",Ui="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315",Bt="directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450";function Bi(){const i=window.screenLeft!==void 0?window.screenLeft:window.screenX,e=window.screenTop!==void 0?window.screenTop:window.screenY,t=1200,r=700,a=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,o=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,l=1,h=Math.abs((a-t)/2/l+i),c=Math.abs((o-r)/2/l+e);return`titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${r/l},width=${t/l},top=${c},left=${h}`}function Wt(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,r)}return t}function Wi(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wt(Object(t),!0).forEach(function(r){y(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Wt(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}Me.defaultMaxListeners=100;const jt=function(i,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return(r,a)=>r||a.error?e(r||a.error):!t||Array.isArray(a)?i(a):i(a.result)};class He extends Me{constructor(e){let{maxEventListeners:t=100,shouldSendMetadata:r=!0,jsonRpcStreamName:a="provider"}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(super(),y(this,"chainId",void 0),y(this,"selectedAddress",void 0),y(this,"_rpcEngine",void 0),y(this,"networkVersion",void 0),y(this,"shouldSendMetadata",void 0),y(this,"isTorus",void 0),y(this,"_publicConfigStore",void 0),y(this,"tryPreopenHandle",void 0),y(this,"enable",void 0),y(this,"_state",void 0),y(this,"_jsonRpcConnection",void 0),y(this,"_sentWarnings",{enable:!1,experimentalMethods:!1,send:!1,publicConfigStore:!1,events:{close:!1,data:!1,networkChanged:!1,notification:!1}}),!Sr.duplex(e))throw new Error(H.errors.invalidDuplexStream());this.isTorus=!0,this.setMaxListeners(t),this._state=Wi({},He._defaultState),this.selectedAddress=null,this.networkVersion=null,this.chainId=null,this.shouldSendMetadata=r,this._handleAccountsChanged=this._handleAccountsChanged.bind(this),this._handleChainChanged=this._handleChainChanged.bind(this),this._handleUnlockStateChanged=this._handleUnlockStateChanged.bind(this),this._handleConnect=this._handleConnect.bind(this),this._handleDisconnect=this._handleDisconnect.bind(this),this._handleStreamDisconnect=this._handleStreamDisconnect.bind(this),this._sendSync=this._sendSync.bind(this),this._rpcRequest=this._rpcRequest.bind(this),this._warnOfDeprecation=this._warnOfDeprecation.bind(this),this._initializeState=this._initializeState.bind(this),this.request=this.request.bind(this),this.send=this.send.bind(this),this.sendAsync=this.sendAsync.bind(this);const o=new Yt;Ie(e,o,e,this._handleStreamDisconnect.bind(this,"MetaMask")),this._publicConfigStore=new it.ObservableStore({storageKey:"Metamask-Config"}),Ie(o.createStream("publicConfig"),it.storeAsStream(this._publicConfigStore),Lt.bind(this,"MetaMask PublicConfigStore")),o.ignoreStream("phishing"),this.on("connect",()=>{this._state.isConnected=!0});const l=Rr();Ie(l.stream,o.createStream(a),l.stream,this._handleStreamDisconnect.bind(this,"MetaMask RpcProvider"));const h=new Z;h.push(Mr()),h.push(Li()),h.push(l.middleware),this._rpcEngine=h,l.events.on("notification",c=>{const{method:v,params:_}=c;v==="wallet_accountsChanged"?this._handleAccountsChanged(_):v==="wallet_unlockStateChanged"?this._handleUnlockStateChanged(_):v==="wallet_chainChanged"?this._handleChainChanged(_):ki.includes(c.method)&&(this.emit("data",c),this.emit("notification",_.result),this.emit("message",{type:v,data:_}))})}get publicConfigStore(){return this._sentWarnings.publicConfigStore||(P.warn(H.warnings.publicConfigStore),this._sentWarnings.publicConfigStore=!0),this._publicConfigStore}isConnected(){return this._state.isConnected}async request(e){if(!e||typeof e!="object"||Array.isArray(e))throw Q.ethErrors.rpc.invalidRequest({message:H.errors.invalidRequestArgs(),data:e});const{method:t,params:r}=e;if(typeof t!="string"||t.length===0)throw Q.ethErrors.rpc.invalidRequest({message:H.errors.invalidRequestMethod(),data:e});if(r!==void 0&&!Array.isArray(r)&&(typeof r!="object"||r===null))throw Q.ethErrors.rpc.invalidRequest({message:H.errors.invalidRequestParams(),data:e});return new Promise((a,o)=>{this._rpcRequest({method:t,params:r},jt(a,o))})}sendAsync(e,t){this._rpcRequest(e,t)}addListener(e,t){return this._warnOfDeprecation(e),super.addListener(e,t)}on(e,t){return this._warnOfDeprecation(e),super.on(e,t)}once(e,t){return this._warnOfDeprecation(e),super.once(e,t)}prependListener(e,t){return this._warnOfDeprecation(e),super.prependListener(e,t)}prependOnceListener(e,t){return this._warnOfDeprecation(e),super.prependOnceListener(e,t)}async _initializeState(){try{const{accounts:e,chainId:t,isUnlocked:r,networkVersion:a}=await this.request({method:"wallet_getProviderState"});this.emit("connect",{chainId:t}),this._handleChainChanged({chainId:t,networkVersion:a}),this._handleUnlockStateChanged({accounts:e,isUnlocked:r}),this._handleAccountsChanged(e)}catch(e){P.error("MetaMask: Failed to get initial state. Please report this bug.",e)}finally{P.info("initialized state"),this._state.initialized=!0,this.emit("_initialized")}}_rpcRequest(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=t;const o=e;if(!Array.isArray(o)){if(o.jsonrpc||(o.jsonrpc="2.0"),o.method==="eth_accounts"||o.method==="eth_requestAccounts")a=(l,h)=>{this._handleAccountsChanged(h.result||[],o.method==="eth_accounts",r),t(l,h)};else if(o.method==="wallet_getProviderState"){this._rpcEngine.handle(e,a);return}}this.tryPreopenHandle(o,a)}send(e,t){return this._sentWarnings.send||(P.warn(H.warnings.sendDeprecation),this._sentWarnings.send=!0),typeof e=="string"&&(!t||Array.isArray(t))?new Promise((r,a)=>{try{this._rpcRequest({method:e,params:t},jt(r,a,!1))}catch(o){a(o)}}):e&&typeof e=="object"&&typeof t=="function"?this._rpcRequest(e,t):this._sendSync(e)}_sendSync(e){let t;switch(e.method){case"eth_accounts":t=this.selectedAddress?[this.selectedAddress]:[];break;case"eth_coinbase":t=this.selectedAddress||null;break;case"eth_uninstallFilter":this._rpcRequest(e,or),t=!0;break;case"net_version":t=this.networkVersion||null;break;default:throw new Error(H.errors.unsupportedSync(e.method))}return{id:e.id,jsonrpc:e.jsonrpc,result:t}}_handleConnect(e){this._state.isConnected||(this._state.isConnected=!0,this.emit("connect",{chainId:e}),P.debug(H.info.connected(e)))}_handleDisconnect(e,t){if(this._state.isConnected||!this._state.isPermanentlyDisconnected&&!e){this._state.isConnected=!1;let r;e?(r=new Q.EthereumRpcError(1013,t||H.errors.disconnected()),P.debug(r)):(r=new Q.EthereumRpcError(1011,t||H.errors.permanentlyDisconnected()),P.error(r),this.chainId=null,this._state.accounts=null,this.selectedAddress=null,this._state.isUnlocked=!1,this._state.isPermanentlyDisconnected=!0),this.emit("disconnect",r)}}_handleStreamDisconnect(e,t){Lt(e,t,this),this._handleDisconnect(!1,t?t.message:void 0)}_handleAccountsChanged(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,a=e;Array.isArray(a)||(P.error("MetaMask: Received non-array accounts parameter. Please report this bug.",a),a=[]);for(const o of e)if(typeof o!="string"){P.error("MetaMask: Received non-string account. Please report this bug.",e),a=[];break}Cr(this._state.accounts,a)||(t&&Array.isArray(this._state.accounts)&&this._state.accounts.length>0&&!r&&P.error('MetaMask: "eth_accounts" unexpectedly updated accounts. Please report this bug.',a),this._state.accounts=a,this.emit("accountsChanged",a)),this.selectedAddress!==a[0]&&(this.selectedAddress=a[0]||null)}_handleChainChanged(){let{chainId:e,networkVersion:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!e||!t){P.error("MetaMask: Received invalid network parameters. Please report this bug.",{chainId:e,networkVersion:t});return}t==="loading"?this._handleDisconnect(!0):(this._handleConnect(e),e!==this.chainId&&(this.chainId=e,this._state.initialized&&this.emit("chainChanged",this.chainId)))}_handleUnlockStateChanged(){let{accounts:e,isUnlocked:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(typeof t!="boolean"){P.error("MetaMask: Received invalid isUnlocked parameter. Please report this bug.",{isUnlocked:t});return}t!==this._state.isUnlocked&&(this._state.isUnlocked=t,this._handleAccountsChanged(e||[]))}_warnOfDeprecation(e){this._sentWarnings.events[e]===!1&&(P.warn(H.warnings.events[e]),this._sentWarnings.events[e]=!0)}}y(He,"_defaultState",{accounts:null,isConnected:!1,isUnlocked:!1,initialized:!1,isPermanentlyDisconnected:!1,hasEmittedConnection:!1});const ji=i=>({algorithms:i.algorithms||["sha256"],delimiter:i.delimiter||" ",full:i.full||!1}),Hi=(i,e)=>{const t={};return i.algorithms.forEach(r=>{t[r]=Er(r).update(e,"utf8").digest("base64")}),t},Vi=(i,e)=>{let t="";return t+=Object.keys(e.hashes).map(r=>`${r}-${e.hashes[r]}`).join(i.delimiter),t},Ki=(i,e)=>{const t=ji(i),r={hashes:Hi(t,e),integrity:void 0};return r.integrity=Vi(t,r),t.full?r:r.integrity};class Ht extends Ft.EventEmitter{constructor(e){let{url:t,target:r,features:a}=e;super(),y(this,"url",void 0),y(this,"target",void 0),y(this,"features",void 0),y(this,"window",void 0),y(this,"windowTimer",void 0),y(this,"iClosedWindow",void 0),this.url=t,this.target=r||"_blank",this.features=a||Bi(),this.window=void 0,this.windowTimer=void 0,this.iClosedWindow=!1,this._setupTimer()}_setupTimer(){this.windowTimer=Number(setInterval(()=>{this.window&&this.window.closed&&(clearInterval(this.windowTimer),this.iClosedWindow||this.emit("close"),this.iClosedWindow=!1,this.window=void 0),this.window===void 0&&clearInterval(this.windowTimer)},500))}open(){var e;this.window=window.open(this.url.href,this.target,this.features),(e=this.window)!=null&&e.focus&&this.window.focus()}close(){this.iClosedWindow=!0,this.window&&this.window.close()}redirect(e){e?window.location.replace(this.url.href):window.location.href=this.url.href}}function Vt(i){return new Promise((e,t)=>{try{const r=document.createElement("img");r.onload=()=>e(!0),r.onerror=()=>e(!1),r.src=i}catch(r){t(r)}})}const qi=i=>{const{document:e}=i,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;const r=e.querySelector('head > meta[name="title"]');return r?r.content:e.title&&e.title.length>0?e.title:i.location.hostname};async function Fi(i){const{document:e}=i;let t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await Vt(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(r=>!!r.href),t&&await Vt(t.href))?t.href:null}const $i=async()=>({name:qi(window),icon:await Fi(window)});async function Gi(i){try{const e=await $i();i.handle({jsonrpc:"2.0",id:se(),method:"wallet_sendDomainMetadata",params:e},or)}catch(e){P.error({message:H.errors.sendSiteMetadata(),originalError:e})}}const Yi=["host","chainId","networkName"];function Kt(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,r)}return t}function Xi(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Kt(Object(t),!0).forEach(function(r){y(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Kt(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}const zi={[me.GOOGLE]:!0,[me.FACEBOOK]:!0,[me.REDDIT]:!0,[me.TWITCH]:!0,[me.DISCORD]:!0},lr="sha384-QwEWmiPwBSE0zoVFrfYw+zFNBRwBhOo6NucsqlJnGOqpUEVaRo1UOMrAKDykq2WP",Zi="max-age=3600",Ji=["eth_sendTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign","eth_getEncryptionPublicKey","eth_decrypt","wallet_addEthereumChain","wallet_switchEthereumChain"];(async function(){try{if(typeof document>"u")return;const e=document.createElement("link"),{torusUrl:t}=await ar("production",{check:!1,hash:lr,version:""});e.href=`${t}/popup`,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(e){P.warn(e)}})();class Qi{constructor(){let{buttonPosition:e=ue.BOTTOM_LEFT,buttonSize:t=56,modalZIndex:r=99999,apiKey:a="torus-default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y(this,"buttonPosition",ue.BOTTOM_LEFT),y(this,"buttonSize",void 0),y(this,"torusUrl",void 0),y(this,"torusIframe",void 0),y(this,"styleLink",void 0),y(this,"isLoggedIn",void 0),y(this,"isInitialized",void 0),y(this,"torusWidgetVisibility",void 0),y(this,"torusAlert",void 0),y(this,"apiKey",void 0),y(this,"modalZIndex",void 0),y(this,"alertZIndex",void 0),y(this,"torusAlertContainer",void 0),y(this,"isIframeFullScreen",void 0),y(this,"whiteLabel",void 0),y(this,"requestedVerifier",void 0),y(this,"currentVerifier",void 0),y(this,"embedTranslations",void 0),y(this,"ethereum",void 0),y(this,"provider",void 0),y(this,"communicationMux",void 0),y(this,"isLoginCallback",void 0),y(this,"paymentProviders",G.paymentProviders),y(this,"loginHint",""),y(this,"useWalletConnect",void 0),y(this,"isCustomLogin",!1),this.buttonPosition=e,this.buttonSize=t,this.torusUrl="",this.isLoggedIn=!1,this.isInitialized=!1,this.torusWidgetVisibility=!0,this.requestedVerifier="",this.currentVerifier="",this.apiKey=a,mr(a),this.modalZIndex=r,this.alertZIndex=r+1e3,this.isIframeFullScreen=!1}async init(){let{buildEnv:e=Ai.PRODUCTION,enableLogging:t=!1,enabledVerifiers:r=zi,network:a={host:"mainnet",chainId:null,networkName:"",blockExplorer:"",ticker:"",tickerName:""},loginConfig:o={},showTorusButton:l=!0,integrity:h={check:!1,hash:lr,version:""},whiteLabel:c,skipTKey:v=!1,useWalletConnect:_=!1,mfaLevel:m="default"}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.isInitialized)throw new Error("Already initialized");const{torusUrl:O,logLevel:N}=await ar(e,h);P.info(O,"url loaded"),this.torusUrl=O,this.whiteLabel=c,this.useWalletConnect=_,this.isCustomLogin=!!(o&&Object.keys(o).length>0)||!!(c&&Object.keys(c).length>0),P.setDefaultLevel(N),t?P.enableAll():P.disableAll(),this.torusWidgetVisibility=l;const I=new URL(O);I.pathname.endsWith("/")?I.pathname+="popup":I.pathname+="/popup",I.hash=`#isCustomLogin=${this.isCustomLogin}`,this.torusIframe=we(`<iframe
        id="torusIframe"
        allow=${_?"camera":""}
        class="torusIframe"
        src="${I.href}"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%; color-scheme: none;
        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}"
      ></iframe>`),this.torusAlertContainer=we('<div id="torusAlertContainer"></div>'),this.torusAlertContainer.style.display="none",this.torusAlertContainer.style.setProperty("z-index",this.alertZIndex.toString());const E=window.document.createElement("link");E.setAttribute("rel","stylesheet"),E.setAttribute("type","text/css"),E.setAttribute("href",`${O}/css/widget.css`),this.styleLink=E;const{defaultLanguage:W=kt(),customTranslations:f={}}=this.whiteLabel||{},T=gr(G.translations,f)[W]||G.translations[kt()];this.embedTranslations=T.embed;const L=async()=>(await Ni(),new Promise((x,Y)=>{this.torusIframe.onload=async()=>{this._setupWeb3();const X=this.communicationMux.getStream("init_stream");X.on("data",z=>{const{name:ae,data:oe,error:q}=z;ae==="init_complete"&&oe.success?(this.isInitialized=!0,this._displayIframe(this.isIframeFullScreen),x(void 0)):q&&Y(new Error(q))}),X.write({name:"init_stream",data:{enabledVerifiers:r,loginConfig:o,whiteLabel:this.whiteLabel,buttonPosition:this.buttonPosition,buttonSize:this.buttonSize,torusWidgetVisibility:this.torusWidgetVisibility,apiKey:this.apiKey,skipTKey:v,network:a,mfaLevel:m}})},window.document.head.appendChild(this.styleLink),window.document.body.appendChild(this.torusIframe),window.document.body.appendChild(this.torusAlertContainer)}));if(e==="production"&&h.check){const x=`${O}/popup`,Y=await fetch(x,{cache:"reload"});if(Y.headers.get("Cache-Control")!==Zi)throw new Error(`Unexpected Cache-Control headers, got ${Y.headers.get("Cache-Control")}`);const X=await Y.text(),z=Ki({algorithms:["sha384"]},X);if(P.info(z,"integrity"),z===h.hash)await L();else throw this.clearInit(),new Error("Integrity check failed")}else await L()}login(){let{verifier:e="",login_hint:t=""}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this.isInitialized)throw new Error("Call init() first");return this.requestedVerifier=e,this.loginHint=t,this.ethereum.enable()}logout(){return new Promise((e,t)=>{if(!this.isLoggedIn){t(new Error("User has not logged in yet"));return}this.communicationMux.getStream("logout").write({name:"logOut"});const a=this.communicationMux.getStream("status");F(a,"data",l=>{l.loggedIn?t(new Error("Some Error Occured")):(this.isLoggedIn=!1,this.currentVerifier="",this.requestedVerifier="",e())})})}async cleanUp(){this.isLoggedIn&&await this.logout(),this.clearInit()}clearInit(){function e(t){return t instanceof Element||t instanceof HTMLDocument}e(this.styleLink)&&window.document.body.contains(this.styleLink)&&(this.styleLink.remove(),this.styleLink=void 0),e(this.torusIframe)&&window.document.body.contains(this.torusIframe)&&(this.torusIframe.remove(),this.torusIframe=void 0),e(this.torusAlertContainer)&&window.document.body.contains(this.torusAlertContainer)&&(this.torusAlert=void 0,this.torusAlertContainer.remove(),this.torusAlertContainer=void 0),this.isInitialized=!1}hideTorusButton(){this.torusWidgetVisibility=!1,this._sendWidgetVisibilityStatus(!1),this._displayIframe()}showTorusButton(){this.torusWidgetVisibility=!0,this._sendWidgetVisibilityStatus(!0),this._displayIframe()}setProvider(e){let{host:t="mainnet",chainId:r=null,networkName:a=""}=e,o=Or(e,Yi);return new Promise((l,h)=>{const c=this.communicationMux.getStream("provider_change");F(c,"data",m=>{const{err:O,success:N}=m.data;P.info(m),O?h(O):N?l():h(new Error("some error occured"))});const _=se();this._handleWindow(_,{target:"_blank",features:Ut}),c.write({name:"show_provider_change",data:{network:Xi({host:t,chainId:r,networkName:a},o),preopenInstanceId:_,override:!1}})})}showWallet(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=this.communicationMux.getStream("show_wallet"),a=e?`/${e}`:"";r.write({name:"show_wallet",data:{path:a}}),F(r,"data",l=>{if(l.name==="show_wallet_instance"){const{instanceId:h}=l.data,c=new URL(`${this.torusUrl}/wallet${a}`);c.searchParams.append("integrity","true"),c.searchParams.append("instanceId",h),Object.keys(t).forEach(_=>{c.searchParams.append(_,t[_])}),c.hash=`#isCustomLogin=${this.isCustomLogin}`,new Ht({url:c,features:Ui}).open()}})}async getPublicAddress(e){let{verifier:t,verifierId:r,isExtended:a=!1}=e;if(!G.supportedVerifierList.includes(t)||!Pt[t])throw new Error("Unsupported verifier");const o=t,l=Pt[t],h=new URL("https://api.tor.us/lookup/torus");return h.searchParams.append("verifier",l),h.searchParams.append("verifierId",r),h.searchParams.append("walletVerifier",o),h.searchParams.append("network","mainnet"),h.searchParams.append("isExtended",a.toString()),Gt(h.href,{headers:{"Content-Type":"application/json; charset=utf-8"}},{useAPIKey:!0})}getUserInfo(e){return new Promise((t,r)=>{if(this.isLoggedIn){const a=this.communicationMux.getStream("user_info_access");a.write({name:"user_info_access_request"}),F(a,"data",l=>{const{name:h,data:{approved:c,payload:v,rejected:_,newRequest:m}}=l;if(h==="user_info_access_response"){if(c)t(v);else if(_)r(new Error("User rejected the request"));else if(m){const O=this.communicationMux.getStream("user_info");F(O,"data",E=>{E.name==="user_info_response"&&(E.data.approved?t(E.data.payload):r(new Error("User rejected the request")))});const I=se();this._handleWindow(I,{target:"_blank",features:Ut}),O.write({name:"user_info_request",data:{message:e,preopenInstanceId:I}})}}})}else r(new Error("User has not logged in yet"))})}initiateTopup(e,t){return new Promise((r,a)=>{if(this.isInitialized){const{errors:o,isValid:l}=xi(e,t);if(!l){a(new Error(JSON.stringify(o)));return}const h=this.communicationMux.getStream("topup");F(h,"data",_=>{_.name==="topup_response"&&(_.data.success?r(_.data.success):a(new Error(_.data.error)))});const v=se();this._handleWindow(v),h.write({name:"topup_request",data:{provider:e,params:t,preopenInstanceId:v}})}else a(new Error("Torus is not initialized yet"))})}async loginWithPrivateKey(e){const{privateKey:t,userInfo:r}=e;return new Promise((a,o)=>{if(this.isInitialized){if(Buffer.from(t,"hex").length!==32){o(new Error("Invalid private key, Please provide a 32 byte valid secp25k1 private key"));return}const l=this.communicationMux.getStream("login_with_private_key");F(l,"data",c=>{c.name==="login_with_private_key_response"&&(c.data.success?a(c.data.success):o(new Error(c.data.error)))}),l.write({name:"login_with_private_key_request",data:{privateKey:t,userInfo:r}})}else o(new Error("Torus is not initialized yet"))})}async showWalletConnectScanner(){if(!this.useWalletConnect)throw new Error("Set `useWalletConnect` as true in init function options to use wallet connect scanner");return new Promise((e,t)=>{if(this.isLoggedIn){const r=this.communicationMux.getStream("wallet_connect_stream");F(r,"data",o=>{o.name==="wallet_connect_stream_res"&&(o.data.success?e(o.data.success):t(new Error(o.data.error)),this._displayIframe())}),r.write({name:"wallet_connect_stream_req"}),this._displayIframe(!0)}else t(new Error("User has not logged in yet"))})}_handleWindow(e){let{url:t,target:r,features:a}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(e){const o=this.communicationMux.getStream("window"),l=new URL(t||`${this.torusUrl}/redirect?preopenInstanceId=${e}`);l.hash?l.hash+=`&isCustomLogin=${this.isCustomLogin}`:l.hash=`#isCustomLogin=${this.isCustomLogin}`;const h=new Ht({url:l,target:r,features:a});if(h.open(),!h.window){this._createPopupBlockAlert(e,l.href);return}o.write({name:"opened_window",data:{preopenInstanceId:e}});const c=v=>{let{preopenInstanceId:_,close:m}=v;_===e&&m&&(h.close(),o.removeListener("data",c))};o.on("data",c),h.once("close",()=>{o.write({data:{preopenInstanceId:e,closed:!0}}),o.removeListener("data",c)})}}_setEmbedWhiteLabel(e){const{theme:t}=this.whiteLabel||{};if(t){const{isDark:r=!1,colors:a={}}=t;r&&e.classList.add("torus-dark"),a.torusBrand1&&e.style.setProperty("--torus-brand-1",a.torusBrand1),a.torusGray2&&e.style.setProperty("--torus-gray-2",a.torusGray2)}}_getLogoUrl(){var t,r,a,o;let e=`${this.torusUrl}/images/torus_icon-blue.svg`;return(r=(t=this.whiteLabel)==null?void 0:t.theme)!=null&&r.isDark?e=((a=this.whiteLabel)==null?void 0:a.logoLight)||e:e=((o=this.whiteLabel)==null?void 0:o.logoDark)||e,e}_sendWidgetVisibilityStatus(e){this.communicationMux.getStream("torus-widget-visibility").write({data:e})}_displayIframe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const t={},r=this.buttonSize+14;if(e)t.display="block",t.width="100%",t.height="100%",t.top="0px",t.right="0px",t.left="0px",t.bottom="0px";else switch(t.display=this.torusWidgetVisibility?"block":"none",t.height=`${r}px`,t.width=`${r}px`,this.buttonPosition){case ue.TOP_LEFT:t.top="0px",t.left="0px",t.right="auto",t.bottom="auto";break;case ue.TOP_RIGHT:t.top="0px",t.right="0px",t.left="auto",t.bottom="auto";break;case ue.BOTTOM_RIGHT:t.bottom="0px",t.right="0px",t.top="auto",t.left="auto";break;case ue.BOTTOM_LEFT:default:t.bottom="0px",t.left="0px",t.top="auto",t.right="auto";break}Object.assign(this.torusIframe.style,t),this.isIframeFullScreen=e}_setupWeb3(){P.info("setupWeb3 running");const e=new yt({name:"embed_metamask",target:"iframe_metamask",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),t=new yt({name:"embed_comm",target:"iframe_comm",targetWindow:this.torusIframe.contentWindow,targetOrigin:new URL(this.torusUrl).origin}),r=new He(e),a=_=>{const m=r[_];r[_]=function(N){if(N&&N==="eth_requestAccounts")return r.enable();for(var I=arguments.length,E=new Array(I>1?I-1:0),W=1;W<I;W++)E[W-1]=arguments[W];return m.apply(this,[N,...E])}};a("send"),a("sendAsync"),r.enable=()=>new Promise((_,m)=>{r.sendAsync({jsonrpc:"2.0",id:se(),method:"eth_requestAccounts",params:[]},(O,N)=>{const{result:I}=N||{};if(O)setTimeout(()=>{m(O)},50);else if(Array.isArray(I)&&I.length>0){const E=()=>{if(this.requestedVerifier!==""&&this.currentVerifier!==this.requestedVerifier){const{requestedVerifier:W}=this;this.logout().then(f=>{this.requestedVerifier=W,this._showLoginPopup(!0,_,m)}).catch(f=>m(f))}else _(I)};this.isLoggedIn?E():this.isLoginCallback=E}else this._showLoginPopup(!0,_,m)})}),r.tryPreopenHandle=(_,m)=>{const O=_;if(!Array.isArray(O)&&Ji.includes(O.method)){const N=se();this._handleWindow(N,{target:"_blank",features:Bt}),O.preopenInstanceId=N}r._rpcEngine.handle(O,m)};const o=new Proxy(r,{deleteProperty:()=>!0});this.ethereum=o;const l=Lr(t);this.communicationMux=l,l.getStream("window").on("data",_=>{_.name==="create_window"&&this._createPopupBlockAlert(_.data.preopenInstanceId,_.data.url)}),l.getStream("widget").on("data",_=>{const{data:m}=_;this._displayIframe(m)}),l.getStream("status").on("data",_=>{_.loggedIn?(this.isLoggedIn=_.loggedIn,this.currentVerifier=_.verifier):this._displayIframe(),this.isLoginCallback&&(this.isLoginCallback(),delete this.isLoginCallback)}),this.provider=o,this.provider.shouldSendMetadata&&Gi(this.provider._rpcEngine),r._initializeState(),P.debug("Torus - injected provider")}_showLoginPopup(e,t,r){const a=l=>{const{err:h,selectedAddress:c}=l;h?(P.error(h),r&&r(h)):t&&t([c]),this.isIframeFullScreen&&this._displayIframe()},o=this.communicationMux.getStream("oauth");if(!this.requestedVerifier)this._displayIframe(!0),F(o,"data",a),o.write({name:"oauth_modal",data:{calledFromEmbed:e}});else{F(o,"data",a);const l=se();this._handleWindow(l),o.write({name:"oauth",data:{calledFromEmbed:e,verifier:this.requestedVerifier,preopenInstanceId:l,login_hint:this.loginHint}})}}_createPopupBlockAlert(e,t){const r=this._getLogoUrl(),a=we(`<div id="torusAlert" class="torus-alert--v2"><div id="torusAlert__logo"><img src="${r}" /></div><div><h1 id="torusAlert__title">${this.embedTranslations.actionRequired}</h1><p id="torusAlert__desc">${this.embedTranslations.pendingAction}</p></div></div>`),o=we(`<div><a id="torusAlert__btn">${this.embedTranslations.continue}</a></div>`),l=we('<div id="torusAlert__btn-container"></div>');l.appendChild(o),a.appendChild(l);const h=()=>{o.addEventListener("click",()=>{this._handleWindow(e,{url:t,target:"_blank",features:Bt}),a.remove(),this.torusAlertContainer.children.length===0&&(this.torusAlertContainer.style.display="none")})};this._setEmbedWhiteLabel(a),Nt(()=>{this.torusAlertContainer.style.display="block",this.torusAlertContainer.appendChild(a)}),Nt(h)}}function qt(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(i);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(i,a).enumerable})),t.push.apply(t,r)}return t}function rt(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qt(Object(t),!0).forEach(function(r){y(i,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):qt(Object(t)).forEach(function(r){Object.defineProperty(i,r,Object.getOwnPropertyDescriptor(t,r))})}return i}class on extends Tr{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),y(this,"name",Ce.TORUS_EVM),y(this,"adapterNamespace",wr.EIP155),y(this,"currentChainNamespace",pt.EIP155),y(this,"type",yr.EXTERNAL),y(this,"status",j.NOT_READY),y(this,"torusInstance",null),y(this,"torusWalletOptions",void 0),y(this,"initParams",void 0),y(this,"loginSettings",{}),y(this,"rehydrated",!1),this.torusWalletOptions=e.adapterSettings||{},this.initParams=e.initParams||{},this.loginSettings=e.loginSettings||{},this.chainConfig=e.chainConfig||null,this.sessionTime=e.sessionTime||86400}get provider(){return this.status===j.CONNECTED&&this.torusInstance?this.torusInstance.provider:null}set provider(e){throw new Error("Not implemented")}async init(e){super.checkInitializationRequirements();let t;if(this.chainConfig){const{chainId:r,blockExplorer:a,displayName:o,rpcTarget:l,ticker:h,tickerName:c}=this.chainConfig;t={chainId:Number.parseInt(r,16),host:l,blockExplorer:a,networkName:o,ticker:h,tickerName:c}}else{this.chainConfig=br(pt.EIP155,1);const{blockExplorer:r,displayName:a,chainId:o,ticker:l,tickerName:h}=this.chainConfig;t={chainId:Number.parseInt(o,16),host:"mainnet",blockExplorer:r,networkName:a,ticker:l,tickerName:h}}this.torusInstance=new Qi(this.torusWalletOptions),Xe.debug("initializing torus evm adapter init"),await this.torusInstance.init(rt(rt({showTorusButton:!1},this.initParams),{},{network:t})),this.status=j.READY,this.emit(Ee.READY,Ce.TORUS_EVM);try{Xe.debug("initializing torus evm adapter"),e.autoConnect&&(this.rehydrated=!0,await this.connect())}catch(r){Xe.error("Failed to connect with torus evm provider",r),this.emit(Ee.ERRORED,r)}}async connect(){if(super.checkConnectionRequirements(),!this.torusInstance)throw Te.notReady("Torus wallet is not initialized");this.status=j.CONNECTING,this.emit(Ee.CONNECTING,{adapter:Ce.TORUS_EVM});try{await this.torusInstance.login(this.loginSettings);const{chainId:e}=this.torusInstance.provider;if(e&&parseInt(e)!==parseInt(this.chainConfig.chainId,16)){const{chainId:t,blockExplorer:r,displayName:a,rpcTarget:o,ticker:l,tickerName:h}=this.chainConfig,c={chainId:Number.parseInt(t,16),host:o,blockExplorer:r,networkName:a,tickerName:h,ticker:l};await this.torusInstance.setProvider(rt({},c));const v=await this.torusInstance.ethereum.request({method:"eth_chainId"});if(v&&parseInt(v)!==parseInt(this.chainConfig.chainId,16))throw Te.fromCode(5e3,"Not connected to correct chainId. Expected: ".concat(this.chainConfig.chainId,", Current: ").concat(v))}return this.status=j.CONNECTED,this.torusInstance.showTorusButton(),this.emit(j.CONNECTED,{adapter:Ce.TORUS_EVM,reconnected:this.rehydrated}),this.provider}catch(e){throw this.status=j.READY,this.rehydrated=!1,this.emit(j.ERRORED,e),e instanceof _r?e:gt.connectionError("Failed to login with torus wallet")}}async disconnect(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{cleanup:!1};if(!this.torusInstance)throw Te.notReady("Torus wallet is not initialized");await super.disconnect(),await this.torusInstance.logout(),this.torusInstance.hideTorusButton(),e.cleanup?(this.status=j.NOT_READY,this.torusInstance=null):this.status=j.READY,this.rehydrated=!1,this.emit(Ee.DISCONNECTED)}async getUserInfo(){if(this.status!==j.CONNECTED)throw gt.notConnectedError("Not connected with wallet");if(!this.torusInstance)throw Te.notReady("Torus wallet is not initialized");return await this.torusInstance.getUserInfo("")}setAdapterSettings(e){this.status!==j.READY&&e!=null&&e.sessionTime&&(this.sessionTime=e.sessionTime)}}export{on as TorusWalletAdapter};
